var Box2D=function(){"use strict;";var t,ga,xa,y,K,w,ha,ia,P,Y,Z,n,ya,za,ja,Aa,ka,U,Ba,Ca,Da,Ea,Fa,Ga,G,Q,R,la,ma,Ha,Ia,na,V,Ja,Ka,La,Ma,oa,aa,pa,M,Na,Oa,Pa,Qa,Ra,Sa,Ta,v,qa,Ua,Va,H,ba,ra,C,W,r,Wa,Xa,sa,ta,ua,S,Ya,ca,Za,X,$a,va,ab,da,bb,cb,u,A,db,wa,ea,T,eb,O,fa,N,p,J,fb,gb,hb,ib,I,E=function(b,a){function d(){this.constructor=b}for(var c in a)jb.call(a,c)&&(b[c]=a[c]);d.prototype=a.prototype;b.prototype=new d;b.__super__=a.prototype;return b},jb={}.hasOwnProperty;t=function(){function b(){}"use strict;";
b.is=function(a,d){"use strict;";var c;return null===a?!1:d instanceof Function&&a instanceof d||null!=(c=a.constructor.__implements)&&c[d.name]?!0:!1};b.generateCallback=function(a,d){return function(){"use strict;";d.apply(a,arguments)}};b.NVector=function(a){"use strict;";var d,c;null==a&&(a=0);d=Array(a);for(c=0;c<a;)d[c]=0,++c;return d};b.parseUInt=function(a){"use strict;";return Math.abs(parseInt(a))};b.Common={b2internal:"Box2D.Common.b2internal",Math:{}};b.Collision={IBroadPhase:"Box2D.Collision.IBroadPhase",
Shapes:{}};b.Dynamics={Contacts:{},Controllers:{},Joints:{}};return b}();y=Array;I=t.NVector;t.Common.b2Color=Z=function(){function b(a,d,c){this._b=this._g=this._r=0;d=d||0;c=c||0;this._r=t.parseUInt(255*r.Clamp(a||0,0,1));this._g=t.parseUInt(255*r.Clamp(d,0,1));this._b=t.parseUInt(255*r.Clamp(c,0,1))}"use strict;";b.prototype.Set=function(a,d,c){d=d||0;c=c||0;this._r=t.parseUInt(255*r.Clamp(a||0,0,1));this._g=t.parseUInt(255*r.Clamp(d,0,1));this._b=t.parseUInt(255*r.Clamp(c,0,1))};return b}();t.Common.b2Settings=
u=function(){function b(){}"use strict;";b.VERSION="2.1alpha";b.USHRT_MAX=65535;b.b2_pi=Math.PI;b.b2_maxManifoldPoints=2;b.b2_aabbExtension=.1;b.b2_aabbMultiplier=2;b.b2_linearSlop=.005;b.b2_maxTOIContactsPerIsland=32;b.b2_maxTOIJointsPerIsland=32;b.b2_velocityThreshold=1;b.b2_maxLinearCorrection=.2;b.b2_maxTranslation=2;b.b2_contactBaumgarte=.2;b.b2_timeToSleep=.5;b.b2_linearSleepTolerance=.01;b.b2MixFriction=function(a,d){return Math.sqrt((a||0)*(d||0))};b.b2MixRestitution=function(a,d){a=a||0;
d=d||0;return a>d?a:d};b.b2Assert=function(a){if(!a)throw"Assertion Failed";};b.b2_angularSleepTolerance=2/180*b.b2_pi;b.b2_maxRotationSquared=b.b2_maxRotation*b.b2_maxRotation;b.b2_maxRotation=.5*b.b2_pi;b.b2_maxTranslationSquared=b.b2_maxTranslation*b.b2_maxTranslation;b.b2_maxAngularCorrection=8/180*b.b2_pi;b.b2_toiSlop=8*b.b2_linearSlop;b.b2_angularSlop=2/180*b.b2_pi;b.b2_polygonRadius=2*b.b2_linearSlop;return b}();t.Common.Math.b2Vec2=p=function(){function b(a,d){this.x=a||0;this.y=d||0}"use strict;";
b.prototype.x=0;b.prototype.y=0;b.Make=function(a,d){return new b(a||0,d||0)};b.prototype.SetZero=function(){this.y=this.x=0};b.prototype.Set=function(a,d){this.x=a||0;this.y=d||0};b.prototype.SetV=function(a){this.x=a.x;this.y=a.y};b.prototype.GetNegative=function(){return new b(-this.x,-this.y)};b.prototype.NegativeSelf=function(){this.x=-this.x;this.y=-this.y};b.prototype.Copy=function(){return new b(this.x,this.y)};b.prototype.Add=function(a){this.x+=a.x;this.y+=a.y};b.prototype.Subtract=function(a){this.x-=
a.x;this.y-=a.y};b.prototype.Multiply=function(a){a=a||0;this.x*=a;this.y*=a};b.prototype.MulM=function(a){var d=this.x;this.x=a.col1.x*d+a.col2.x*this.y;this.y=a.col1.y*d+a.col2.y*this.y};b.prototype.MulTM=function(a){var d=r.Dot(this,a.col1);this.y=r.Dot(this,a.col2);this.x=d};b.prototype.CrossVF=function(a){a=a||0;var d=this.x;this.x=a*this.y;this.y=-a*d};b.prototype.CrossFV=function(a){a=a||0;var d=this.x;this.x=-a*this.y;this.y=a*d};b.prototype.MinV=function(a){this.x=this.x<a.x?this.x:a.x;this.y=
this.y<a.y?this.y:a.y};b.prototype.MaxV=function(a){this.x=this.x>a.x?this.x:a.x;this.y=this.y>a.y?this.y:a.y};b.prototype.Abs=function(){0>this.x&&(this.x=-this.x);0>this.y&&(this.y=-this.y)};b.prototype.Length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};b.prototype.LengthSquared=function(){return this.x*this.x+this.y*this.y};b.prototype.Normalize=function(){var a=Math.sqrt(this.x*this.x+this.y*this.y);if(a<Number.MIN_VALUE)return 0;var d=1/a;this.x*=d;this.y*=d;return a};b.prototype.IsValid=
function(){return r.IsValid(this.x)&&r.IsValid(this.y)};return b}();t.Common.Math.b2Vec3=J=function(){function b(a,d,c){this.x=a||0;this.y=d||0;this.z=c||0}"use strict;";b.prototype.SetZero=function(){this.x=this.y=this.z=0};b.prototype.Set=function(a,d,c){this.x=a||0;this.y=d||0;this.z=c||0};b.prototype.SetV=function(a){this.x=a.x;this.y=a.y;this.z=a.z};b.prototype.GetNegative=function(){return new b(-this.x,-this.y,-this.z)};b.prototype.NegativeSelf=function(){this.x=-this.x;this.y=-this.y;this.z=
-this.z};b.prototype.Copy=function(){return new b(this.x,this.y,this.z)};b.prototype.Add=function(a){this.x+=a.x;this.y+=a.y;this.z+=a.z};b.prototype.Subtract=function(a){this.x-=a.x;this.y-=a.y;this.z-=a.z};b.prototype.Multiply=function(a){a=a||0;this.x*=a;this.y*=a;this.z*=a};return b}();t.Common.Math.b2Mat22=C=function(){function b(){this.col1=new p;this.col2=new p;this.SetIdentity()}"use strict;";b.FromAngle=function(a){a=a||0;var d=new b;d.Set(a);return d};b.FromVV=function(a,d){var c=new b;
c.SetVV(a,d);return c};b.prototype.Set=function(a){a=a||0;var d=Math.cos(a);a=Math.sin(a);this.col1.x=d;this.col2.x=-a;this.col1.y=a;this.col2.y=d};b.prototype.SetVV=function(a,d){this.col1.SetV(a);this.col2.SetV(d)};b.prototype.Copy=function(){var a=new b;a.SetM(this);return a};b.prototype.SetM=function(a){this.col1.SetV(a.col1);this.col2.SetV(a.col2)};b.prototype.AddM=function(a){this.col1.x+=a.col1.x;this.col1.y+=a.col1.y;this.col2.x+=a.col2.x;this.col2.y+=a.col2.y};b.prototype.SetIdentity=function(){this.col1.x=
1;this.col2.x=0;this.col1.y=0;this.col2.y=1};b.prototype.SetZero=function(){this.col1.x=0;this.col2.x=0;this.col1.y=0;this.col2.y=0};b.prototype.GetAngle=function(){return Math.atan2(this.col1.y,this.col1.x)};b.prototype.GetInverse=function(a){var d=this.col1.x,c=this.col2.x,e=this.col1.y,f=this.col2.y,b=d*f-c*e;0!=b&&(b=1/b);a.col1.x=b*f;a.col2.x=-b*c;a.col1.y=-b*e;a.col2.y=b*d;return a};b.prototype.Solve=function(a,d,c){d=d||0;c=c||0;var e=this.col1.x,f=this.col2.x,b=this.col1.y,h=this.col2.y,g=
e*h-f*b;0!=g&&(g=1/g);a.x=g*(h*d-f*c);a.y=g*(e*c-b*d);return a};b.prototype.Abs=function(){this.col1.Abs();this.col2.Abs()};return b}();t.Common.Math.b2Mat33=W=function(){function b(a,d,c){this.col1=new J;this.col2=new J;this.col3=new J;a=a||null;d=d||null;c=c||null;a||d||c?(this.col1.SetV(a),this.col2.SetV(d),this.col3.SetV(c)):(this.col1.SetZero(),this.col2.SetZero(),this.col3.SetZero())}"use strict;";b.prototype.SetVVV=function(a,d,c){this.col1.SetV(a);this.col2.SetV(d);this.col3.SetV(c)};b.prototype.Copy=
function(){return new b(this.col1,this.col2,this.col3)};b.prototype.SetM=function(a){this.col1.SetV(a.col1);this.col2.SetV(a.col2);this.col3.SetV(a.col3)};b.prototype.AddM=function(a){this.col1.x+=a.col1.x;this.col1.y+=a.col1.y;this.col1.z+=a.col1.z;this.col2.x+=a.col2.x;this.col2.y+=a.col2.y;this.col2.z+=a.col2.z;this.col3.x+=a.col3.x;this.col3.y+=a.col3.y;this.col3.z+=a.col3.z};b.prototype.SetIdentity=function(){this.col1.x=1;this.col2.x=0;this.col3.x=0;this.col1.y=0;this.col2.y=1;this.col3.y=0;
this.col1.z=0;this.col2.z=0;this.col3.z=1};b.prototype.SetZero=function(){this.col1.x=0;this.col2.x=0;this.col3.x=0;this.col1.y=0;this.col2.y=0;this.col3.y=0;this.col1.z=0;this.col2.z=0;this.col3.z=0};b.prototype.Solve22=function(a,d,c){d=d||0;c=c||0;var e=this.col1.x,f=this.col2.x,b=this.col1.y,h=this.col2.y,g=e*h-f*b;0!=g&&(g=1/g);a.x=g*(h*d-f*c);a.y=g*(e*c-b*d);return a};b.prototype.Solve33=function(a,d,c,e){d=d||0;c=c||0;e=e||0;var f=this.col1.x,b=this.col1.y,h=this.col1.z,g=this.col2.x,l=this.col2.y,
m=this.col2.z,q=this.col3.x,z=this.col3.y,B=this.col3.z,p=f*(l*B-m*z)+b*(m*q-g*B)+h*(g*z-l*q);0!=p&&(p=1/p);a.x=p*(d*(l*B-m*z)+c*(m*q-g*B)+e*(g*z-l*q));a.y=p*(f*(c*B-e*z)+b*(e*q-d*B)+h*(d*z-c*q));a.z=p*(f*(l*e-m*c)+b*(m*d-g*e)+h*(g*c-l*d));return a};return b}();t.Common.Math.b2Sweep=T=function(){function b(){this.localCenter=new p;this.c0=new p;this.c=new p}"use strict;";b.prototype.Set=function(a){this.localCenter.SetV(a.localCenter);this.c0.SetV(a.c0);this.c.SetV(a.c);this.a0=a.a0;this.a=a.a;this.t0=
a.t0};b.prototype.Copy=function(){var a=new b;a.localCenter.SetV(this.localCenter);a.c0.SetV(this.c0);a.c.SetV(this.c);a.a0=this.a0;a.a=this.a;a.t0=this.t0;return a};b.prototype.GetTransform=function(a,d){d=d||0;a.position.x=(1-d)*this.c0.x+d*this.c.x;a.position.y=(1-d)*this.c0.y+d*this.c.y;a.R.Set((1-d)*this.a0+d*this.a);var c=a.R;a.position.x-=c.col1.x*this.localCenter.x+c.col2.x*this.localCenter.y;a.position.y-=c.col1.y*this.localCenter.x+c.col2.y*this.localCenter.y};b.prototype.Advance=function(a){a=
a||0;if(this.t0<a&&1-this.t0>Number.MIN_VALUE){var d=(a-this.t0)/(1-this.t0);this.c0.x=(1-d)*this.c0.x+d*this.c.x;this.c0.y=(1-d)*this.c0.y+d*this.c.y;this.a0=(1-d)*this.a0+d*this.a;this.t0=a}};return b}();t.Common.Math.b2Transform=N=function(){function b(a,d){this.position=new p;this.R=new C;a=a||null;d=d||null;a&&(this.position.SetV(a),this.R.SetM(d))}"use strict;";b.prototype.Initialize=function(a,d){this.position.SetV(a);this.R.SetM(d)};b.prototype.SetIdentity=function(){this.position.SetZero();
this.R.SetIdentity()};b.prototype.Set=function(a){this.position.SetV(a.position);this.R.SetM(a.R)};b.prototype.GetAngle=function(){return Math.atan2(this.R.col1.y,this.R.col1.x)};return b}();t.Common.Math.b2Math=r=function(){function b(){}"use strict;";b.b2Vec2_zero=new p(0,0);b.b2Mat22_identity=C.FromVV(new p(1,0),new p(0,1));b.IsValid=function(a){return isFinite(a||0)};b.Dot=function(a,d){return a.x*d.x+a.y*d.y};b.CrossVV=function(a,d){return a.x*d.y-a.y*d.x};b.CrossVF=function(a,d){d=d||0;return new p(d*
a.y,-d*a.x)};b.CrossFV=function(a,d){a=a||0;return new p(-a*d.y,a*d.x)};b.MulMV=function(a,d){return new p(a.col1.x*d.x+a.col2.x*d.y,a.col1.y*d.x+a.col2.y*d.y)};b.MulTMV=function(a,d){return new p(b.Dot(d,a.col1),b.Dot(d,a.col2))};b.MulX=function(a,d){var c=b.MulMV(a.R,d);c.x+=a.position.x;c.y+=a.position.y;return c};b.MulXT=function(a,d){var c=b.SubtractVV(d,a.position),e=c.x*a.R.col1.x+c.y*a.R.col1.y;c.y=c.x*a.R.col2.x+c.y*a.R.col2.y;c.x=e;return c};b.AddVV=function(a,d){return new p(a.x+d.x,a.y+
d.y)};b.SubtractVV=function(a,d){return new p(a.x-d.x,a.y-d.y)};b.Distance=function(a,d){var c=a.x-d.x,e=a.y-d.y;return Math.sqrt(c*c+e*e)};b.DistanceSquared=function(a,d){var c=a.x-d.x,e=a.y-d.y;return c*c+e*e};b.MulFV=function(a,d){a=a||0;return new p(a*d.x,a*d.y)};b.AddMM=function(a,d){return C.FromVV(b.AddVV(a.col1,d.col1),b.AddVV(a.col2,d.col2))};b.MulMM=function(a,d){return C.FromVV(b.MulMV(a,d.col1),b.MulMV(a,d.col2))};b.MulTMM=function(a,d){var c=new p(b.Dot(a.col1,d.col1),b.Dot(a.col2,d.col1)),
e=new p(b.Dot(a.col1,d.col2),b.Dot(a.col2,d.col2));return C.FromVV(c,e)};b.Abs=function(a){a=a||0;return 0<a?a:-a};b.AbsV=function(a){return new p(b.Abs(a.x),b.Abs(a.y))};b.AbsM=function(a){return C.FromVV(b.AbsV(a.col1),b.AbsV(a.col2))};b.Min=function(a,d){a=a||0;d=d||0;return a<d?a:d};b.MinV=function(a,d){return new p(b.Min(a.x,d.x),b.Min(a.y,d.y))};b.Max=function(a,d){a=a||0;d=d||0;return a>d?a:d};b.MaxV=function(a,d){return new p(b.Max(a.x,d.x),b.Max(a.y,d.y))};b.Clamp=function(a,d,c){a=a||0;
d=d||0;c=c||0;return a<d?d:a>c?c:a};b.ClampV=function(a,d,c){return b.MaxV(d,b.MinV(a,c))};b.Swap=function(a,d){var c=a[0];a[0]=d[0];d[0]=c};b.Random=function(){return 2*Math.random()-1};b.RandomRange=function(a,d){a=a||0;d=d||0;var c=Math.random();return(d-a)*c+a};b.NextPowerOfTwo=function(a){a=a||0;a|=a>>1&2147483647;a|=a>>2&1073741823;a|=a>>4&268435455;a|=a>>8&16777215;return(a|a>>16&65535)+1};b.IsPowerOfTwo=function(a){a=a||0;return 0<a&&0==(a&a-1)};b.b2Transform_identity=new N(b.b2Vec2_zero,
b.b2Mat22_identity);return b}();t.Collision.Shapes.b2Shape=A=function(){function b(){}"use strict;";b.e_unknownShape=-1;b.e_circleShape=0;b.e_polygonShape=1;b.e_edgeShape=2;b.e_shapeTypeCount=3;b.e_hitCollide=1;b.e_missCollide=0;b.e_startsInsideCollide=-1;b.prototype.m_type=b.e_unknownShape;b.prototype.m_radius=u.b2_linearSlop;b.TestOverlap=function(a,d,c,e){var f=new ma;f.proxyA=new V;f.proxyA.Set(a);f.proxyB=new V;f.proxyB.Set(c);f.transformA=d;f.transformB=e;f.useRadii=!0;a=new wa;a.count=0;d=
new na;la.Distance(d,a,f);return d.distance<10*Number.MIN_VALUE};b.prototype.Copy=function(){return null};b.prototype.Set=function(a){this.m_radius=a.m_radius};b.prototype.GetType=function(){return this.m_type};b.prototype.TestPoint=function(a,d){return!1};b.prototype.RayCast=function(a,d,c){return!1};b.prototype.ComputeAABB=function(a,d){};b.prototype.ComputeMass=function(a,d){};b.prototype.ComputeSubmergedArea=function(a,d,c,e){return 0};return b}();P=t.Collision.Shapes.b2CircleShape=function(b){function a(d){this.m_p=
new p;this.m_radius=d||0}"use strict;";E(a,b);a.prototype.m_type=A.e_circleShape;a.prototype.m_p=null;a.prototype.Copy=function(){var d=new a;d.Set(this);return d};a.prototype.Set=function(d){a.__super__.Set.call(this,d);t.is(d,a)&&this.m_p.SetV((d instanceof a?d:null).m_p)};a.prototype.TestPoint=function(d,a){var e=d.R,f=d.position.x+(e.col1.x*this.m_p.x+e.col2.x*this.m_p.y),e=d.position.y+(e.col1.y*this.m_p.x+e.col2.y*this.m_p.y),f=a.x-f,e=a.y-e;return f*f+e*e<=this.m_radius*this.m_radius};a.prototype.RayCast=
function(d,a,e){var f=e.R,b=a.p1.x-(e.position.x+(f.col1.x*this.m_p.x+f.col2.x*this.m_p.y));e=a.p1.y-(e.position.y+(f.col1.y*this.m_p.x+f.col2.y*this.m_p.y));var f=a.p2.x-a.p1.x,h=a.p2.y-a.p1.y,g=b*f+e*h,l=f*f+h*h,m=g*g-l*(b*b+e*e-this.m_radius*this.m_radius);if(0>m||l<Number.MIN_VALUE)return!1;g=-(g+Math.sqrt(m));return 0<=g&&g<=a.maxFraction*l?(g/=l,d.fraction=g,d.normal.x=b+g*f,d.normal.y=e+g*h,d.normal.Normalize(),!0):!1};a.prototype.ComputeAABB=function(d,a){var e=a.R,f=a.position.x+(e.col1.x*
this.m_p.x+e.col2.x*this.m_p.y),e=a.position.y+(e.col1.y*this.m_p.x+e.col2.y*this.m_p.y);d.lowerBound.Set(f-this.m_radius,e-this.m_radius);d.upperBound.Set(f+this.m_radius,e+this.m_radius)};a.prototype.ComputeMass=function(d,a){d.mass=(a||0)*u.b2_pi*this.m_radius*this.m_radius;d.center.SetV(this.m_p);d.I=d.mass*(.5*this.m_radius*this.m_radius+(this.m_p.x*this.m_p.x+this.m_p.y*this.m_p.y))};a.prototype.ComputeSubmergedArea=function(d,a,e,f){a=a||0;e=r.MulX(e,this.m_p);var b=-(r.Dot(d,e)-a);if(b<-this.m_radius+
Number.MIN_VALUE)return 0;if(b>this.m_radius)return f.SetV(e),Math.PI*this.m_radius*this.m_radius;a=this.m_radius*this.m_radius;var h=b*b,b=a*(Math.asin(b/this.m_radius)+Math.PI/2)+b*Math.sqrt(a-h);a=-2/3*Math.pow(a-h,1.5)/b;f.x=e.x+d.x*a;f.y=e.y+d.y*a;return b};a.prototype.GetLocalPosition=function(){return this.m_p};a.prototype.SetLocalPosition=function(d){this.m_p.SetV(d)};a.prototype.GetRadius=function(){return this.m_radius};a.prototype.SetRadius=function(d){this.m_radius=d||0};a.prototype.GetType=
function(){return this.m_type};a.prototype.b2Shape=function(){this.m_type=A.e_unknownShape;this.m_radius=u.b2_linearSlop};return a}(A);S=t.Collision.Shapes.b2PolygonShape=function(b){function a(){a.__super__.constructor.call(this);this.m_type=A.e_polygonShape;this.m_centroid=new p;this.m_vertices=new y;this.m_normals=new y}"use strict;";E(a,b);a.s_mat=new C;a.AsArray=function(d,c){c=c||0;var e=new a;e.SetAsArray(d,c);return e};a.AsVector=function(d,c){c=c||0;var e=new a;e.SetAsVector(d,c);return e};
a.AsBox=function(d,c){d=d||0;c=c||0;var e=new a;e.SetAsBox(d,c);return e};a.AsOrientedBox=function(d,c,e,f){d=d||0;c=c||0;e=e||null;f=f||0;var b=new a;b.SetAsOrientedBox(d,c,e,f);return b};a.AsEdge=function(d,c){var e=new a;e.SetAsEdge(d,c);return e};a.ComputeCentroid=function(d,a){a=a||0;for(var e=new p,f=0,b=1/3,h=0;h<a;++h){var g=d[h],l=h+1<a?d[parseInt(h+1)]:d[0],m=.5*((g.x-0)*(l.y-0)-(g.y-0)*(l.x-0)),f=f+m;e.x+=m*b*(0+g.x+l.x);e.y+=m*b*(0+g.y+l.y)}e.x*=1/f;e.y*=1/f;return e};a.ComputeOBB=function(d,
a,e){e=e||0;for(var f=0,b=new y(e+1),f=0;f<e;++f)b[f]=a[f];b[e]=b[0];a=Number.MAX_VALUE;for(f=1;f<=e;++f){for(var h=b[parseInt(f-1)],g=b[f].x-h.x,l=b[f].y-h.y,m=Math.sqrt(g*g+l*l),g=g/m,l=l/m,q=-l,z=g,B=m=Number.MAX_VALUE,p=-Number.MAX_VALUE,n=-Number.MAX_VALUE,r=0;r<e;++r){var u=b[r].x-h.x,t=b[r].y-h.y,v=g*u+l*t,u=q*u+z*t;v<m&&(m=v);u<B&&(B=u);v>p&&(p=v);u>n&&(n=u)}r=(p-m)*(n-B);r<.95*a&&(a=r,d.R.col1.x=g,d.R.col1.y=l,d.R.col2.x=q,d.R.col2.y=z,g=.5*(m+p),l=.5*(B+n),q=d.R,d.center.x=h.x+(q.col1.x*
g+q.col2.x*l),d.center.y=h.y+(q.col1.y*g+q.col2.y*l),d.extents.x=.5*(p-m),d.extents.y=.5*(n-B))}};a.prototype.Copy=function(){var d=new a;d.Set(this);return d};a.prototype.Set=function(d){a.__super__.Set.call(this,d);if(t.is(d,a)){d=d instanceof a?d:null;this.m_centroid.SetV(d.m_centroid);this.m_vertexCount=d.m_vertexCount;this.Reserve(this.m_vertexCount);for(var c=0;c<this.m_vertexCount;c++)this.m_vertices[c].SetV(d.m_vertices[c]),this.m_normals[c].SetV(d.m_normals[c])}};a.prototype.SetAsArray=function(d,
a){a=a||0;for(var e=new y,f=0,b,f=0;f<d.length;++f)b=d[f],e.push(b);this.SetAsVector(e,a)};a.prototype.SetAsVector=function(d,c){c=c||0;0==c&&(c=d.length);u.b2Assert(2<=c);this.m_vertexCount=c;this.Reserve(c);for(var e=0,e=0;e<this.m_vertexCount;e++)this.m_vertices[e].SetV(d[e]);for(e=0;e<this.m_vertexCount;++e){var f=parseInt(e),b=parseInt(e+1<this.m_vertexCount?e+1:0),f=r.SubtractVV(this.m_vertices[b],this.m_vertices[f]);u.b2Assert(f.LengthSquared()>Number.MIN_VALUE);this.m_normals[e].SetV(r.CrossVF(f,
1));this.m_normals[e].Normalize()}this.m_centroid=a.ComputeCentroid(this.m_vertices,this.m_vertexCount)};a.prototype.SetAsBox=function(a,c){a=a||0;c=c||0;this.m_vertexCount=4;this.Reserve(4);this.m_vertices[0].Set(-a,-c);this.m_vertices[1].Set(a,-c);this.m_vertices[2].Set(a,c);this.m_vertices[3].Set(-a,c);this.m_normals[0].Set(0,-1);this.m_normals[1].Set(1,0);this.m_normals[2].Set(0,1);this.m_normals[3].Set(-1,0);this.m_centroid.SetZero()};a.prototype.SetAsOrientedBox=function(a,c,e,f){a=a||0;c=c||
0;e=e||null;f=f||0;this.m_vertexCount=4;this.Reserve(4);this.m_vertices[0].Set(-a,-c);this.m_vertices[1].Set(a,-c);this.m_vertices[2].Set(a,c);this.m_vertices[3].Set(-a,c);this.m_normals[0].Set(0,-1);this.m_normals[1].Set(1,0);this.m_normals[2].Set(0,1);this.m_normals[3].Set(-1,0);this.m_centroid=e;a=new N;a.position=e;a.R.Set(f);for(e=0;e<this.m_vertexCount;++e)this.m_vertices[e]=r.MulX(a,this.m_vertices[e]),this.m_normals[e]=r.MulMV(a.R,this.m_normals[e])};a.prototype.SetAsEdge=function(a,c){this.m_vertexCount=
2;this.Reserve(2);this.m_vertices[0].SetV(a);this.m_vertices[1].SetV(c);this.m_centroid.x=.5*(a.x+c.x);this.m_centroid.y=.5*(a.y+c.y);this.m_normals[0]=r.CrossVF(r.SubtractVV(c,a),1);this.m_normals[0].Normalize();this.m_normals[1].x=-this.m_normals[0].x;this.m_normals[1].y=-this.m_normals[0].y};a.prototype.TestPoint=function(a,c){var e;e=a.R;for(var f=c.x-a.position.x,b=c.y-a.position.y,h=f*e.col1.x+b*e.col1.y,g=f*e.col2.x+b*e.col2.y,l=0;l<this.m_vertexCount;++l)if(e=this.m_vertices[l],f=h-e.x,b=
g-e.y,e=this.m_normals[l],0<e.x*f+e.y*b)return!1;return!0};a.prototype.RayCast=function(a,c,e){var f=0,b=c.maxFraction,h=0,g=0,l,m,h=c.p1.x-e.position.x,g=c.p1.y-e.position.y;l=e.R;var q=h*l.col1.x+g*l.col1.y,z=h*l.col2.x+g*l.col2.y,h=c.p2.x-e.position.x,g=c.p2.y-e.position.y;l=e.R;c=h*l.col1.x+g*l.col1.y-q;l=h*l.col2.x+g*l.col2.y-z;for(var B=-1,p=0;p<this.m_vertexCount;++p){m=this.m_vertices[p];h=m.x-q;g=m.y-z;m=this.m_normals[p];h=m.x*h+m.y*g;g=m.x*c+m.y*l;if(0==g){if(0>h)return!1}else 0>g&&h<f*
g?(f=h/g,B=p):0<g&&h<b*g&&(b=h/g);if(b<f-Number.MIN_VALUE)return!1}return 0<=B?(a.fraction=f,l=e.R,m=this.m_normals[B],a.normal.x=l.col1.x*m.x+l.col2.x*m.y,a.normal.y=l.col1.y*m.x+l.col2.y*m.y,!0):!1};a.prototype.ComputeAABB=function(a,c){for(var e=c.R,f=this.m_vertices[0],b=c.position.x+(e.col1.x*f.x+e.col2.x*f.y),h=c.position.y+(e.col1.y*f.x+e.col2.y*f.y),g=b,l=h,m=1;m<this.m_vertexCount;++m)var f=this.m_vertices[m],q=c.position.x+(e.col1.x*f.x+e.col2.x*f.y),f=c.position.y+(e.col1.y*f.x+e.col2.y*
f.y),b=b<q?b:q,h=h<f?h:f,g=g>q?g:q,l=l>f?l:f;a.lowerBound.x=b-this.m_radius;a.lowerBound.y=h-this.m_radius;a.upperBound.x=g+this.m_radius;a.upperBound.y=l+this.m_radius};a.prototype.ComputeMass=function(a,c){c=c||0;if(2==this.m_vertexCount)a.center.x=.5*(this.m_vertices[0].x+this.m_vertices[1].x),a.center.y=.5*(this.m_vertices[0].y+this.m_vertices[1].y),a.mass=0,a.I=0;else{for(var e=0,f=0,b=0,h=0,g=1/3,l=0;l<this.m_vertexCount;++l)var m=this.m_vertices[l],q=l+1<this.m_vertexCount?this.m_vertices[parseInt(l+
1)]:this.m_vertices[0],z=m.x-0,B=m.y-0,p=q.x-0,n=q.y-0,r=z*n-B*p,u=.5*r,b=b+u,e=e+u*g*(0+m.x+q.x),f=f+u*g*(0+m.y+q.y),m=z,h=h+r*(g*(.25*(m*m+p*m+p*p)+(0*m+0*p))+0+(g*(.25*(B*B+n*B+n*n)+(0*B+0*n))+0));a.mass=c*b;a.center.Set(1/b*e,1/b*f);a.I=c*h}};a.prototype.ComputeSubmergedArea=function(a,c,e,f){c=c||0;var b=r.MulTMV(e.R,a),h=c-r.Dot(a,e.position),g=new I,l=0,m=-1;c=-1;var q=!1;for(a=a=0;a<this.m_vertexCount;++a){g[a]=r.Dot(b,this.m_vertices[a])-h;var z=g[a]<-Number.MIN_VALUE;0<a&&(z?q||(m=a-1,l++):
q&&(c=a-1,l++));q=z}switch(l){case 0:return q?(a=new ra,this.ComputeMass(a,1),f.SetV(r.MulX(e,a.center)),a.mass):0;case 1:-1==m?m=this.m_vertexCount-1:c=this.m_vertexCount-1}a=parseInt((m+1)%this.m_vertexCount);b=parseInt((c+1)%this.m_vertexCount);h=(0-g[m])/(g[a]-g[m]);g=(0-g[c])/(g[b]-g[c]);m=new p(this.m_vertices[m].x*(1-h)+this.m_vertices[a].x*h,this.m_vertices[m].y*(1-h)+this.m_vertices[a].y*h);c=new p(this.m_vertices[c].x*(1-g)+this.m_vertices[b].x*g,this.m_vertices[c].y*(1-g)+this.m_vertices[b].y*
g);g=0;h=new p;for(l=this.m_vertices[a];a!=b;)a=(a+1)%this.m_vertexCount,q=a==b?c:this.m_vertices[a],z=.5*((l.x-m.x)*(q.y-m.y)-(l.y-m.y)*(q.x-m.x)),g+=z,h.x+=z*(m.x+l.x+q.x)/3,h.y+=z*(m.y+l.y+q.y)/3,l=q;h.Multiply(1/g);f.SetV(r.MulX(e,h));return g};a.prototype.GetVertexCount=function(){return this.m_vertexCount};a.prototype.GetVertices=function(){return this.m_vertices};a.prototype.GetNormals=function(){return this.m_normals};a.prototype.GetSupport=function(a){for(var c=0,e=this.m_vertices[0].x*a.x+
this.m_vertices[0].y*a.y,f=1;f<this.m_vertexCount;++f){var b=this.m_vertices[f].x*a.x+this.m_vertices[f].y*a.y;b>e&&(c=f,e=b)}return c};a.prototype.GetSupportVertex=function(a){for(var c=0,e=this.m_vertices[0].x*a.x+this.m_vertices[0].y*a.y,f=1;f<this.m_vertexCount;++f){var b=this.m_vertices[f].x*a.x+this.m_vertices[f].y*a.y;b>e&&(c=f,e=b)}return this.m_vertices[c]};a.prototype.Validate=function(){return!1};a.prototype.Reserve=function(a){a=a||0;for(var c=parseInt(this.m_vertices.length);c<a;c++)this.m_vertices[c]=
new p,this.m_normals[c]=new p};a.prototype.GetType=function(){return this.m_type};a.prototype.b2Shape=function(){this.m_type=A.e_unknownShape;this.m_radius=u.b2_linearSlop};return a}(A);t.Collision.Shapes.b2EdgeChainDef=function(){"use strict;";return function(){this.vertexCount=0;this.isALoop=!0;this.vertices=[]}}();aa=t.Collision.Shapes.b2EdgeShape=function(b){function a(d,c){this.s_supportVec=new p;this.m_v1=new p;this.m_v2=new p;this.m_coreV1=new p;this.m_coreV2=new p;this.m_normal=new p;this.m_direction=
new p;this.m_cornerDir1=new p;this.m_cornerDir2=new p;a.__super__.constructor.call(this);this.m_type=A.e_edgeShape;this.m_nextEdge=this.m_prevEdge=null;this.m_v1=d;this.m_v2=c;this.m_direction.Set(this.m_v2.x-this.m_v1.x,this.m_v2.y-this.m_v1.y);this.m_length=this.m_direction.Normalize();this.m_normal.Set(this.m_direction.y,-this.m_direction.x);this.m_coreV1.Set(-u.b2_toiSlop*(this.m_normal.x-this.m_direction.x)+this.m_v1.x,-u.b2_toiSlop*(this.m_normal.y-this.m_direction.y)+this.m_v1.y);this.m_coreV2.Set(-u.b2_toiSlop*
(this.m_normal.x+this.m_direction.x)+this.m_v2.x,-u.b2_toiSlop*(this.m_normal.y+this.m_direction.y)+this.m_v2.y);this.m_cornerDir1=this.m_normal;this.m_cornerDir2.Set(-this.m_normal.x,-this.m_normal.y)}"use strict;";E(a,b);a.prototype.TestPoint=function(a,c){return!1};a.prototype.RayCast=function(a,c,e){var f,b=c.p2.x-c.p1.x,h=c.p2.y-c.p1.y;f=e.R;var g=e.position.x+(f.col1.x*this.m_v1.x+f.col2.x*this.m_v1.y),l=e.position.y+(f.col1.y*this.m_v1.x+f.col2.y*this.m_v1.y),m=e.position.y+(f.col1.y*this.m_v2.x+
f.col2.y*this.m_v2.y)-l;e=-(e.position.x+(f.col1.x*this.m_v2.x+f.col2.x*this.m_v2.y)-g);f=100*Number.MIN_VALUE;var q=-(b*m+h*e);if(q>f){var g=c.p1.x-g,z=c.p1.y-l,l=g*m+z*e;if(0<=l&&l<=c.maxFraction*q&&(c=-b*z+h*g,-f*q<=c&&c<=q*(1+f)))return a.fraction=l/q,c=Math.sqrt(m*m+e*e),a.normal.x=m/c,a.normal.y=e/c,!0}return!1};a.prototype.ComputeAABB=function(a,c){var e=c.R,f=c.position.x+(e.col1.x*this.m_v1.x+e.col2.x*this.m_v1.y),b=c.position.y+(e.col1.y*this.m_v1.x+e.col2.y*this.m_v1.y),h=c.position.x+
(e.col1.x*this.m_v2.x+e.col2.x*this.m_v2.y),e=c.position.y+(e.col1.y*this.m_v2.x+e.col2.y*this.m_v2.y);f<h?(a.lowerBound.x=f,a.upperBound.x=h):(a.lowerBound.x=h,a.upperBound.x=f);b<e?(a.lowerBound.y=b,a.upperBound.y=e):(a.lowerBound.y=e,a.upperBound.y=b)};a.prototype.ComputeMass=function(a,c){a.mass=0;a.center.SetV(this.m_v1);a.I=0};a.prototype.ComputeSubmergedArea=function(a,c,e,f){c=c||0;var b=new p(a.x*c,a.y*c),h=r.MulX(e,this.m_v1);e=r.MulX(e,this.m_v2);var g=r.Dot(a,h)-c;a=r.Dot(a,e)-c;if(0<
g){if(0<a)return 0;h.x=-a/(g-a)*h.x+g/(g-a)*e.x;h.y=-a/(g-a)*h.y+g/(g-a)*e.y}else 0<a&&(e.x=-a/(g-a)*h.x+g/(g-a)*e.x,e.y=-a/(g-a)*h.y+g/(g-a)*e.y);f.x=(b.x+h.x+e.x)/3;f.y=(b.y+h.y+e.y)/3;return.5*((h.x-b.x)*(e.y-b.y)-(h.y-b.y)*(e.x-b.x))};a.prototype.GetLength=function(){return this.m_length};a.prototype.GetVertex1=function(){return this.m_v1};a.prototype.GetVertex2=function(){return this.m_v2};a.prototype.GetCoreVertex1=function(){return this.m_coreV1};a.prototype.GetCoreVertex2=function(){return this.m_coreV2};
a.prototype.GetNormalVector=function(){return this.m_normal};a.prototype.GetDirectionVector=function(){return this.m_direction};a.prototype.GetCorner1Vector=function(){return this.m_cornerDir1};a.prototype.GetCorner2Vector=function(){return this.m_cornerDir2};a.prototype.Corner1IsConvex=function(){return this.m_cornerConvex1};a.prototype.Corner2IsConvex=function(){return this.m_cornerConvex2};a.prototype.GetFirstVertex=function(a){var c=a.R;return new p(a.position.x+(c.col1.x*this.m_coreV1.x+c.col2.x*
this.m_coreV1.y),a.position.y+(c.col1.y*this.m_coreV1.x+c.col2.y*this.m_coreV1.y))};a.prototype.GetNextEdge=function(){return this.m_nextEdge};a.prototype.GetPrevEdge=function(){return this.m_prevEdge};a.prototype.Support=function(a,c,e){c=c||0;e=e||0;var f=a.R,b=a.position.x+(f.col1.x*this.m_coreV1.x+f.col2.x*this.m_coreV1.y),h=a.position.y+(f.col1.y*this.m_coreV1.x+f.col2.y*this.m_coreV1.y),g=a.position.x+(f.col1.x*this.m_coreV2.x+f.col2.x*this.m_coreV2.y);a=a.position.y+(f.col1.y*this.m_coreV2.x+
f.col2.y*this.m_coreV2.y);b*c+h*e>g*c+a*e?(this.s_supportVec.x=b,this.s_supportVec.y=h):(this.s_supportVec.x=g,this.s_supportVec.y=a);return this.s_supportVec};a.prototype.SetPrevEdge=function(a,c,e,b){this.m_prevEdge=a;this.m_coreV1=c;this.m_cornerDir1=e;this.m_cornerConvex1=b};a.prototype.SetNextEdge=function(a,c,e,b){this.m_nextEdge=a;this.m_coreV2=c;this.m_cornerDir2=e;this.m_cornerConvex2=b};a.prototype.Copy=function(){return null};a.prototype.Set=function(a){this.m_radius=a.m_radius};a.prototype.GetType=
function(){return this.m_type};a.prototype.b2Shape=function(){this.m_type=A.e_unknownShape;this.m_radius=u.b2_linearSlop};return a}(A);t.Collision.Shapes.b2MassData=ra=function(){"use strict;";return function(){this.mass=0;this.center=new p(0,0);this.I=0}}();t.Collision.Features=xa=function(){"use strict;";return function(){}}();t.Collision.b2ContactID=U=function(){function b(){this.features=new xa;this.features._m_id=this}"use strict;";b.prototype.Set=function(a){this.key=a._key};b.prototype.Copy=
function(){var a=new b;a.key=this.key;return a};return b}();t.Collision.ClipVertex=ga=function(){function b(){this.v=new p;this.id=new U}"use strict;";b.prototype.Set=function(a){this.v.SetV(a.v);this.id.Set(a.id)};return b}();t.Collision.b2AABB=K=function(){function b(){this.lowerBound=new p;this.upperBound=new p}"use strict;";b.Combine=function(a,d){var c=new b;c.Combine(a,d);return c};b.prototype.IsValid=function(){var a=this.upperBound.y-this.lowerBound.y;return a=(a=0<=this.upperBound.x-this.lowerBound.x&&
0<=a)&&this.lowerBound.IsValid()&&this.upperBound.IsValid()};b.prototype.GetCenter=function(){return new p((this.lowerBound.x+this.upperBound.x)/2,(this.lowerBound.y+this.upperBound.y)/2)};b.prototype.GetExtents=function(){return new p((this.upperBound.x-this.lowerBound.x)/2,(this.upperBound.y-this.lowerBound.y)/2)};b.prototype.Contains=function(a){var d;return d=(d=(d=(d=this.lowerBound.x<=a.lowerBound.x)&&this.lowerBound.y<=a.lowerBound.y)&&a.upperBound.x<=this.upperBound.x)&&a.upperBound.y<=this.upperBound.y};
b.prototype.RayCast=function(a,d){var c=-Number.MAX_VALUE,e=Number.MAX_VALUE,b=d.p1.x,k=d.p1.y,h=d.p2.x-d.p1.x,g=d.p2.y-d.p1.y,l=Math.abs(h),m=Math.abs(g),q=a.normal,z=0,B=0,p=z=0,p=0;if(l<Number.MIN_VALUE){if(b<this.lowerBound.x||this.upperBound.x<b)return!1}else if(z=1/h,B=(this.lowerBound.x-b)*z,z*=this.upperBound.x-b,p=-1,B>z&&(p=B,B=z,z=p,p=1),B>c&&(q.x=p,q.y=0,c=B),e=Math.min(e,z),c>e)return!1;if(m<Number.MIN_VALUE){if(k<this.lowerBound.y||this.upperBound.y<k)return!1}else if(z=1/g,B=(this.lowerBound.y-
k)*z,z*=this.upperBound.y-k,p=-1,B>z&&(p=B,B=z,z=p,p=1),B>c&&(q.y=p,q.x=0,c=B),e=Math.min(e,z),c>e)return!1;a.fraction=c;return!0};b.prototype.TestOverlap=function(a){var d=a.lowerBound.y-this.upperBound.y,c=this.lowerBound.y-a.upperBound.y;return 0<a.lowerBound.x-this.upperBound.x||0<d||0<this.lowerBound.x-a.upperBound.x||0<c?!1:!0};b.prototype.Combine=function(a,d){this.lowerBound.x=Math.min(a.lowerBound.x,d.lowerBound.x);this.lowerBound.y=Math.min(a.lowerBound.y,d.lowerBound.y);this.upperBound.x=
Math.max(a.upperBound.x,d.upperBound.x);this.upperBound.y=Math.max(a.upperBound.y,d.upperBound.y)};return b}();t.Collision.b2SimplexCache=wa=function(){"use strict;";return function(){this.indexA=new I(3);this.indexB=new I(3)}}();t.Collision.b2Bound=function(){function b(){}"use strict;";b.prototype.IsLower=function(){return 0==(this.value&1)};b.prototype.IsUpper=function(){return 1==(this.value&1)};b.prototype.Swap=function(a){var d=this.value,c=this.proxy,e=this.stabbingCount;this.value=a.value;
this.proxy=a.proxy;this.stabbingCount=a.stabbingCount;a.value=d;a.proxy=c;a.stabbingCount=e};return b}();t.Collision.b2BoundValues=function(){"use strict;";return function(){this.lowerValues=new I;this.lowerValues[0]=0;this.lowerValues[1]=0;this.upperValues=new I;this.upperValues[0]=0;this.upperValues[1]=0}}();t.Collision.b2ManifoldPoint=ba=function(){function b(){this.m_localPoint=new p;this.m_id=new U;this.Reset()}"use strict;";b.prototype.Reset=function(){this.m_localPoint.SetZero();this.m_tangentImpulse=
this.m_normalImpulse=0;this.m_id.key=0};b.prototype.Set=function(a){this.m_localPoint.SetV(a.m_localPoint);this.m_normalImpulse=a.m_normalImpulse;this.m_tangentImpulse=a.m_tangentImpulse;this.m_id.Set(a.m_id)};return b}();t.Collision.b2Manifold=H=function(){function b(){this.m_pointCount=0;this.m_points=new y(u.b2_maxManifoldPoints);for(var a=0;a<u.b2_maxManifoldPoints;a++)this.m_points[a]=new ba;this.m_localPlaneNormal=new p;this.m_localPoint=new p}"use strict;";b.e_circles=1;b.e_faceA=2;b.e_faceB=
4;b.prototype.Reset=function(){for(var a=0;a<u.b2_maxManifoldPoints;a++)(this.m_points[a]instanceof ba?this.m_points[a]:null).Reset();this.m_localPlaneNormal.SetZero();this.m_localPoint.SetZero();this.m_pointCount=this.m_type=0};b.prototype.Set=function(a){this.m_pointCount=a.m_pointCount;for(var d=0;d<u.b2_maxManifoldPoints;d++)(this.m_points[d]instanceof ba?this.m_points[d]:null).Set(a.m_points[d]);this.m_localPlaneNormal.SetV(a.m_localPlaneNormal);this.m_localPoint.SetV(a.m_localPoint);this.m_type=
a.m_type};b.prototype.Copy=function(){var a=new b;a.Set(this);return a};return b}();t.Collision.b2Collision=Y=function(){function b(){}"use strict;";b.s_edgeAO=new I(1);b.s_edgeBO=new I(1);b.s_localTangent=new p;b.s_localNormal=new p;b.s_planePoint=new p;b.s_normal=new p;b.s_tangent=new p;b.s_tangent2=new p;b.s_v11=new p;b.s_v12=new p;b.b2CollidePolyTempVec=new p;b.b2_nullFeature=255;b.ClipSegmentToLine=function(a,d,c,e){e=e||0;var b,k=0;b=d[0];var h=b.v;b=d[1];var g=b.v,l=c.x*h.x+c.y*h.y-e;b=c.x*
g.x+c.y*g.y-e;0>=l&&a[k++].Set(d[0]);0>=b&&a[k++].Set(d[1]);0>l*b&&(c=l/(l-b),b=a[k],b=b.v,b.x=h.x+c*(g.x-h.x),b.y=h.y+c*(g.y-h.y),b=a[k],b.id=(0<l?d[0]:d[1]).id,++k);return k};b.EdgeSeparation=function(a,d,c,e,b){c=c||0;parseInt(a.m_vertexCount);var k=a.m_vertices;a=a.m_normals;var h=parseInt(e.m_vertexCount),g=e.m_vertices,l,m;l=d.R;m=a[c];a=l.col1.x*m.x+l.col2.x*m.y;e=l.col1.y*m.x+l.col2.y*m.y;l=b.R;var q=l.col1.x*a+l.col1.y*e;l=l.col2.x*a+l.col2.y*e;for(var z=0,B=Number.MAX_VALUE,p=0;p<h;++p)m=
g[p],m=m.x*q+m.y*l,m<B&&(B=m,z=p);m=k[c];l=d.R;c=d.position.x+(l.col1.x*m.x+l.col2.x*m.y);d=d.position.y+(l.col1.y*m.x+l.col2.y*m.y);m=g[z];l=b.R;k=b.position.x+(l.col1.x*m.x+l.col2.x*m.y);b=b.position.y+(l.col1.y*m.x+l.col2.y*m.y);return(k-c)*a+(b-d)*e};b.FindMaxSeparation=function(a,d,c,e,f){var k=parseInt(d.m_vertexCount),h=d.m_normals,g,l;l=f.R;g=e.m_centroid;var m=f.position.x+(l.col1.x*g.x+l.col2.x*g.y),q=f.position.y+(l.col1.y*g.x+l.col2.y*g.y);l=c.R;g=d.m_centroid;m-=c.position.x+(l.col1.x*
g.x+l.col2.x*g.y);q-=c.position.y+(l.col1.y*g.x+l.col2.y*g.y);l=m*c.R.col1.x+q*c.R.col1.y;for(var q=m*c.R.col2.x+q*c.R.col2.y,m=0,z=-Number.MAX_VALUE,p=0;p<k;++p)g=h[p],g=g.x*l+g.y*q,g>z&&(z=g,m=p);h=b.EdgeSeparation(d,c,m,e,f);g=parseInt(0<=m-1?m-1:k-1);l=b.EdgeSeparation(d,c,g,e,f);var q=parseInt(m+1<k?m+1:0),z=b.EdgeSeparation(d,c,q,e,f),n=p=0,r=0;if(l>h&&l>z)r=-1,p=g,n=l;else if(z>h)r=1,p=q,n=z;else return a[0]=m,h;for(;;)if(m=-1==r?0<=p-1?p-1:k-1:p+1<k?p+1:0,h=b.EdgeSeparation(d,c,m,e,f),h>n)p=
m,n=h;else break;a[0]=p;return n};b.FindIncidentEdge=function(a,d,c,e,b,k){e=e||0;parseInt(d.m_vertexCount);var h=d.m_normals,g=parseInt(b.m_vertexCount);d=b.m_vertices;b=b.m_normals;var l;l=c.R;c=h[e];var h=l.col1.x*c.x+l.col2.x*c.y,m=l.col1.y*c.x+l.col2.y*c.y;l=k.R;c=l.col1.x*h+l.col1.y*m;m=l.col2.x*h+l.col2.y*m;h=c;l=0;for(var q=Number.MAX_VALUE,z=0;z<g;++z)c=b[z],c=h*c.x+m*c.y,c<q&&(q=c,l=z);b=parseInt(l);h=parseInt(b+1<g?b+1:0);g=a[0];c=d[b];l=k.R;g.v.x=k.position.x+(l.col1.x*c.x+l.col2.x*c.y);
g.v.y=k.position.y+(l.col1.y*c.x+l.col2.y*c.y);g.id.features.referenceEdge=e;g.id.features.incidentEdge=b;g.id.features.incidentVertex=0;g=a[1];c=d[h];l=k.R;g.v.x=k.position.x+(l.col1.x*c.x+l.col2.x*c.y);g.v.y=k.position.y+(l.col1.y*c.x+l.col2.y*c.y);g.id.features.referenceEdge=e;g.id.features.incidentEdge=h;g.id.features.incidentVertex=1};b.MakeClipPointVector=function(){var a=new y(2);a[0]=new ga;a[1]=new ga;return a};b.CollidePolygons=function(a,d,c,e,f){var k;a.m_pointCount=0;var h=d.m_radius+
e.m_radius;b.s_edgeAO[0]=0;var g=b.FindMaxSeparation(b.s_edgeAO,d,c,e,f);k=b.s_edgeAO[0];if(!(g>h)){var l;b.s_edgeBO[0]=0;var m=b.FindMaxSeparation(b.s_edgeBO,e,f,d,c);l=b.s_edgeBO[0];if(!(m>h)){var q=0,z=0;m>.98*g+.001?(g=e,e=d,d=f,q=l,a.m_type=H.e_faceB,z=1):(g=d,d=c,c=f,q=k,a.m_type=H.e_faceA,z=0);k=b.s_incidentEdge;b.FindIncidentEdge(k,g,d,q,e,c);l=parseInt(g.m_vertexCount);f=g.m_vertices;var g=f[q],p;p=q+1<l?f[parseInt(q+1)]:f[0];q=b.s_localTangent;q.Set(p.x-g.x,p.y-g.y);q.Normalize();f=b.s_localNormal;
f.x=q.y;f.y=-q.x;e=b.s_planePoint;e.Set(.5*(g.x+p.x),.5*(g.y+p.y));m=b.s_tangent;l=d.R;m.x=l.col1.x*q.x+l.col2.x*q.y;m.y=l.col1.y*q.x+l.col2.y*q.y;var n=b.s_tangent2;n.x=-m.x;n.y=-m.y;q=b.s_normal;q.x=m.y;q.y=-m.x;var r=b.s_v11,x=b.s_v12;r.x=d.position.x+(l.col1.x*g.x+l.col2.x*g.y);r.y=d.position.y+(l.col1.y*g.x+l.col2.y*g.y);x.x=d.position.x+(l.col1.x*p.x+l.col2.x*p.y);x.y=d.position.y+(l.col1.y*p.x+l.col2.y*p.y);d=q.x*r.x+q.y*r.y;l=m.x*x.x+m.y*x.y+h;p=b.s_clipPoints1;g=b.s_clipPoints2;x=0;x=b.ClipSegmentToLine(p,
k,n,-m.x*r.x-m.y*r.y+h);if(!(2>x||(x=b.ClipSegmentToLine(g,p,m,l),2>x))){a.m_localPlaneNormal.SetV(f);a.m_localPoint.SetV(e);for(e=f=0;e<u.b2_maxManifoldPoints;++e)k=g[e],q.x*k.v.x+q.y*k.v.y-d<=h&&(m=a.m_points[f],l=c.R,n=k.v.x-c.position.x,r=k.v.y-c.position.y,m.m_localPoint.x=n*l.col1.x+r*l.col1.y,m.m_localPoint.y=n*l.col2.x+r*l.col2.y,m.m_id.Set(k.id),m.m_id.features.flip=z,++f);a.m_pointCount=f}}}};b.CollideCircles=function(a,d,c,e,b){a.m_pointCount=0;var k,h;k=c.R;h=d.m_p;var g=c.position.x+
(k.col1.x*h.x+k.col2.x*h.y);c=c.position.y+(k.col1.y*h.x+k.col2.y*h.y);k=b.R;h=e.m_p;g=b.position.x+(k.col1.x*h.x+k.col2.x*h.y)-g;b=b.position.y+(k.col1.y*h.x+k.col2.y*h.y)-c;k=d.m_radius+e.m_radius;g*g+b*b>k*k||(a.m_type=H.e_circles,a.m_localPoint.SetV(d.m_p),a.m_localPlaneNormal.SetZero(),a.m_pointCount=1,a.m_points[0].m_localPoint.SetV(e.m_p),a.m_points[0].m_id.key=0)};b.CollidePolygonAndCircle=function(a,d,c,e,b){var k=a.m_pointCount=0,h=0,g,l;l=b.R;g=e.m_p;var m=b.position.y+(l.col1.y*g.x+l.col2.y*
g.y),k=b.position.x+(l.col1.x*g.x+l.col2.x*g.y)-c.position.x,h=m-c.position.y;l=c.R;c=k*l.col1.x+h*l.col1.y;l=k*l.col2.x+h*l.col2.y;var q=0,m=-Number.MAX_VALUE;b=d.m_radius+e.m_radius;var p=parseInt(d.m_vertexCount),B=d.m_vertices;d=d.m_normals;for(var n=0;n<p;++n){g=B[n];k=c-g.x;h=l-g.y;g=d[n];k=g.x*k+g.y*h;if(k>b)return;k>m&&(m=k,q=n)}k=parseInt(q);h=parseInt(k+1<p?k+1:0);g=B[k];B=B[h];m<Number.MIN_VALUE?(a.m_pointCount=1,a.m_type=H.e_faceA,a.m_localPlaneNormal.SetV(d[q]),a.m_localPoint.x=.5*(g.x+
B.x),a.m_localPoint.y=.5*(g.y+B.y),a.m_points[0].m_localPoint.SetV(e.m_p),a.m_points[0].m_id.key=0):(m=(c-B.x)*(g.x-B.x)+(l-B.y)*(g.y-B.y),0>=(c-g.x)*(B.x-g.x)+(l-g.y)*(B.y-g.y)?(c-g.x)*(c-g.x)+(l-g.y)*(l-g.y)>b*b||(a.m_pointCount=1,a.m_type=H.e_faceA,a.m_localPlaneNormal.x=c-g.x,a.m_localPlaneNormal.y=l-g.y,a.m_localPlaneNormal.Normalize(),a.m_localPoint.SetV(g),a.m_points[0].m_localPoint.SetV(e.m_p),a.m_points[0].m_id.key=0):0>=m?(c-B.x)*(c-B.x)+(l-B.y)*(l-B.y)>b*b||(a.m_pointCount=1,a.m_type=H.e_faceA,
a.m_localPlaneNormal.x=c-B.x,a.m_localPlaneNormal.y=l-B.y,a.m_localPlaneNormal.Normalize(),a.m_localPoint.SetV(B),a.m_points[0].m_localPoint.SetV(e.m_p),a.m_points[0].m_id.key=0):(q=.5*(g.x+B.x),g=.5*(g.y+B.y),m=(c-q)*d[k].x+(l-g)*d[k].y,m>b||(a.m_pointCount=1,a.m_type=H.e_faceA,a.m_localPlaneNormal.x=d[k].x,a.m_localPlaneNormal.y=d[k].y,a.m_localPlaneNormal.Normalize(),a.m_localPoint.Set(q,g),a.m_points[0].m_localPoint.SetV(e.m_p),a.m_points[0].m_id.key=0)))};b.TestOverlap=function(a,d){var c=d.lowerBound,
e=a.upperBound,b=c.x-e.x,k=c.y-e.y,c=a.lowerBound,e=d.upperBound,h=c.y-e.y;return 0<b||0<k||0<c.x-e.x||0<h?!1:!0};b.s_clipPoints2=b.MakeClipPointVector();b.s_clipPoints1=b.MakeClipPointVector();b.s_incidentEdge=b.MakeClipPointVector();return b}();t.Collision.b2ContactPoint=Ea=function(){"use strict;";return function(){this.position=new p;this.velocity=new p;this.normal=new p;this.id=new U}}();t.Collision.b2SimplexVertex=ea=function(){function b(){}"use strict;";b.prototype.Set=function(a){this.wA.SetV(a.wA);
this.wB.SetV(a.wB);this.w.SetV(a.w);this.a=a.a;this.indexA=a.indexA;this.indexB=a.indexB};return b}();t.Collision.b2Simplex=db=function(){function b(){this.m_v1=new ea;this.m_v2=new ea;this.m_v3=new ea;this.m_vertices=new y(3);this.m_vertices[0]=this.m_v1;this.m_vertices[1]=this.m_v2;this.m_vertices[2]=this.m_v3}"use strict;";b.prototype.ReadCache=function(a,d,c,e,b){u.b2Assert(0<=a.count&&3>=a.count);var k,h;this.m_count=a.count;for(var g=this.m_vertices,l=0;l<this.m_count;l++){var m=g[l];m.indexA=
a.indexA[l];m.indexB=a.indexB[l];k=d.GetVertex(m.indexA);h=e.GetVertex(m.indexB);m.wA=r.MulX(c,k);m.wB=r.MulX(b,h);m.w=r.SubtractVV(m.wB,m.wA);m.a=0}1<this.m_count&&(a=a.metric,k=this.GetMetric(),k<.5*a||2*a<k||k<Number.MIN_VALUE)&&(this.m_count=0);0==this.m_count&&(m=g[0],m.indexA=0,m.indexB=0,k=d.GetVertex(0),h=e.GetVertex(0),m.wA=r.MulX(c,k),m.wB=r.MulX(b,h),m.w=r.SubtractVV(m.wB,m.wA),this.m_count=1)};b.prototype.WriteCache=function(a){a.metric=this.GetMetric();a.count=t.parseUInt(this.m_count);
for(var d=this.m_vertices,c=0;c<this.m_count;c++)a.indexA[c]=t.parseUInt(d[c].indexA),a.indexB[c]=t.parseUInt(d[c].indexB)};b.prototype.GetSearchDirection=function(){switch(this.m_count){case 1:return this.m_v1.w.GetNegative();case 2:var a=r.SubtractVV(this.m_v2.w,this.m_v1.w);return 0<r.CrossVV(a,this.m_v1.w.GetNegative())?r.CrossFV(1,a):r.CrossVF(a,1);default:return u.b2Assert(!1),new p}};b.prototype.GetClosestPoint=function(){switch(this.m_count){case 0:return u.b2Assert(!1),new p;case 1:return this.m_v1.w;
case 2:return new p(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y);default:return u.b2Assert(!1),new p}};b.prototype.GetWitnessPoints=function(a,d){switch(this.m_count){case 0:u.b2Assert(!1);break;case 1:a.SetV(this.m_v1.wA);d.SetV(this.m_v1.wB);break;case 2:a.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x;a.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y;d.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x;d.y=this.m_v1.a*
this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y;break;case 3:d.x=a.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x;d.y=a.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y;break;default:u.b2Assert(!1)}};b.prototype.GetMetric=function(){switch(this.m_count){case 0:return u.b2Assert(!1),0;case 1:return 0;case 2:return r.SubtractVV(this.m_v1.w,this.m_v2.w).Length();case 3:return r.CrossVV(r.SubtractVV(this.m_v2.w,this.m_v1.w),r.SubtractVV(this.m_v3.w,
this.m_v1.w));default:return u.b2Assert(!1),0}};b.prototype.Solve2=function(){var a=this.m_v1.w,d=this.m_v2.w,c=r.SubtractVV(d,a),a=-(a.x*c.x+a.y*c.y);0>=a?this.m_count=this.m_v1.a=1:(d=d.x*c.x+d.y*c.y,0>=d?(this.m_count=this.m_v2.a=1,this.m_v1.Set(this.m_v2)):(c=1/(d+a),this.m_v1.a=d*c,this.m_v2.a=a*c,this.m_count=2))};b.prototype.Solve3=function(){var a=this.m_v1.w,d=this.m_v2.w,c=this.m_v3.w,e=r.SubtractVV(d,a),b=r.Dot(a,e),k=r.Dot(d,e),b=-b,h=r.SubtractVV(c,a),g=r.Dot(a,h),l=r.Dot(c,h),g=-g,m=
r.SubtractVV(c,d),q=r.Dot(d,m),m=r.Dot(c,m),q=-q,h=r.CrossVV(e,h),e=h*r.CrossVV(d,c),c=h*r.CrossVV(c,a),a=h*r.CrossVV(a,d);0>=b&&0>=g?this.m_count=this.m_v1.a=1:0<k&&0<b&&0>=a?(l=1/(k+b),this.m_v1.a=k*l,this.m_v2.a=b*l,this.m_count=2):0<l&&0<g&&0>=c?(k=1/(l+g),this.m_v1.a=l*k,this.m_v3.a=g*k,this.m_count=2,this.m_v2.Set(this.m_v3)):0>=k&&0>=q?(this.m_count=this.m_v2.a=1,this.m_v1.Set(this.m_v2)):0>=l&&0>=m?(this.m_count=this.m_v3.a=1,this.m_v1.Set(this.m_v3)):0<m&&0<q&&0>=e?(k=1/(m+q),this.m_v2.a=
m*k,this.m_v3.a=q*k,this.m_count=2,this.m_v1.Set(this.m_v3)):(k=1/(e+c+a),this.m_v1.a=e*k,this.m_v2.a=c*k,this.m_v3.a=a*k,this.m_count=3)};return b}();t.Collision.b2Distance=la=function(){function b(){}"use strict;";b.s_simplex=new db;b.s_saveA=new I(3);b.s_saveB=new I(3);b.Distance=function(a,d,c){++b.b2_gjkCalls;var e=c.proxyA,f=c.proxyB,k=c.transformA,h=c.transformB,g=b.s_simplex;g.ReadCache(d,e,k,f,h);var l=g.m_vertices,m=b.s_saveA,q=b.s_saveB,z=0;g.GetClosestPoint().LengthSquared();for(var n=
0,F,D=0;20>D;){z=g.m_count;for(n=0;n<z;n++)m[n]=l[n].indexA,q[n]=l[n].indexB;switch(g.m_count){case 1:break;case 2:g.Solve2();break;case 3:g.Solve3();break;default:u.b2Assert(!1)}if(3==g.m_count)break;F=g.GetClosestPoint();F.LengthSquared();n=g.GetSearchDirection();if(n.LengthSquared()<Number.MIN_VALUE*Number.MIN_VALUE)break;F=l[g.m_count];F.indexA=e.GetSupport(r.MulTMV(k.R,n.GetNegative()));F.wA=r.MulX(k,e.GetVertex(F.indexA));F.indexB=f.GetSupport(r.MulTMV(h.R,n));F.wB=r.MulX(h,f.GetVertex(F.indexB));
F.w=r.SubtractVV(F.wB,F.wA);++D;++b.b2_gjkIters;for(var x=!1,n=0;n<z;n++)if(F.indexA==m[n]&&F.indexB==q[n]){x=!0;break}if(x)break;++g.m_count}b.b2_gjkMaxIters=r.Max(b.b2_gjkMaxIters,D);g.GetWitnessPoints(a.pointA,a.pointB);a.distance=r.SubtractVV(a.pointA,a.pointB).Length();a.iterations=D;g.WriteCache(d);c.useRadii&&(d=e.m_radius,f=f.m_radius,a.distance>d+f&&a.distance>Number.MIN_VALUE?(a.distance-=d+f,c=r.SubtractVV(a.pointB,a.pointA),c.Normalize(),a.pointA.x+=d*c.x,a.pointA.y+=d*c.y,a.pointB.x-=
f*c.x,a.pointB.y-=f*c.y):(F=new p,F.x=.5*(a.pointA.x+a.pointB.x),F.y=.5*(a.pointA.y+a.pointB.y),a.pointA.x=a.pointB.x=F.x,a.pointA.y=a.pointB.y=F.y,a.distance=0))};return b}();t.Collision.b2DistanceInput=ma=function(){"use strict;";return function(){}}();t.Collision.b2DistanceOutput=na=function(){"use strict;";return function(){this.pointA=new p;this.pointB=new p}}();t.Collision.b2DistanceProxy=V=function(){function b(){}"use strict;";b.prototype.Set=function(a){switch(a.GetType()){case A.e_circleShape:a=
a instanceof P?a:null;this.m_vertices=new y(1,!0);this.m_vertices[0]=a.m_p;this.m_count=1;this.m_radius=a.m_radius;break;case A.e_polygonShape:a=a instanceof S?a:null;this.m_vertices=a.m_vertices;this.m_count=a.m_vertexCount;this.m_radius=a.m_radius;break;default:u.b2Assert(!1)}};b.prototype.GetSupport=function(a){for(var d=0,c=this.m_vertices[0].x*a.x+this.m_vertices[0].y*a.y,e=1;e<this.m_count;++e){var b=this.m_vertices[e].x*a.x+this.m_vertices[e].y*a.y;b>c&&(d=e,c=b)}return d};b.prototype.GetSupportVertex=
function(a){for(var d=0,c=this.m_vertices[0].x*a.x+this.m_vertices[0].y*a.y,e=1;e<this.m_count;++e){var b=this.m_vertices[e].x*a.x+this.m_vertices[e].y*a.y;b>c&&(d=e,c=b)}return this.m_vertices[d]};b.prototype.GetVertexCount=function(){return this.m_count};b.prototype.GetVertex=function(a){a=a||0;u.b2Assert(0<=a&&a<this.m_count);return this.m_vertices[a]};return b}();t.Collision.b2DynamicTreeNode=La=function(){function b(){this.aabb=new K}"use strict;";b.prototype.IsLeaf=function(){return null==this.child1};
return b}();t.Collision.b2DynamicTree=Ja=function(){function b(){this.m_freeList=this.m_root=null;this.m_insertionCount=this.m_path=0}"use strict;";b.prototype.CreateProxy=function(a,d){var c=this.AllocateNode(),e=u.b2_aabbExtension,b=u.b2_aabbExtension;c.aabb.lowerBound.x=a.lowerBound.x-e;c.aabb.lowerBound.y=a.lowerBound.y-b;c.aabb.upperBound.x=a.upperBound.x+e;c.aabb.upperBound.y=a.upperBound.y+b;c.userData=d;this.InsertLeaf(c);return c};b.prototype.DestroyProxy=function(a){this.RemoveLeaf(a);this.FreeNode(a)};
b.prototype.MoveProxy=function(a,d,c){u.b2Assert(a.IsLeaf());if(a.aabb.Contains(d))return!1;this.RemoveLeaf(a);var e=u.b2_aabbExtension+u.b2_aabbMultiplier*(0<c.x?c.x:-c.x);c=u.b2_aabbExtension+u.b2_aabbMultiplier*(0<c.y?c.y:-c.y);a.aabb.lowerBound.x=d.lowerBound.x-e;a.aabb.lowerBound.y=d.lowerBound.y-c;a.aabb.upperBound.x=d.upperBound.x+e;a.aabb.upperBound.y=d.upperBound.y+c;this.InsertLeaf(a);return!0};b.prototype.Rebalance=function(a){a=a||0;if(null!=this.m_root)for(var d=0;d<a;d++){for(var c=
this.m_root,e=0;0==c.IsLeaf();)c=this.m_path>>e&1?c.child2:c.child1,e=e+1&31;++this.m_path;this.RemoveLeaf(c);this.InsertLeaf(c)}};b.prototype.GetFatAABB=function(a){return a.aabb};b.prototype.GetUserData=function(a){return a.userData};b.prototype.Query=function(a,d){if(null!=this.m_root){var c=new y,e=0;for(c[e++]=this.m_root;0<e;){var b=c[--e];if(b.aabb.TestOverlap(d))if(b.IsLeaf()){if(!a(b))break}else c[e++]=b.child1,c[e++]=b.child2}}};b.prototype.RayCast=function(a,d){if(null!=this.m_root){var c=
d.p1,e=d.p2,b=r.SubtractVV(c,e);b.Normalize();var b=r.CrossFV(1,b),k=r.AbsV(b),h=d.maxFraction,g=new K,l=0,m=0,l=c.x+h*(e.x-c.x),m=c.y+h*(e.y-c.y);g.lowerBound.x=Math.min(c.x,l);g.lowerBound.y=Math.min(c.y,m);g.upperBound.x=Math.max(c.x,l);g.upperBound.y=Math.max(c.y,m);var q=new y,p=0;for(q[p++]=this.m_root;0<p;)if(h=q[--p],0!=h.aabb.TestOverlap(g)&&(l=h.aabb.GetCenter(),m=h.aabb.GetExtents(),!(0<Math.abs(b.x*(c.x-l.x)+b.y*(c.y-l.y))-k.x*m.x-k.y*m.y)))if(h.IsLeaf()){l=new va;l.p1=d.p1;l.p2=d.p2;
l.maxFraction=d.maxFraction;h=a(l,h);if(0==h)break;0<h&&(l=c.x+h*(e.x-c.x),m=c.y+h*(e.y-c.y),g.lowerBound.x=Math.min(c.x,l),g.lowerBound.y=Math.min(c.y,m),g.upperBound.x=Math.max(c.x,l),g.upperBound.y=Math.max(c.y,m))}else q[p++]=h.child1,q[p++]=h.child2}};b.prototype.AllocateNode=function(){if(this.m_freeList){var a=this.m_freeList;this.m_freeList=a.parent;a.parent=null;a.child1=null;a.child2=null;return a}return new La};b.prototype.FreeNode=function(a){a.parent=this.m_freeList;this.m_freeList=a};
b.prototype.InsertLeaf=function(a){++this.m_insertionCount;if(null==this.m_root)this.m_root=a,this.m_root.parent=null;else{var d=a.aabb.GetCenter(),c=this.m_root;if(0==c.IsLeaf()){do var e=c.child1,c=c.child2,b=Math.abs((e.aabb.lowerBound.x+e.aabb.upperBound.x)/2-d.x)+Math.abs((e.aabb.lowerBound.y+e.aabb.upperBound.y)/2-d.y),k=Math.abs((c.aabb.lowerBound.x+c.aabb.upperBound.x)/2-d.x)+Math.abs((c.aabb.lowerBound.y+c.aabb.upperBound.y)/2-d.y),c=b<k?e:c;while(0==c.IsLeaf())}d=c.parent;e=this.AllocateNode();
e.parent=d;e.userData=null;e.aabb.Combine(a.aabb,c.aabb);if(d){c.parent.child1==c?d.child1=e:d.child2=e;e.child1=c;e.child2=a;c.parent=e;a.parent=e;do{if(d.aabb.Contains(e.aabb))break;d.aabb.Combine(d.child1.aabb,d.child2.aabb);e=d;d=d.parent}while(d)}else e.child1=c,e.child2=a,c.parent=e,this.m_root=a.parent=e}};b.prototype.RemoveLeaf=function(a){if(a==this.m_root)this.m_root=null;else{var d=a.parent,c=d.parent;a=d.child1==a?d.child2:d.child1;if(c)for(c.child1==d?c.child1=a:c.child2=a,a.parent=c,
this.FreeNode(d);c;){d=c.aabb;c.aabb=K.Combine(c.child1.aabb,c.child2.aabb);if(d.Contains(c.aabb))break;c=c.parent}else this.m_root=a,a.parent=null,this.FreeNode(d)}};return b}();t.Collision.b2DynamicTreePair=Ma=function(){"use strict;";return function(){}}();t.Collision.b2DynamicTreeBroadPhase=Ka=function(){function b(){this.m_tree=new Ja;this.m_moveBuffer=new y;this.m_pairBuffer=new y;this.m_pairCount=0}"use strict;";b.prototype.CreateProxy=function(a,d){var c=this.m_tree.CreateProxy(a,d);++this.m_proxyCount;
this.BufferMove(c);return c};b.prototype.DestroyProxy=function(a){this.UnBufferMove(a);--this.m_proxyCount;this.m_tree.DestroyProxy(a)};b.prototype.MoveProxy=function(a,d,c){this.m_tree.MoveProxy(a,d,c)&&this.BufferMove(a)};b.prototype.TestOverlap=function(a,d){var c=this.m_tree.GetFatAABB(a),e=this.m_tree.GetFatAABB(d);return c.TestOverlap(e)};b.prototype.GetUserData=function(a){return this.m_tree.GetUserData(a)};b.prototype.GetFatAABB=function(a){return this.m_tree.GetFatAABB(a)};b.prototype.GetProxyCount=
function(){return this.m_proxyCount};b.prototype.UpdatePairs=function(a){for(var d=this,c=d.m_pairCount=0,e,c=0;c<d.m_moveBuffer.length;++c){e=d.m_moveBuffer[c];var b=d.m_tree.GetFatAABB(e);d.m_tree.Query(function(a){if(a==e)return!0;d.m_pairCount==d.m_pairBuffer.length&&(d.m_pairBuffer[d.m_pairCount]=new Ma);var c=d.m_pairBuffer[d.m_pairCount];c.proxyA=a<e?a:e;c.proxyB=a>=e?a:e;++d.m_pairCount;return!0},b)}for(c=d.m_moveBuffer.length=0;c<d.m_pairCount;){var b=d.m_pairBuffer[c],k=d.m_tree.GetUserData(b.proxyA),
h=d.m_tree.GetUserData(b.proxyB);a(k,h);for(++c;c<d.m_pairCount;){k=d.m_pairBuffer[c];if(k.proxyA!=b.proxyA||k.proxyB!=b.proxyB)break;++c}}};b.prototype.Query=function(a,d){this.m_tree.Query(a,d)};b.prototype.RayCast=function(a,d){this.m_tree.RayCast(a,d)};b.prototype.Validate=function(){};b.prototype.Rebalance=function(a){this.m_tree.Rebalance(a||0)};b.prototype.BufferMove=function(a){this.m_moveBuffer[this.m_moveBuffer.length]=a};b.prototype.UnBufferMove=function(a){a=parseInt(this.m_moveBuffer.indexOf(a));
this.m_moveBuffer.splice(a,1)};b.prototype.ComparePairs=function(a,d){return 0};return b}();t.Collision.b2Point=function(){function b(){this.p=new p}"use strict;";b.prototype.Support=function(a,d,c){return this.p};b.prototype.GetFirstVertex=function(a){return this.p};return b}();t.Collision.b2RayCastInput=va=function(){"use strict;";return function(b,a,d){this.p1=new p;this.p2=new p;b=b||null;a=a||null;d=d||1;b&&this.p1.SetV(b);a&&this.p2.SetV(a);this.maxFraction=d}}();t.Collision.b2RayCastOutput=
ab=function(){"use strict;";return function(){this.normal=new p}}();t.Collision.b2Segment=function(){function b(){this.p1=new p;this.p2=new p}"use strict;";b.prototype.TestSegment=function(a,d,c,e){var b=c.p1,k=c.p2.x-b.x,h=c.p2.y-b.y;c=this.p2.y-this.p1.y;var g=-(this.p2.x-this.p1.x),l=100*Number.MIN_VALUE,m=-(k*c+h*g);if(m>l){var q=b.x-this.p1.x,p=b.y-this.p1.y,b=q*c+p*g;if(0<=b&&b<=(e||0)*m&&(e=-k*p+h*q,-l*m<=e&&e<=m*(1+l)))return b/=m,e=Math.sqrt(c*c+g*g),a[0]=b,d.Set(c/e,g/e),!0}return!1};b.prototype.Extend=
function(a){this.ExtendForward(a);this.ExtendBackward(a)};b.prototype.ExtendForward=function(a){var d=this.p2.x-this.p1.x,c=this.p2.y-this.p1.y;a=Math.min(0<d?(a.upperBound.x-this.p1.x)/d:0>d?(a.lowerBound.x-this.p1.x)/d:Number.POSITIVE_INFINITY,0<c?(a.upperBound.y-this.p1.y)/c:0>c?(a.lowerBound.y-this.p1.y)/c:Number.POSITIVE_INFINITY);this.p2.x=this.p1.x+d*a;this.p2.y=this.p1.y+c*a};b.prototype.ExtendBackward=function(a){var d=-this.p2.x+this.p1.x,c=-this.p2.y+this.p1.y;a=Math.min(0<d?(a.upperBound.x-
this.p2.x)/d:0>d?(a.lowerBound.x-this.p2.x)/d:Number.POSITIVE_INFINITY,0<c?(a.upperBound.y-this.p2.y)/c:0>c?(a.lowerBound.y-this.p2.y)/c:Number.POSITIVE_INFINITY);this.p1.x=this.p2.x+d*a;this.p1.y=this.p2.y+c*a};return b}();t.Collision.b2SeparationFunction=cb=function(){function b(){this.m_localPoint=new p;this.m_axis=new p}"use strict;";b.e_points=1;b.e_faceA=2;b.e_faceB=4;b.prototype.Initialize=function(a,d,c,e,f){this.m_proxyA=d;this.m_proxyB=e;var k=parseInt(a.count);u.b2Assert(0<k&&3>k);var h,
g,l,m,q=m=l=e=d=0,z=0,q=0;1==k?(this.m_type=b.e_points,h=this.m_proxyA.GetVertex(a.indexA[0]),g=this.m_proxyB.GetVertex(a.indexB[0]),k=h,a=c.R,d=c.position.x+(a.col1.x*k.x+a.col2.x*k.y),e=c.position.y+(a.col1.y*k.x+a.col2.y*k.y),k=g,a=f.R,l=f.position.x+(a.col1.x*k.x+a.col2.x*k.y),m=f.position.y+(a.col1.y*k.x+a.col2.y*k.y),this.m_axis.x=l-d,this.m_axis.y=m-e,this.m_axis.Normalize()):(a.indexB[0]==a.indexB[1]?(this.m_type=b.e_faceA,d=this.m_proxyA.GetVertex(a.indexA[0]),e=this.m_proxyA.GetVertex(a.indexA[1]),
g=this.m_proxyB.GetVertex(a.indexB[0]),this.m_localPoint.x=.5*(d.x+e.x),this.m_localPoint.y=.5*(d.y+e.y),this.m_axis=r.CrossVF(r.SubtractVV(e,d),1),this.m_axis.Normalize(),k=this.m_axis,a=c.R,q=a.col1.x*k.x+a.col2.x*k.y,z=a.col1.y*k.x+a.col2.y*k.y,k=this.m_localPoint,a=c.R,d=c.position.x+(a.col1.x*k.x+a.col2.x*k.y),e=c.position.y+(a.col1.y*k.x+a.col2.y*k.y),k=g,a=f.R,l=f.position.x+(a.col1.x*k.x+a.col2.x*k.y),m=f.position.y+(a.col1.y*k.x+a.col2.y*k.y),q=(l-d)*q+(m-e)*z):a.indexA[0]==a.indexA[0]?(this.m_type=
b.e_faceB,l=this.m_proxyB.GetVertex(a.indexB[0]),m=this.m_proxyB.GetVertex(a.indexB[1]),h=this.m_proxyA.GetVertex(a.indexA[0]),this.m_localPoint.x=.5*(l.x+m.x),this.m_localPoint.y=.5*(l.y+m.y),this.m_axis=r.CrossVF(r.SubtractVV(m,l),1),this.m_axis.Normalize(),k=this.m_axis,a=f.R,q=a.col1.x*k.x+a.col2.x*k.y,z=a.col1.y*k.x+a.col2.y*k.y,k=this.m_localPoint,a=f.R,l=f.position.x+(a.col1.x*k.x+a.col2.x*k.y),m=f.position.y+(a.col1.y*k.x+a.col2.y*k.y),k=h,a=c.R,d=c.position.x+(a.col1.x*k.x+a.col2.x*k.y),
e=c.position.y+(a.col1.y*k.x+a.col2.y*k.y),q=(d-l)*q+(e-m)*z):(d=this.m_proxyA.GetVertex(a.indexA[0]),e=this.m_proxyA.GetVertex(a.indexA[1]),l=this.m_proxyB.GetVertex(a.indexB[0]),m=this.m_proxyB.GetVertex(a.indexB[1]),r.MulX(c,h),h=r.MulMV(c.R,r.SubtractVV(e,d)),r.MulX(f,g),q=r.MulMV(f.R,r.SubtractVV(m,l)),f=h.x*h.x+h.y*h.y,g=q.x*q.x+q.y*q.y,a=r.SubtractVV(q,h),c=h.x*a.x+h.y*a.y,a=q.x*a.x+q.y*a.y,h=h.x*q.x+h.y*q.y,z=f*g-h*h,q=0,0!=z&&(q=r.Clamp((h*a-c*g)/z,0,1)),0>(h*q+a)/g&&(q=r.Clamp((h-c)/f,0,
1)),h=new p,h.x=d.x+q*(e.x-d.x),h.y=d.y+q*(e.y-d.y),g=new p,g.x=l.x+q*(m.x-l.x),g.y=l.y+q*(m.y-l.y),0==q||1==q?(this.m_type=b.e_faceB,this.m_axis=r.CrossVF(r.SubtractVV(m,l),1),this.m_axis.Normalize(),this.m_localPoint=g):(this.m_type=b.e_faceA,this.m_axis=r.CrossVF(r.SubtractVV(e,d),1),this.m_localPoint=h)),0>q&&this.m_axis.NegativeSelf())};b.prototype.Evaluate=function(a,d){var c,e,f=0;switch(this.m_type){case b.e_points:return c=r.MulTMV(a.R,this.m_axis),e=r.MulTMV(d.R,this.m_axis.GetNegative()),
c=this.m_proxyA.GetSupportVertex(c),e=this.m_proxyB.GetSupportVertex(e),c=r.MulX(a,c),e=r.MulX(d,e),f=(e.x-c.x)*this.m_axis.x+(e.y-c.y)*this.m_axis.y;case b.e_faceA:return f=r.MulMV(a.R,this.m_axis),c=r.MulX(a,this.m_localPoint),e=r.MulTMV(d.R,f.GetNegative()),e=this.m_proxyB.GetSupportVertex(e),e=r.MulX(d,e),f=(e.x-c.x)*f.x+(e.y-c.y)*f.y;case b.e_faceB:return f=r.MulMV(d.R,this.m_axis),e=r.MulX(d,this.m_localPoint),c=r.MulTMV(a.R,f.GetNegative()),c=this.m_proxyA.GetSupportVertex(c),c=r.MulX(a,c),
f=(c.x-e.x)*f.x+(c.y-e.y)*f.y;default:return u.b2Assert(!1),0}};return b}();t.Collision.b2TimeOfImpact=O=function(){function b(){}"use strict;";b.b2_toiCalls=0;b.b2_toiIters=0;b.b2_toiMaxIters=0;b.b2_toiRootIters=0;b.b2_toiMaxRootIters=0;b.s_cache=new wa;b.s_distanceInput=new ma;b.s_xfA=new N;b.s_xfB=new N;b.s_fcn=new cb;b.s_distanceOutput=new na;b.TimeOfImpact=function(a){++b.b2_toiCalls;var d=a.proxyA,c=a.proxyB,e=a.sweepA,f=a.sweepB;u.b2Assert(e.t0==f.t0);u.b2Assert(1-e.t0>Number.MIN_VALUE);var k=
d.m_radius+c.m_radius;a=a.tolerance;var h=0,g=0,l=0;b.s_cache.count=0;for(b.s_distanceInput.useRadii=!1;;){e.GetTransform(b.s_xfA,h);f.GetTransform(b.s_xfB,h);b.s_distanceInput.proxyA=d;b.s_distanceInput.proxyB=c;b.s_distanceInput.transformA=b.s_xfA;b.s_distanceInput.transformB=b.s_xfB;la.Distance(b.s_distanceOutput,b.s_cache,b.s_distanceInput);if(0>=b.s_distanceOutput.distance){h=1;break}b.s_fcn.Initialize(b.s_cache,d,b.s_xfA,c,b.s_xfB);var m=b.s_fcn.Evaluate(b.s_xfA,b.s_xfB);if(0>=m){h=1;break}0==
g&&(l=m>k?r.Max(k-a,.75*k):r.Max(m-a,.02*k));if(m-l<.5*a){if(0==g){h=1;break}break}var q=h,p=h,n=1;e.GetTransform(b.s_xfA,n);f.GetTransform(b.s_xfB,n);var F=b.s_fcn.Evaluate(b.s_xfA,b.s_xfB);if(F>=l){h=1;break}for(var D=0;;){var x=0,x=D&1?p+(l-m)*(n-p)/(F-m):.5*(p+n);e.GetTransform(b.s_xfA,x);f.GetTransform(b.s_xfB,x);var t=b.s_fcn.Evaluate(b.s_xfA,b.s_xfB);if(r.Abs(t-l)<.025*a){q=x;break}t>l?(p=x,m=t):(n=x,F=t);++D;++b.b2_toiRootIters;if(50==D)break}b.b2_toiMaxRootIters=r.Max(b.b2_toiMaxRootIters,
D);if(q<(1+100*Number.MIN_VALUE)*h)break;h=q;g++;++b.b2_toiIters;if(1E3==g)break}b.b2_toiMaxIters=r.Max(b.b2_toiMaxIters,g);return h};return b}();t.Collision.b2TOIInput=eb=function(){"use strict;";return function(){this.proxyA=new V;this.proxyB=new V;this.sweepA=new T;this.sweepB=new T}}();t.Collision.b2WorldManifold=ib=function(){function b(){this.m_normal=new p;this.m_points=new y(u.b2_maxManifoldPoints);for(var a=0;a<u.b2_maxManifoldPoints;a++)this.m_points[a]=new p}"use strict;";b.prototype.Initialize=
function(a,d,c,e,b){c=c||0;b=b||0;if(0!=a.m_pointCount){var k=0,h,g,l=0,m=0,q=0,p=0,n=0;h=0;switch(a.m_type){case H.e_circles:g=d.R;h=a.m_localPoint;k=d.position.x+g.col1.x*h.x+g.col2.x*h.y;d=d.position.y+g.col1.y*h.x+g.col2.y*h.y;g=e.R;h=a.m_points[0].m_localPoint;a=e.position.x+g.col1.x*h.x+g.col2.x*h.y;e=e.position.y+g.col1.y*h.x+g.col2.y*h.y;h=a-k;g=e-d;l=h*h+g*g;l>Number.MIN_VALUE*Number.MIN_VALUE?(l=Math.sqrt(l),this.m_normal.x=h/l,this.m_normal.y=g/l):(this.m_normal.x=1,this.m_normal.y=0);
h=d+c*this.m_normal.y;e-=b*this.m_normal.y;this.m_points[0].x=.5*(k+c*this.m_normal.x+(a-b*this.m_normal.x));this.m_points[0].y=.5*(h+e);break;case H.e_faceA:g=d.R;h=a.m_localPlaneNormal;l=g.col1.x*h.x+g.col2.x*h.y;m=g.col1.y*h.x+g.col2.y*h.y;g=d.R;h=a.m_localPoint;q=d.position.x+g.col1.x*h.x+g.col2.x*h.y;p=d.position.y+g.col1.y*h.x+g.col2.y*h.y;this.m_normal.x=l;this.m_normal.y=m;for(k=0;k<a.m_pointCount;k++)g=e.R,h=a.m_points[k].m_localPoint,n=e.position.x+g.col1.x*h.x+g.col2.x*h.y,h=e.position.y+
g.col1.y*h.x+g.col2.y*h.y,this.m_points[k].x=n+.5*(c-(n-q)*l-(h-p)*m-b)*l,this.m_points[k].y=h+.5*(c-(n-q)*l-(h-p)*m-b)*m;break;case H.e_faceB:for(g=e.R,h=a.m_localPlaneNormal,l=g.col1.x*h.x+g.col2.x*h.y,m=g.col1.y*h.x+g.col2.y*h.y,g=e.R,h=a.m_localPoint,q=e.position.x+g.col1.x*h.x+g.col2.x*h.y,p=e.position.y+g.col1.y*h.x+g.col2.y*h.y,this.m_normal.x=-l,this.m_normal.y=-m,k=0;k<a.m_pointCount;k++)g=d.R,h=a.m_points[k].m_localPoint,n=d.position.x+g.col1.x*h.x+g.col2.x*h.y,h=d.position.y+g.col1.y*h.x+
g.col2.y*h.y,this.m_points[k].x=n+.5*(b-(n-q)*l-(h-p)*m-c)*l,this.m_points[k].y=h+.5*(b-(n-q)*l-(h-p)*m-c)*m}}};return b}();t.Dynamics.b2FilterData=pa=function(){function b(){this.categoryBits=1;this.maskBits=65535;this.groupIndex=0}"use strict;";b.prototype.Copy=function(){var a=new b;a.categoryBits=this.categoryBits;a.maskBits=this.maskBits;a.groupIndex=this.groupIndex;return a};return b}();t.Dynamics.b2TimeStep=fa=function(){function b(){}"use strict;";b.prototype.Set=function(a){this.dt=a.dt;
this.inv_dt=a.inv_dt;this.positionIterations=a.positionIterations;this.velocityIterations=a.velocityIterations;this.warmStarting=a.warmStarting};return b}();t.Dynamics.Contacts.b2ContactRegister=Fa=function(){"use strict;";return function(){}}();t.Dynamics.Contacts.b2ContactResult=function(){"use strict;";return function(){this.position=new p;this.normal=new p;this.id=new U}}();t.Dynamics.Contacts.b2ContactEdge=ja=function(){"use strict;";return function(){}}();t.Dynamics.Contacts.b2ContactConstraintPoint=
za=function(){"use strict;";return function(){this.localPoint=new p;this.rA=new p;this.rB=new p}}();t.Dynamics.Contacts.b2ContactConstraint=ya=function(){"use strict;";return function(){this.localPlaneNormal=new p;this.localPoint=new p;this.normal=new p;this.normalMass=new C;this.K=new C;this.points=new y(u.b2_maxManifoldPoints);for(var b=0;b<u.b2_maxManifoldPoints;b++)this.points[b]=new za}}();t.Dynamics.Contacts.b2Contact=n=function(){function b(){this.m_nodeA=new ja;this.m_nodeB=new ja;this.m_manifold=
new H;this.m_oldManifold=new H}"use strict;";b.e_sensorFlag=1;b.e_continuousFlag=2;b.e_islandFlag=4;b.e_toiFlag=8;b.e_touchingFlag=16;b.e_enabledFlag=32;b.e_filterFlag=64;b.s_input=new eb;b.prototype.GetManifold=function(){return this.m_manifold};b.prototype.GetWorldManifold=function(a){var d=this.m_fixtureA.GetBody(),c=this.m_fixtureB.GetBody(),e=this.m_fixtureA.GetShape(),b=this.m_fixtureB.GetShape();a.Initialize(this.m_manifold,d.GetTransform(),e.m_radius,c.GetTransform(),b.m_radius)};b.prototype.IsTouching=
function(){return(this.m_flags&b.e_touchingFlag)==b.e_touchingFlag};b.prototype.IsContinuous=function(){return(this.m_flags&b.e_continuousFlag)==b.e_continuousFlag};b.prototype.SetSensor=function(a){this.m_flags=a?this.m_flags|b.e_sensorFlag:this.m_flags&~b.e_sensorFlag};b.prototype.IsSensor=function(){return(this.m_flags&b.e_sensorFlag)==b.e_sensorFlag};b.prototype.SetEnabled=function(a){this.m_flags=a?this.m_flags|b.e_enabledFlag:this.m_flags&~b.e_enabledFlag};b.prototype.IsEnabled=function(){return(this.m_flags&
b.e_enabledFlag)==b.e_enabledFlag};b.prototype.GetNext=function(){return this.m_next};b.prototype.GetFixtureA=function(){return this.m_fixtureA};b.prototype.GetFixtureB=function(){return this.m_fixtureB};b.prototype.FlagForFiltering=function(){this.m_flags|=b.e_filterFlag};b.prototype.Reset=function(a,d){a=a||null;d=d||null;this.m_flags=b.e_enabledFlag;if(a&&d){if(a.IsSensor()||d.IsSensor())this.m_flags|=b.e_sensorFlag;var c=a.GetBody(),e=d.GetBody();if(c.GetType()!=w.b2_dynamicBody||c.IsBullet()||
e.GetType()!=w.b2_dynamicBody||e.IsBullet())this.m_flags|=b.e_continuousFlag;this.m_fixtureA=a;this.m_fixtureB=d;this.m_manifold.m_pointCount=0;this.m_next=this.m_prev=null;this.m_nodeA.contact=null;this.m_nodeA.prev=null;this.m_nodeA.next=null;this.m_nodeA.other=null;this.m_nodeB.contact=null;this.m_nodeB.prev=null;this.m_nodeB.next=null;this.m_nodeB.other=null}else this.m_fixtureB=this.m_fixtureA=null};b.prototype.Update=function(a){var d=this.m_oldManifold;this.m_oldManifold=this.m_manifold;this.m_manifold=
d;this.m_flags|=b.e_enabledFlag;var c=!1,d=(this.m_flags&b.e_touchingFlag)==b.e_touchingFlag,e=this.m_fixtureA.m_body,f=this.m_fixtureB.m_body,k=this.m_fixtureA.m_aabb.TestOverlap(this.m_fixtureB.m_aabb);if(this.m_flags&b.e_sensorFlag)k&&(c=this.m_fixtureA.GetShape(),k=this.m_fixtureB.GetShape(),e=e.GetTransform(),f=f.GetTransform(),c=A.TestOverlap(c,e,k,f)),this.m_manifold.m_pointCount=0;else{e.GetType()!=w.b2_dynamicBody||e.IsBullet()||f.GetType()!=w.b2_dynamicBody||f.IsBullet()?this.m_flags|=b.e_continuousFlag:
this.m_flags&=~b.e_continuousFlag;if(k)for(this.Evaluate(),c=0<this.m_manifold.m_pointCount,k=0;k<this.m_manifold.m_pointCount;++k){var h=this.m_manifold.m_points[k];h.m_normalImpulse=0;h.m_tangentImpulse=0;for(var g=h.m_id,l=0;l<this.m_oldManifold.m_pointCount;++l){var m=this.m_oldManifold.m_points[l];if(m.m_id.key==g.key){h.m_normalImpulse=m.m_normalImpulse;h.m_tangentImpulse=m.m_tangentImpulse;break}}}else this.m_manifold.m_pointCount=0;c!=d&&(e.SetAwake(!0),f.SetAwake(!0))}this.m_flags=c?this.m_flags|
b.e_touchingFlag:this.m_flags&~b.e_touchingFlag;0==d&&1==c&&a.BeginContact(this);1==d&&0==c&&a.EndContact(this);0==(this.m_flags&b.e_sensorFlag)&&a.PreSolve(this,this.m_oldManifold)};b.prototype.Evaluate=function(){};b.prototype.ComputeTOI=function(a,d){b.s_input.proxyA.Set(this.m_fixtureA.GetShape());b.s_input.proxyB.Set(this.m_fixtureB.GetShape());b.s_input.sweepA=a;b.s_input.sweepB=d;b.s_input.tolerance=u.b2_linearSlop;return O.TimeOfImpact(b.s_input)};return b}();ia=t.Dynamics.Contacts.b2CircleContact=
function(b){function a(){a.__super__.constructor.apply(this,arguments)}"use strict;";E(a,b);a.Create=function(d){return new a};a.Destroy=function(a,c){};a.prototype.Reset=function(d,c){a.__super__.Reset.call(this,d,c)};a.prototype.Evaluate=function(){var a=this.m_fixtureA.GetBody(),c=this.m_fixtureB.GetBody();Y.CollideCircles(this.m_manifold,this.m_fixtureA.GetShape()instanceof P?this.m_fixtureA.GetShape():null,a.m_xf,this.m_fixtureB.GetShape()instanceof P?this.m_fixtureB.GetShape():null,c.m_xf)};
a.prototype.GetManifold=function(){return this.m_manifold};a.prototype.GetWorldManifold=function(a){var c=this.m_fixtureA.GetBody(),e=this.m_fixtureB.GetBody(),b=this.m_fixtureA.GetShape(),k=this.m_fixtureB.GetShape();a.Initialize(this.m_manifold,c.GetTransform(),b.m_radius,e.GetTransform(),k.m_radius)};a.prototype.IsTouching=function(){return(this.m_flags&n.e_touchingFlag)==n.e_touchingFlag};a.prototype.IsContinuous=function(){return(this.m_flags&n.e_continuousFlag)==n.e_continuousFlag};a.prototype.SetSensor=
function(a){this.m_flags=a?this.m_flags|n.e_sensorFlag:this.m_flags&~n.e_sensorFlag};a.prototype.IsSensor=function(){return(this.m_flags&n.e_sensorFlag)==n.e_sensorFlag};a.prototype.SetEnabled=function(a){this.m_flags=a?this.m_flags|n.e_enabledFlag:this.m_flags&~n.e_enabledFlag};a.prototype.IsEnabled=function(){return(this.m_flags&n.e_enabledFlag)==n.e_enabledFlag};a.prototype.GetNext=function(){return this.m_next};a.prototype.GetFixtureA=function(){return this.m_fixtureA};a.prototype.GetFixtureB=
function(){return this.m_fixtureB};a.prototype.FlagForFiltering=function(){this.m_flags|=n.e_filterFlag};a.prototype.b2Contact=function(){};a.prototype.Update=function(a){var c=this.m_oldManifold;this.m_oldManifold=this.m_manifold;this.m_manifold=c;this.m_flags|=n.e_enabledFlag;var e=!1,c=(this.m_flags&n.e_touchingFlag)==n.e_touchingFlag,b=this.m_fixtureA.m_body,k=this.m_fixtureB.m_body,h=this.m_fixtureA.m_aabb.TestOverlap(this.m_fixtureB.m_aabb);if(this.m_flags&n.e_sensorFlag)h&&(e=this.m_fixtureA.GetShape(),
h=this.m_fixtureB.GetShape(),b=b.GetTransform(),k=k.GetTransform(),e=A.TestOverlap(e,b,h,k)),this.m_manifold.m_pointCount=0;else{b.GetType()!=w.b2_dynamicBody||b.IsBullet()||k.GetType()!=w.b2_dynamicBody||k.IsBullet()?this.m_flags|=n.e_continuousFlag:this.m_flags&=~n.e_continuousFlag;if(h)for(this.Evaluate(),e=0<this.m_manifold.m_pointCount,h=0;h<this.m_manifold.m_pointCount;++h){var g=this.m_manifold.m_points[h];g.m_normalImpulse=0;g.m_tangentImpulse=0;for(var l=g.m_id,m=0;m<this.m_oldManifold.m_pointCount;++m){var q=
this.m_oldManifold.m_points[m];if(q.m_id.key==l.key){g.m_normalImpulse=q.m_normalImpulse;g.m_tangentImpulse=q.m_tangentImpulse;break}}}else this.m_manifold.m_pointCount=0;e!=c&&(b.SetAwake(!0),k.SetAwake(!0))}this.m_flags=e?this.m_flags|n.e_touchingFlag:this.m_flags&~n.e_touchingFlag;0==c&&1==e&&a.BeginContact(this);1==c&&0==e&&a.EndContact(this);0==(this.m_flags&n.e_sensorFlag)&&a.PreSolve(this,this.m_oldManifold)};a.prototype.ComputeTOI=function(a,c){n.s_input.proxyA.Set(this.m_fixtureA.GetShape());
n.s_input.proxyB.Set(this.m_fixtureB.GetShape());n.s_input.sweepA=a;n.s_input.sweepB=c;n.s_input.tolerance=u.b2_linearSlop;return O.TimeOfImpact(n.s_input)};return a}(n);t.Dynamics.Contacts.b2PositionSolverManifold=Ya=function(){function b(){this.m_normal=new p;this.m_separations=new I(u.b2_maxManifoldPoints);this.m_points=new y(u.b2_maxManifoldPoints);for(var a=0;a<u.b2_maxManifoldPoints;a++)this.m_points[a]=new p}"use strict;";b.circlePointA=new p;b.circlePointB=new p;b.prototype.Initialize=function(a){u.b2Assert(0<
a.pointCount);var d=0,c=0,e=0,b,k=0,h=0;switch(a.type){case H.e_circles:b=a.bodyA.m_xf.R;e=a.localPoint;d=a.bodyA.m_xf.position.x+(b.col1.x*e.x+b.col2.x*e.y);c=a.bodyA.m_xf.position.y+(b.col1.y*e.x+b.col2.y*e.y);b=a.bodyB.m_xf.R;e=a.points[0].localPoint;k=a.bodyB.m_xf.position.x+(b.col1.x*e.x+b.col2.x*e.y);b=a.bodyB.m_xf.position.y+(b.col1.y*e.x+b.col2.y*e.y);var e=k-d,h=b-c,g=e*e+h*h;g>Number.MIN_VALUE*Number.MIN_VALUE?(g=Math.sqrt(g),this.m_normal.x=e/g,this.m_normal.y=h/g):(this.m_normal.x=1,this.m_normal.y=
0);this.m_points[0].x=.5*(d+k);this.m_points[0].y=.5*(c+b);this.m_separations[0]=e*this.m_normal.x+h*this.m_normal.y-a.radius;break;case H.e_faceA:b=a.bodyA.m_xf.R;e=a.localPlaneNormal;this.m_normal.x=b.col1.x*e.x+b.col2.x*e.y;this.m_normal.y=b.col1.y*e.x+b.col2.y*e.y;b=a.bodyA.m_xf.R;e=a.localPoint;k=a.bodyA.m_xf.position.x+(b.col1.x*e.x+b.col2.x*e.y);h=a.bodyA.m_xf.position.y+(b.col1.y*e.x+b.col2.y*e.y);b=a.bodyB.m_xf.R;for(d=0;d<a.pointCount;++d)e=a.points[d].localPoint,c=a.bodyB.m_xf.position.x+
(b.col1.x*e.x+b.col2.x*e.y),e=a.bodyB.m_xf.position.y+(b.col1.y*e.x+b.col2.y*e.y),this.m_separations[d]=(c-k)*this.m_normal.x+(e-h)*this.m_normal.y-a.radius,this.m_points[d].x=c,this.m_points[d].y=e;break;case H.e_faceB:b=a.bodyB.m_xf.R;e=a.localPlaneNormal;this.m_normal.x=b.col1.x*e.x+b.col2.x*e.y;this.m_normal.y=b.col1.y*e.x+b.col2.y*e.y;b=a.bodyB.m_xf.R;e=a.localPoint;k=a.bodyB.m_xf.position.x+(b.col1.x*e.x+b.col2.x*e.y);h=a.bodyB.m_xf.position.y+(b.col1.y*e.x+b.col2.y*e.y);b=a.bodyA.m_xf.R;for(d=
0;d<a.pointCount;++d)e=a.points[d].localPoint,c=a.bodyA.m_xf.position.x+(b.col1.x*e.x+b.col2.x*e.y),e=a.bodyA.m_xf.position.y+(b.col1.y*e.x+b.col2.y*e.y),this.m_separations[d]=(c-k)*this.m_normal.x+(e-h)*this.m_normal.y-a.radius,this.m_points[d].Set(c,e);this.m_normal.x*=-1;this.m_normal.y*=-1}};return b}();t.Dynamics.Contacts.b2ContactSolver=Ga=function(){function b(){this.m_step=new fa;this.m_constraints=new y}"use strict;";b.s_worldManifold=new ib;b.s_psm=new Ya;b.prototype.Initialize=function(a,
d,c,e){c=c||0;var f;this.m_step.Set(a);this.m_allocator=e;a=0;for(this.m_constraintCount=c;this.m_constraints.length<this.m_constraintCount;)this.m_constraints[this.m_constraints.length]=new ya;for(a=0;a<c;++a){f=d[a];e=f.m_fixtureA;var k=f.m_fixtureB,h=e.m_shape.m_radius,g=k.m_shape.m_radius,l=e.m_body,m=k.m_body,q=f.GetManifold(),p=u.b2MixFriction(e.GetFriction(),k.GetFriction()),n=u.b2MixRestitution(e.GetRestitution(),k.GetRestitution()),r=l.m_linearVelocity.x,D=l.m_linearVelocity.y,x=m.m_linearVelocity.x,
t=m.m_linearVelocity.y,v=l.m_angularVelocity,w=m.m_angularVelocity;u.b2Assert(0<q.m_pointCount);b.s_worldManifold.Initialize(q,l.m_xf,h,m.m_xf,g);k=b.s_worldManifold.m_normal.x;f=b.s_worldManifold.m_normal.y;e=this.m_constraints[a];e.bodyA=l;e.bodyB=m;e.manifold=q;e.normal.x=k;e.normal.y=f;e.pointCount=q.m_pointCount;e.friction=p;e.restitution=n;e.localPlaneNormal.x=q.m_localPlaneNormal.x;e.localPlaneNormal.y=q.m_localPlaneNormal.y;e.localPoint.x=q.m_localPoint.x;e.localPoint.y=q.m_localPoint.y;e.radius=
h+g;e.type=q.m_type;for(h=0;h<e.pointCount;++h){p=q.m_points[h];g=e.points[h];g.normalImpulse=p.m_normalImpulse;g.tangentImpulse=p.m_tangentImpulse;g.localPoint.SetV(p.m_localPoint);var p=g.rA.x=b.s_worldManifold.m_points[h].x-l.m_sweep.c.x,n=g.rA.y=b.s_worldManifold.m_points[h].y-l.m_sweep.c.y,A=g.rB.x=b.s_worldManifold.m_points[h].x-m.m_sweep.c.x,E=g.rB.y=b.s_worldManifold.m_points[h].y-m.m_sweep.c.y,L=p*f-n*k,y=A*f-E*k,L=L*L,y=y*y;g.normalMass=1/(l.m_invMass+m.m_invMass+l.m_invI*L+m.m_invI*y);
var C=l.m_mass*l.m_invMass+m.m_mass*m.m_invMass,C=C+(l.m_mass*l.m_invI*L+m.m_mass*m.m_invI*y);g.equalizedMass=1/C;y=f;C=-k;L=p*C-n*y;y=A*C-E*y;L*=L;y*=y;g.tangentMass=1/(l.m_invMass+m.m_invMass+l.m_invI*L+m.m_invI*y);g.velocityBias=0;p=e.normal.x*(x+-w*E-r- -v*n)+e.normal.y*(t+w*A-D-v*p);p<-u.b2_velocityThreshold&&(g.velocityBias+=-e.restitution*p)}2==e.pointCount&&(t=e.points[0],x=e.points[1],q=l.m_invMass,l=l.m_invI,r=m.m_invMass,m=m.m_invI,D=t.rA.x*f-t.rA.y*k,t=t.rB.x*f-t.rB.y*k,v=x.rA.x*f-x.rA.y*
k,x=x.rB.x*f-x.rB.y*k,k=q+r+l*D*D+m*t*t,f=q+r+l*v*v+m*x*x,m=q+r+l*D*v+m*t*x,k*k<100*(k*f-m*m)?(e.K.col1.Set(k,m),e.K.col2.Set(m,f),e.K.GetInverse(e.normalMass)):e.pointCount=1)}};b.prototype.InitVelocityConstraints=function(a){for(var d=0;d<this.m_constraintCount;++d){var c=this.m_constraints[d],e=c.bodyA,b=c.bodyB,k=e.m_invMass,h=e.m_invI,g=b.m_invMass,l=b.m_invI,m=c.normal.x,q=c.normal.y,p=q,n=-m,r=0,u=0;if(a.warmStarting)for(u=c.pointCount,r=0;r<u;++r){var x=c.points[r];x.normalImpulse*=a.dtRatio;
x.tangentImpulse*=a.dtRatio;var t=x.normalImpulse*m+x.tangentImpulse*p,v=x.normalImpulse*q+x.tangentImpulse*n;e.m_angularVelocity-=h*(x.rA.x*v-x.rA.y*t);e.m_linearVelocity.x-=k*t;e.m_linearVelocity.y-=k*v;b.m_angularVelocity+=l*(x.rB.x*v-x.rB.y*t);b.m_linearVelocity.x+=g*t;b.m_linearVelocity.y+=g*v}else for(u=c.pointCount,r=0;r<u;++r)e=c.points[r],e.normalImpulse=0,e.tangentImpulse=0}};b.prototype.SolveVelocityConstraints=function(){for(var a=0,d,c=0,e=0,b=0,k=e=e=c=c=0,h=c=c=0,g=c=b=0,l=0,m,q=0;q<
this.m_constraintCount;++q){var b=this.m_constraints[q],p=b.bodyA,n=b.bodyB,u=p.m_angularVelocity,t=n.m_angularVelocity,x=p.m_linearVelocity,v=n.m_linearVelocity,w=p.m_invMass,A=p.m_invI,y=n.m_invMass,E=n.m_invI,g=b.normal.x,C=l=b.normal.y;m=-g;h=b.friction;for(a=0;a<b.pointCount;a++)d=b.points[a],c=v.x-t*d.rB.y-x.x+u*d.rA.y,e=v.y+t*d.rB.x-x.y-u*d.rA.x,c=c*C+e*m,c=d.tangentMass*-c,e=h*d.normalImpulse,e=r.Clamp(d.tangentImpulse+c,-e,e),c=e-d.tangentImpulse,k=c*C,c*=m,x.x-=w*k,x.y-=w*c,u-=A*(d.rA.x*
c-d.rA.y*k),v.x+=y*k,v.y+=y*c,t+=E*(d.rB.x*c-d.rB.y*k),d.tangentImpulse=e;parseInt(b.pointCount);if(1==b.pointCount)d=b.points[0],c=v.x+-t*d.rB.y-x.x- -u*d.rA.y,e=v.y+t*d.rB.x-x.y-u*d.rA.x,b=c*g+e*l,c=-d.normalMass*(b-d.velocityBias),e=d.normalImpulse+c,e=0<e?e:0,c=e-d.normalImpulse,k=c*g,c*=l,x.x-=w*k,x.y-=w*c,u-=A*(d.rA.x*c-d.rA.y*k),v.x+=y*k,v.y+=y*c,t+=E*(d.rB.x*c-d.rB.y*k),d.normalImpulse=e;else{d=b.points[0];var a=b.points[1],c=d.normalImpulse,h=a.normalImpulse,G=(v.x-t*d.rB.y-x.x+u*d.rA.y)*
g+(v.y+t*d.rB.x-x.y-u*d.rA.x)*l,H=(v.x-t*a.rB.y-x.x+u*a.rA.y)*g+(v.y+t*a.rB.x-x.y-u*a.rA.x)*l,e=G-d.velocityBias,k=H-a.velocityBias;m=b.K;e-=m.col1.x*c+m.col2.x*h;for(k-=m.col1.y*c+m.col2.y*h;;){m=b.normalMass;C=-(m.col1.x*e+m.col2.x*k);m=-(m.col1.y*e+m.col2.y*k);if(0<=C&&0<=m){c=C-c;h=m-h;b=c*g;c*=l;g*=h;l*=h;x.x-=w*(b+g);x.y-=w*(c+l);u-=A*(d.rA.x*c-d.rA.y*b+a.rA.x*l-a.rA.y*g);v.x+=y*(b+g);v.y+=y*(c+l);t+=E*(d.rB.x*c-d.rB.y*b+a.rB.x*l-a.rB.y*g);d.normalImpulse=C;a.normalImpulse=m;break}C=-d.normalMass*
e;m=0;H=b.K.col1.y*C+k;if(0<=C&&0<=H){c=C-c;h=m-h;b=c*g;c*=l;g*=h;l*=h;x.x-=w*(b+g);x.y-=w*(c+l);u-=A*(d.rA.x*c-d.rA.y*b+a.rA.x*l-a.rA.y*g);v.x+=y*(b+g);v.y+=y*(c+l);t+=E*(d.rB.x*c-d.rB.y*b+a.rB.x*l-a.rB.y*g);d.normalImpulse=C;a.normalImpulse=m;break}C=0;m=-a.normalMass*k;G=b.K.col2.x*m+e;if(0<=m&&0<=G){c=C-c;h=m-h;b=c*g;c*=l;g*=h;l*=h;x.x-=w*(b+g);x.y-=w*(c+l);u-=A*(d.rA.x*c-d.rA.y*b+a.rA.x*l-a.rA.y*g);v.x+=y*(b+g);v.y+=y*(c+l);t+=E*(d.rB.x*c-d.rB.y*b+a.rB.x*l-a.rB.y*g);d.normalImpulse=C;a.normalImpulse=
m;break}m=C=0;G=e;H=k;if(0<=G&&0<=H){c=C-c;h=m-h;b=c*g;c*=l;g*=h;l*=h;x.x-=w*(b+g);x.y-=w*(c+l);u-=A*(d.rA.x*c-d.rA.y*b+a.rA.x*l-a.rA.y*g);v.x+=y*(b+g);v.y+=y*(c+l);t+=E*(d.rB.x*c-d.rB.y*b+a.rB.x*l-a.rB.y*g);d.normalImpulse=C;a.normalImpulse=m;break}break}}p.m_angularVelocity=u;n.m_angularVelocity=t}};b.prototype.FinalizeVelocityConstraints=function(){for(var a=0;a<this.m_constraintCount;++a)for(var d=this.m_constraints[a],c=d.manifold,e=0;e<d.pointCount;++e){var b=c.m_points[e],k=d.points[e];b.m_normalImpulse=
k.normalImpulse;b.m_tangentImpulse=k.tangentImpulse}};b.prototype.SolvePositionConstraints=function(a){a=a||0;for(var d=0,c=0;c<this.m_constraintCount;c++){var e=this.m_constraints[c],f=e.bodyA,k=e.bodyB,h=f.m_mass*f.m_invMass,g=f.m_mass*f.m_invI,l=k.m_mass*k.m_invMass,m=k.m_mass*k.m_invI;b.s_psm.Initialize(e);for(var q=b.s_psm.m_normal,p=0;p<e.pointCount;p++){var n=e.points[p],t=b.s_psm.m_points[p],v=b.s_psm.m_separations[p],x=t.x-f.m_sweep.c.x,w=t.y-f.m_sweep.c.y,y=t.x-k.m_sweep.c.x,t=t.y-k.m_sweep.c.y,
d=d<v?d:v,v=r.Clamp(a*(v+u.b2_linearSlop),-u.b2_maxLinearCorrection,0),v=-n.equalizedMass*v,n=v*q.x,v=v*q.y;f.m_sweep.c.x-=h*n;f.m_sweep.c.y-=h*v;f.m_sweep.a-=g*(x*v-w*n);f.SynchronizeTransform();k.m_sweep.c.x+=l*n;k.m_sweep.c.y+=l*v;k.m_sweep.a+=m*(y*v-t*n);k.SynchronizeTransform()}}return d>-1.5*u.b2_linearSlop};return b}();oa=t.Dynamics.Contacts.b2EdgeAndCircleContact=function(b){function a(){a.__super__.constructor.apply(this,arguments)}"use strict;";E(a,b);a.Create=function(d){return new a};
a.Destroy=function(a,c){};a.prototype.Reset=function(d,c){a.__super__.Reset.call(this,d,c)};a.prototype.Evaluate=function(){var a=this.m_fixtureA.GetBody(),c=this.m_fixtureB.GetBody();this.b2CollideEdgeAndCircle(this.m_manifold,this.m_fixtureA.GetShape()instanceof aa?this.m_fixtureA.GetShape():null,a.m_xf,this.m_fixtureB.GetShape()instanceof P?this.m_fixtureB.GetShape():null,c.m_xf)};a.prototype.b2CollideEdgeAndCircle=function(a,c,e,b,k){};a.prototype.GetManifold=function(){return this.m_manifold};
a.prototype.GetWorldManifold=function(a){var c=this.m_fixtureA.GetBody(),e=this.m_fixtureB.GetBody(),b=this.m_fixtureA.GetShape(),k=this.m_fixtureB.GetShape();a.Initialize(this.m_manifold,c.GetTransform(),b.m_radius,e.GetTransform(),k.m_radius)};a.prototype.IsTouching=function(){return(this.m_flags&n.e_touchingFlag)==n.e_touchingFlag};a.prototype.IsContinuous=function(){return(this.m_flags&n.e_continuousFlag)==n.e_continuousFlag};a.prototype.SetSensor=function(a){this.m_flags=a?this.m_flags|n.e_sensorFlag:
this.m_flags&~n.e_sensorFlag};a.prototype.IsSensor=function(){return(this.m_flags&n.e_sensorFlag)==n.e_sensorFlag};a.prototype.SetEnabled=function(a){this.m_flags=a?this.m_flags|n.e_enabledFlag:this.m_flags&~n.e_enabledFlag};a.prototype.IsEnabled=function(){return(this.m_flags&n.e_enabledFlag)==n.e_enabledFlag};a.prototype.GetNext=function(){return this.m_next};a.prototype.GetFixtureA=function(){return this.m_fixtureA};a.prototype.GetFixtureB=function(){return this.m_fixtureB};a.prototype.FlagForFiltering=
function(){this.m_flags|=n.e_filterFlag};a.prototype.b2Contact=function(){};a.prototype.Update=function(a){var c=this.m_oldManifold;this.m_oldManifold=this.m_manifold;this.m_manifold=c;this.m_flags|=n.e_enabledFlag;var e=!1,c=(this.m_flags&n.e_touchingFlag)==n.e_touchingFlag,b=this.m_fixtureA.m_body,k=this.m_fixtureB.m_body,h=this.m_fixtureA.m_aabb.TestOverlap(this.m_fixtureB.m_aabb);if(this.m_flags&n.e_sensorFlag)h&&(e=this.m_fixtureA.GetShape(),h=this.m_fixtureB.GetShape(),b=b.GetTransform(),k=
k.GetTransform(),e=A.TestOverlap(e,b,h,k)),this.m_manifold.m_pointCount=0;else{b.GetType()!=w.b2_dynamicBody||b.IsBullet()||k.GetType()!=w.b2_dynamicBody||k.IsBullet()?this.m_flags|=n.e_continuousFlag:this.m_flags&=~n.e_continuousFlag;if(h)for(this.Evaluate(),e=0<this.m_manifold.m_pointCount,h=0;h<this.m_manifold.m_pointCount;++h){var g=this.m_manifold.m_points[h];g.m_normalImpulse=0;g.m_tangentImpulse=0;for(var l=g.m_id,m=0;m<this.m_oldManifold.m_pointCount;++m){var q=this.m_oldManifold.m_points[m];
if(q.m_id.key==l.key){g.m_normalImpulse=q.m_normalImpulse;g.m_tangentImpulse=q.m_tangentImpulse;break}}}else this.m_manifold.m_pointCount=0;e!=c&&(b.SetAwake(!0),k.SetAwake(!0))}this.m_flags=e?this.m_flags|n.e_touchingFlag:this.m_flags&~n.e_touchingFlag;0==c&&1==e&&a.BeginContact(this);1==c&&0==e&&a.EndContact(this);0==(this.m_flags&n.e_sensorFlag)&&a.PreSolve(this,this.m_oldManifold)};a.prototype.ComputeTOI=function(a,c){n.s_input.proxyA.Set(this.m_fixtureA.GetShape());n.s_input.proxyB.Set(this.m_fixtureB.GetShape());
n.s_input.sweepA=a;n.s_input.sweepB=c;n.s_input.tolerance=u.b2_linearSlop;return O.TimeOfImpact(n.s_input)};return a}(n);t.Dynamics.Contacts.b2NullContact=function(b){function a(){a.__super__.constructor.call(this)}"use strict;";E(a,b);a.prototype.Evaluate=function(){};a.prototype.GetManifold=function(){return this.m_manifold};a.prototype.GetWorldManifold=function(a){var c=this.m_fixtureA.GetBody(),e=this.m_fixtureB.GetBody(),b=this.m_fixtureA.GetShape(),k=this.m_fixtureB.GetShape();a.Initialize(this.m_manifold,
c.GetTransform(),b.m_radius,e.GetTransform(),k.m_radius)};a.prototype.IsTouching=function(){return(this.m_flags&n.e_touchingFlag)==n.e_touchingFlag};a.prototype.IsContinuous=function(){return(this.m_flags&n.e_continuousFlag)==n.e_continuousFlag};a.prototype.SetSensor=function(a){this.m_flags=a?this.m_flags|n.e_sensorFlag:this.m_flags&~n.e_sensorFlag};a.prototype.IsSensor=function(){return(this.m_flags&n.e_sensorFlag)==n.e_sensorFlag};a.prototype.SetEnabled=function(a){this.m_flags=a?this.m_flags|
n.e_enabledFlag:this.m_flags&~n.e_enabledFlag};a.prototype.IsEnabled=function(){return(this.m_flags&n.e_enabledFlag)==n.e_enabledFlag};a.prototype.GetNext=function(){return this.m_next};a.prototype.GetFixtureA=function(){return this.m_fixtureA};a.prototype.GetFixtureB=function(){return this.m_fixtureB};a.prototype.FlagForFiltering=function(){this.m_flags|=n.e_filterFlag};a.prototype.b2Contact=function(){};a.prototype.Reset=function(a,c){a=a||null;c=c||null;this.m_flags=n.e_enabledFlag;if(a&&c){if(a.IsSensor()||
c.IsSensor())this.m_flags|=n.e_sensorFlag;var e=a.GetBody(),b=c.GetBody();if(e.GetType()!=w.b2_dynamicBody||e.IsBullet()||b.GetType()!=w.b2_dynamicBody||b.IsBullet())this.m_flags|=n.e_continuousFlag;this.m_fixtureA=a;this.m_fixtureB=c;this.m_manifold.m_pointCount=0;this.m_next=this.m_prev=null;this.m_nodeA.contact=null;this.m_nodeA.prev=null;this.m_nodeA.next=null;this.m_nodeA.other=null;this.m_nodeB.contact=null;this.m_nodeB.prev=null;this.m_nodeB.next=null;this.m_nodeB.other=null}else this.m_fixtureB=
this.m_fixtureA=null};a.prototype.Update=function(a){var c=this.m_oldManifold;this.m_oldManifold=this.m_manifold;this.m_manifold=c;this.m_flags|=n.e_enabledFlag;var e=!1,c=(this.m_flags&n.e_touchingFlag)==n.e_touchingFlag,b=this.m_fixtureA.m_body,k=this.m_fixtureB.m_body,h=this.m_fixtureA.m_aabb.TestOverlap(this.m_fixtureB.m_aabb);if(this.m_flags&n.e_sensorFlag)h&&(e=this.m_fixtureA.GetShape(),h=this.m_fixtureB.GetShape(),b=b.GetTransform(),k=k.GetTransform(),e=A.TestOverlap(e,b,h,k)),this.m_manifold.m_pointCount=
0;else{b.GetType()!=w.b2_dynamicBody||b.IsBullet()||k.GetType()!=w.b2_dynamicBody||k.IsBullet()?this.m_flags|=n.e_continuousFlag:this.m_flags&=~n.e_continuousFlag;if(h)for(this.Evaluate(),e=0<this.m_manifold.m_pointCount,h=0;h<this.m_manifold.m_pointCount;++h){var g=this.m_manifold.m_points[h];g.m_normalImpulse=0;g.m_tangentImpulse=0;for(var l=g.m_id,m=0;m<this.m_oldManifold.m_pointCount;++m){var q=this.m_oldManifold.m_points[m];if(q.m_id.key==l.key){g.m_normalImpulse=q.m_normalImpulse;g.m_tangentImpulse=
q.m_tangentImpulse;break}}}else this.m_manifold.m_pointCount=0;e!=c&&(b.SetAwake(!0),k.SetAwake(!0))}this.m_flags=e?this.m_flags|n.e_touchingFlag:this.m_flags&~n.e_touchingFlag;0==c&&1==e&&a.BeginContact(this);1==c&&0==e&&a.EndContact(this);0==(this.m_flags&n.e_sensorFlag)&&a.PreSolve(this,this.m_oldManifold)};a.prototype.ComputeTOI=function(a,c){n.s_input.proxyA.Set(this.m_fixtureA.GetShape());n.s_input.proxyB.Set(this.m_fixtureB.GetShape());n.s_input.sweepA=a;n.s_input.sweepB=c;n.s_input.tolerance=
u.b2_linearSlop;return O.TimeOfImpact(n.s_input)};return a}(n);sa=t.Dynamics.Contacts.b2PolyAndCircleContact=function(b){function a(){a.__super__.constructor.apply(this,arguments)}"use strict;";E(a,b);a.Create=function(d){return new a};a.Destroy=function(a,c){};a.prototype.Reset=function(d,c){a.__super__.Reset.call(this,d,c);u.b2Assert(d.GetType()==A.e_polygonShape);u.b2Assert(c.GetType()==A.e_circleShape)};a.prototype.Evaluate=function(){var a=this.m_fixtureA.m_body,c=this.m_fixtureB.m_body;Y.CollidePolygonAndCircle(this.m_manifold,
this.m_fixtureA.GetShape()instanceof S?this.m_fixtureA.GetShape():null,a.m_xf,this.m_fixtureB.GetShape()instanceof P?this.m_fixtureB.GetShape():null,c.m_xf)};a.prototype.GetManifold=function(){return this.m_manifold};a.prototype.GetWorldManifold=function(a){var c=this.m_fixtureA.GetBody(),e=this.m_fixtureB.GetBody(),b=this.m_fixtureA.GetShape(),k=this.m_fixtureB.GetShape();a.Initialize(this.m_manifold,c.GetTransform(),b.m_radius,e.GetTransform(),k.m_radius)};a.prototype.IsTouching=function(){return(this.m_flags&
n.e_touchingFlag)==n.e_touchingFlag};a.prototype.IsContinuous=function(){return(this.m_flags&n.e_continuousFlag)==n.e_continuousFlag};a.prototype.SetSensor=function(a){this.m_flags=a?this.m_flags|n.e_sensorFlag:this.m_flags&~n.e_sensorFlag};a.prototype.IsSensor=function(){return(this.m_flags&n.e_sensorFlag)==n.e_sensorFlag};a.prototype.SetEnabled=function(a){this.m_flags=a?this.m_flags|n.e_enabledFlag:this.m_flags&~n.e_enabledFlag};a.prototype.IsEnabled=function(){return(this.m_flags&n.e_enabledFlag)==
n.e_enabledFlag};a.prototype.GetNext=function(){return this.m_next};a.prototype.GetFixtureA=function(){return this.m_fixtureA};a.prototype.GetFixtureB=function(){return this.m_fixtureB};a.prototype.FlagForFiltering=function(){this.m_flags|=n.e_filterFlag};a.prototype.b2Contact=function(){};a.prototype.Update=function(a){var c=this.m_oldManifold;this.m_oldManifold=this.m_manifold;this.m_manifold=c;this.m_flags|=n.e_enabledFlag;var e=!1,c=(this.m_flags&n.e_touchingFlag)==n.e_touchingFlag,b=this.m_fixtureA.m_body,
k=this.m_fixtureB.m_body,h=this.m_fixtureA.m_aabb.TestOverlap(this.m_fixtureB.m_aabb);if(this.m_flags&n.e_sensorFlag)h&&(e=this.m_fixtureA.GetShape(),h=this.m_fixtureB.GetShape(),b=b.GetTransform(),k=k.GetTransform(),e=A.TestOverlap(e,b,h,k)),this.m_manifold.m_pointCount=0;else{b.GetType()!=w.b2_dynamicBody||b.IsBullet()||k.GetType()!=w.b2_dynamicBody||k.IsBullet()?this.m_flags|=n.e_continuousFlag:this.m_flags&=~n.e_continuousFlag;if(h)for(this.Evaluate(),e=0<this.m_manifold.m_pointCount,h=0;h<this.m_manifold.m_pointCount;++h){var g=
this.m_manifold.m_points[h];g.m_normalImpulse=0;g.m_tangentImpulse=0;for(var l=g.m_id,m=0;m<this.m_oldManifold.m_pointCount;++m){var q=this.m_oldManifold.m_points[m];if(q.m_id.key==l.key){g.m_normalImpulse=q.m_normalImpulse;g.m_tangentImpulse=q.m_tangentImpulse;break}}}else this.m_manifold.m_pointCount=0;e!=c&&(b.SetAwake(!0),k.SetAwake(!0))}this.m_flags=e?this.m_flags|n.e_touchingFlag:this.m_flags&~n.e_touchingFlag;0==c&&1==e&&a.BeginContact(this);1==c&&0==e&&a.EndContact(this);0==(this.m_flags&
n.e_sensorFlag)&&a.PreSolve(this,this.m_oldManifold)};a.prototype.ComputeTOI=function(a,c){n.s_input.proxyA.Set(this.m_fixtureA.GetShape());n.s_input.proxyB.Set(this.m_fixtureB.GetShape());n.s_input.sweepA=a;n.s_input.sweepB=c;n.s_input.tolerance=u.b2_linearSlop;return O.TimeOfImpact(n.s_input)};return a}(n);ta=t.Dynamics.Contacts.b2PolyAndEdgeContact=function(b){function a(){a.__super__.constructor.apply(this,arguments)}"use strict;";E(a,b);a.Create=function(d){return new a};a.Destroy=function(a,
c){};a.prototype.Reset=function(d,c){a.__super__.Reset.call(this,d,c);u.b2Assert(d.GetType()==A.e_polygonShape);u.b2Assert(c.GetType()==A.e_edgeShape)};a.prototype.Evaluate=function(){var a=this.m_fixtureA.GetBody(),c=this.m_fixtureB.GetBody();this.b2CollidePolyAndEdge(this.m_manifold,this.m_fixtureA.GetShape()instanceof S?this.m_fixtureA.GetShape():null,a.m_xf,this.m_fixtureB.GetShape()instanceof aa?this.m_fixtureB.GetShape():null,c.m_xf)};a.prototype.b2CollidePolyAndEdge=function(a,c,b,f,k){};a.prototype.GetManifold=
function(){return this.m_manifold};a.prototype.GetWorldManifold=function(a){var c=this.m_fixtureA.GetBody(),b=this.m_fixtureB.GetBody(),f=this.m_fixtureA.GetShape(),k=this.m_fixtureB.GetShape();a.Initialize(this.m_manifold,c.GetTransform(),f.m_radius,b.GetTransform(),k.m_radius)};a.prototype.IsTouching=function(){return(this.m_flags&n.e_touchingFlag)==n.e_touchingFlag};a.prototype.IsContinuous=function(){return(this.m_flags&n.e_continuousFlag)==n.e_continuousFlag};a.prototype.SetSensor=function(a){this.m_flags=
a?this.m_flags|n.e_sensorFlag:this.m_flags&~n.e_sensorFlag};a.prototype.IsSensor=function(){return(this.m_flags&n.e_sensorFlag)==n.e_sensorFlag};a.prototype.SetEnabled=function(a){this.m_flags=a?this.m_flags|n.e_enabledFlag:this.m_flags&~n.e_enabledFlag};a.prototype.IsEnabled=function(){return(this.m_flags&n.e_enabledFlag)==n.e_enabledFlag};a.prototype.GetNext=function(){return this.m_next};a.prototype.GetFixtureA=function(){return this.m_fixtureA};a.prototype.GetFixtureB=function(){return this.m_fixtureB};
a.prototype.FlagForFiltering=function(){this.m_flags|=n.e_filterFlag};a.prototype.b2Contact=function(){};a.prototype.Update=function(a){var c=this.m_oldManifold;this.m_oldManifold=this.m_manifold;this.m_manifold=c;this.m_flags|=n.e_enabledFlag;var b=!1,c=(this.m_flags&n.e_touchingFlag)==n.e_touchingFlag,f=this.m_fixtureA.m_body,k=this.m_fixtureB.m_body,h=this.m_fixtureA.m_aabb.TestOverlap(this.m_fixtureB.m_aabb);if(this.m_flags&n.e_sensorFlag)h&&(b=this.m_fixtureA.GetShape(),h=this.m_fixtureB.GetShape(),
f=f.GetTransform(),k=k.GetTransform(),b=A.TestOverlap(b,f,h,k)),this.m_manifold.m_pointCount=0;else{f.GetType()!=w.b2_dynamicBody||f.IsBullet()||k.GetType()!=w.b2_dynamicBody||k.IsBullet()?this.m_flags|=n.e_continuousFlag:this.m_flags&=~n.e_continuousFlag;if(h)for(this.Evaluate(),b=0<this.m_manifold.m_pointCount,h=0;h<this.m_manifold.m_pointCount;++h){var g=this.m_manifold.m_points[h];g.m_normalImpulse=0;g.m_tangentImpulse=0;for(var l=g.m_id,m=0;m<this.m_oldManifold.m_pointCount;++m){var q=this.m_oldManifold.m_points[m];
if(q.m_id.key==l.key){g.m_normalImpulse=q.m_normalImpulse;g.m_tangentImpulse=q.m_tangentImpulse;break}}}else this.m_manifold.m_pointCount=0;b!=c&&(f.SetAwake(!0),k.SetAwake(!0))}this.m_flags=b?this.m_flags|n.e_touchingFlag:this.m_flags&~n.e_touchingFlag;0==c&&1==b&&a.BeginContact(this);1==c&&0==b&&a.EndContact(this);0==(this.m_flags&n.e_sensorFlag)&&a.PreSolve(this,this.m_oldManifold)};a.prototype.ComputeTOI=function(a,c){n.s_input.proxyA.Set(this.m_fixtureA.GetShape());n.s_input.proxyB.Set(this.m_fixtureB.GetShape());
n.s_input.sweepA=a;n.s_input.sweepB=c;n.s_input.tolerance=u.b2_linearSlop;return O.TimeOfImpact(n.s_input)};return a}(n);ua=t.Dynamics.Contacts.b2PolygonContact=function(b){function a(){a.__super__.constructor.apply(this,arguments)}"use strict;";E(a,b);a.Create=function(d){return new a};a.Destroy=function(a,c){};a.prototype.Reset=function(d,c){a.__super__.Reset.call(this,d,c)};a.prototype.Evaluate=function(){var a=this.m_fixtureA.GetBody(),c=this.m_fixtureB.GetBody();Y.CollidePolygons(this.m_manifold,
this.m_fixtureA.GetShape()instanceof S?this.m_fixtureA.GetShape():null,a.m_xf,this.m_fixtureB.GetShape()instanceof S?this.m_fixtureB.GetShape():null,c.m_xf)};a.prototype.GetManifold=function(){return this.m_manifold};a.prototype.GetWorldManifold=function(a){var c=this.m_fixtureA.GetBody(),b=this.m_fixtureB.GetBody(),f=this.m_fixtureA.GetShape(),k=this.m_fixtureB.GetShape();a.Initialize(this.m_manifold,c.GetTransform(),f.m_radius,b.GetTransform(),k.m_radius)};a.prototype.IsTouching=function(){return(this.m_flags&
n.e_touchingFlag)==n.e_touchingFlag};a.prototype.IsContinuous=function(){return(this.m_flags&n.e_continuousFlag)==n.e_continuousFlag};a.prototype.SetSensor=function(a){this.m_flags=a?this.m_flags|n.e_sensorFlag:this.m_flags&~n.e_sensorFlag};a.prototype.IsSensor=function(){return(this.m_flags&n.e_sensorFlag)==n.e_sensorFlag};a.prototype.SetEnabled=function(a){this.m_flags=a?this.m_flags|n.e_enabledFlag:this.m_flags&~n.e_enabledFlag};a.prototype.IsEnabled=function(){return(this.m_flags&n.e_enabledFlag)==
n.e_enabledFlag};a.prototype.GetNext=function(){return this.m_next};a.prototype.GetFixtureA=function(){return this.m_fixtureA};a.prototype.GetFixtureB=function(){return this.m_fixtureB};a.prototype.FlagForFiltering=function(){this.m_flags|=n.e_filterFlag};a.prototype.b2Contact=function(){};a.prototype.Update=function(a){var c=this.m_oldManifold;this.m_oldManifold=this.m_manifold;this.m_manifold=c;this.m_flags|=n.e_enabledFlag;var b=!1,c=(this.m_flags&n.e_touchingFlag)==n.e_touchingFlag,f=this.m_fixtureA.m_body,
k=this.m_fixtureB.m_body,h=this.m_fixtureA.m_aabb.TestOverlap(this.m_fixtureB.m_aabb);if(this.m_flags&n.e_sensorFlag)h&&(b=this.m_fixtureA.GetShape(),h=this.m_fixtureB.GetShape(),f=f.GetTransform(),k=k.GetTransform(),b=A.TestOverlap(b,f,h,k)),this.m_manifold.m_pointCount=0;else{f.GetType()!=w.b2_dynamicBody||f.IsBullet()||k.GetType()!=w.b2_dynamicBody||k.IsBullet()?this.m_flags|=n.e_continuousFlag:this.m_flags&=~n.e_continuousFlag;if(h)for(this.Evaluate(),b=0<this.m_manifold.m_pointCount,h=0;h<this.m_manifold.m_pointCount;++h){var g=
this.m_manifold.m_points[h];g.m_normalImpulse=0;g.m_tangentImpulse=0;for(var l=g.m_id,m=0;m<this.m_oldManifold.m_pointCount;++m){var q=this.m_oldManifold.m_points[m];if(q.m_id.key==l.key){g.m_normalImpulse=q.m_normalImpulse;g.m_tangentImpulse=q.m_tangentImpulse;break}}}else this.m_manifold.m_pointCount=0;b!=c&&(f.SetAwake(!0),k.SetAwake(!0))}this.m_flags=b?this.m_flags|n.e_touchingFlag:this.m_flags&~n.e_touchingFlag;0==c&&1==b&&a.BeginContact(this);1==c&&0==b&&a.EndContact(this);0==(this.m_flags&
n.e_sensorFlag)&&a.PreSolve(this,this.m_oldManifold)};a.prototype.ComputeTOI=function(a,c){n.s_input.proxyA.Set(this.m_fixtureA.GetShape());n.s_input.proxyB.Set(this.m_fixtureB.GetShape());n.s_input.sweepA=a;n.s_input.sweepB=c;n.s_input.tolerance=u.b2_linearSlop;return O.TimeOfImpact(n.s_input)};return a}(n);t.Dynamics.Contacts.b2ContactFactory=Aa=function(){function b(a){this.m_allocator=a;this.InitializeRegisters()}"use strict;";b.prototype.AddType=function(a,d,c,b){c=c||0;b=b||0;this.m_registers[c][b].createFcn=
a;this.m_registers[c][b].destroyFcn=d;this.m_registers[c][b].primary=!0;c!=b&&(this.m_registers[b][c].createFcn=a,this.m_registers[b][c].destroyFcn=d,this.m_registers[b][c].primary=!1)};b.prototype.InitializeRegisters=function(){this.m_registers=new y(A.e_shapeTypeCount);for(var a=0;a<A.e_shapeTypeCount;a++){this.m_registers[a]=new y(A.e_shapeTypeCount);for(var d=0;d<A.e_shapeTypeCount;d++)this.m_registers[a][d]=new Fa}this.AddType(ia.Create,ia.Destroy,A.e_circleShape,A.e_circleShape);this.AddType(sa.Create,
sa.Destroy,A.e_polygonShape,A.e_circleShape);this.AddType(ua.Create,ua.Destroy,A.e_polygonShape,A.e_polygonShape);this.AddType(oa.Create,oa.Destroy,A.e_edgeShape,A.e_circleShape);this.AddType(ta.Create,ta.Destroy,A.e_polygonShape,A.e_edgeShape)};b.prototype.Create=function(a,d){var c=parseInt(a.GetType()),b=parseInt(d.GetType()),c=this.m_registers[c][b];if(c.pool)return b=c.pool,c.pool=b.m_next,c.poolCount--,b.Reset(a,d),b;b=c.createFcn;return null!=b?(c.primary?(b=b(this.m_allocator),b.Reset(a,d)):
(b=b(this.m_allocator),b.Reset(d,a)),b):null};b.prototype.Destroy=function(a){0<a.m_manifold.m_pointCount&&(a.m_fixtureA.m_body.SetAwake(!0),a.m_fixtureB.m_body.SetAwake(!0));var d=parseInt(a.m_fixtureA.GetType()),c=parseInt(a.m_fixtureB.GetType()),d=this.m_registers[d][c];d.poolCount++;a.m_next=d.pool;d.pool=a;d=d.destroyFcn;d(a,this.m_allocator)};return b}();t.Dynamics.Controllers.b2ControllerEdge=Q=function(){"use strict;";return function(){}}();t.Dynamics.Controllers.b2Controller=G=function(){function b(){}
"use strict;";b.prototype.Step=function(a){};b.prototype.Draw=function(a){};b.prototype.AddBody=function(a){var d=new Q;d.controller=this;d.body=a;d.nextBody=this.m_bodyList;d.prevBody=null;this.m_bodyList=d;d.nextBody&&(d.nextBody.prevBody=d);this.m_bodyCount++;d.nextController=a.m_controllerList;d.prevController=null;a.m_controllerList=d;d.nextController&&(d.nextController.prevController=d);a.m_controllerCount++};b.prototype.RemoveBody=function(a){for(var d=a.m_controllerList;d&&d.controller!=this;)d=
d.nextController;d.prevBody&&(d.prevBody.nextBody=d.nextBody);d.nextBody&&(d.nextBody.prevBody=d.prevBody);d.nextController&&(d.nextController.prevController=d.prevController);d.prevController&&(d.prevController.nextController=d.nextController);this.m_bodyList==d&&(this.m_bodyList=d.nextBody);a.m_controllerList==d&&(a.m_controllerList=d.nextController);a.m_controllerCount--;this.m_bodyCount--};b.prototype.Clear=function(){for(;this.m_bodyList;)this.RemoveBody(this.m_bodyList.body)};b.prototype.GetNext=
function(){return this.m_next};b.prototype.GetWorld=function(){return this.m_world};b.prototype.GetBodyList=function(){return this.m_bodyList};return b}();t.Dynamics.Controllers.b2BuoyancyController=function(b){function a(){this.normal=new p(0,-1);this.density=this.offset=0;this.velocity=new p(0,0);this.linearDrag=2;this.angularDrag=1;this.useDensity=!1;this.useWorldGravity=!0;this.gravity=null;a.__super__.constructor.apply(this,arguments)}"use strict;";E(a,b);a.prototype.Step=function(a){if(this.m_bodyList)for(this.useWorldGravity&&
(this.gravity=this.GetWorld().GetGravity().Copy()),a=this.m_bodyList;a;a=a.nextBody){var c=a.body;if(0!=c.IsAwake()){for(var b=new p,f=new p,k=0,h=0,g=c.GetFixtureList();g;g=g.GetNext()){var l=new p,m=g.GetShape().ComputeSubmergedArea(this.normal,this.offset,c.GetTransform(),l),k=k+m;b.x+=m*l.x;b.y+=m*l.y;var q=0,q=1,h=h+m*q;f.x+=m*l.x*q;f.y+=m*l.y*q}b.x/=k;b.y/=k;f.x/=h;f.y/=h;k<Number.MIN_VALUE||(h=this.gravity.GetNegative(),h.Multiply(this.density*k),c.ApplyForce(h,f),f=c.GetLinearVelocityFromWorldPoint(b),
f.Subtract(this.velocity),f.Multiply(-this.linearDrag*k),c.ApplyForce(f,b),c.ApplyTorque(-c.GetInertia()/c.GetMass()*k*c.GetAngularVelocity()*this.angularDrag))}}};a.prototype.Draw=function(a){var c=new p,b=new p;c.x=this.normal.x*this.offset+1E3*this.normal.y;c.y=this.normal.y*this.offset-1E3*this.normal.x;b.x=this.normal.x*this.offset-1E3*this.normal.y;b.y=this.normal.y*this.offset+1E3*this.normal.x;var f=new Z(0,0,1);a.DrawSegment(c,b,f)};a.prototype.AddBody=function(a){var c=new Q;c.controller=
this;c.body=a;c.nextBody=this.m_bodyList;c.prevBody=null;this.m_bodyList=c;c.nextBody&&(c.nextBody.prevBody=c);this.m_bodyCount++;c.nextController=a.m_controllerList;c.prevController=null;a.m_controllerList=c;c.nextController&&(c.nextController.prevController=c);a.m_controllerCount++};a.prototype.RemoveBody=function(a){for(var c=a.m_controllerList;c&&c.controller!=this;)c=c.nextController;c.prevBody&&(c.prevBody.nextBody=c.nextBody);c.nextBody&&(c.nextBody.prevBody=c.prevBody);c.nextController&&(c.nextController.prevController=
c.prevController);c.prevController&&(c.prevController.nextController=c.nextController);this.m_bodyList==c&&(this.m_bodyList=c.nextBody);a.m_controllerList==c&&(a.m_controllerList=c.nextController);a.m_controllerCount--;this.m_bodyCount--};a.prototype.Clear=function(){for(;this.m_bodyList;)this.RemoveBody(this.m_bodyList.body)};a.prototype.GetNext=function(){return this.m_next};a.prototype.GetWorld=function(){return this.m_world};a.prototype.GetBodyList=function(){return this.m_bodyList};return a}(G);
t.Dynamics.Controllers.b2ConstantAccelController=function(b){function a(){this.A=new p(0,0);a.__super__.constructor.apply(this,arguments)}"use strict;";E(a,b);a.prototype.Step=function(a){a=new p(this.A.x*a.dt,this.A.y*a.dt);for(var c=this.m_bodyList;c;c=c.nextBody){var b=c.body;b.IsAwake()&&b.SetLinearVelocity(new p(b.GetLinearVelocity().x+a.x,b.GetLinearVelocity().y+a.y))}};a.prototype.Draw=function(a){};a.prototype.AddBody=function(a){var c=new Q;c.controller=this;c.body=a;c.nextBody=this.m_bodyList;
c.prevBody=null;this.m_bodyList=c;c.nextBody&&(c.nextBody.prevBody=c);this.m_bodyCount++;c.nextController=a.m_controllerList;c.prevController=null;a.m_controllerList=c;c.nextController&&(c.nextController.prevController=c);a.m_controllerCount++};a.prototype.RemoveBody=function(a){for(var c=a.m_controllerList;c&&c.controller!=this;)c=c.nextController;c.prevBody&&(c.prevBody.nextBody=c.nextBody);c.nextBody&&(c.nextBody.prevBody=c.prevBody);c.nextController&&(c.nextController.prevController=c.prevController);
c.prevController&&(c.prevController.nextController=c.nextController);this.m_bodyList==c&&(this.m_bodyList=c.nextBody);a.m_controllerList==c&&(a.m_controllerList=c.nextController);a.m_controllerCount--;this.m_bodyCount--};a.prototype.Clear=function(){for(;this.m_bodyList;)this.RemoveBody(this.m_bodyList.body)};a.prototype.GetNext=function(){return this.m_next};a.prototype.GetWorld=function(){return this.m_world};a.prototype.GetBodyList=function(){return this.m_bodyList};return a}(G);t.Dynamics.Controllers.b2ConstantForceController=
function(b){function a(){this.F=new p(0,0);a.__super__.constructor.apply(this,arguments)}"use strict;";E(a,b);a.prototype.Step=function(a){for(a=this.m_bodyList;a;a=a.nextBody){var c=a.body;c.IsAwake()&&c.ApplyForce(this.F,c.GetWorldCenter())}};a.prototype.Draw=function(a){};a.prototype.AddBody=function(a){var c=new Q;c.controller=this;c.body=a;c.nextBody=this.m_bodyList;c.prevBody=null;this.m_bodyList=c;c.nextBody&&(c.nextBody.prevBody=c);this.m_bodyCount++;c.nextController=a.m_controllerList;c.prevController=
null;a.m_controllerList=c;c.nextController&&(c.nextController.prevController=c);a.m_controllerCount++};a.prototype.RemoveBody=function(a){for(var c=a.m_controllerList;c&&c.controller!=this;)c=c.nextController;c.prevBody&&(c.prevBody.nextBody=c.nextBody);c.nextBody&&(c.nextBody.prevBody=c.prevBody);c.nextController&&(c.nextController.prevController=c.prevController);c.prevController&&(c.prevController.nextController=c.nextController);this.m_bodyList==c&&(this.m_bodyList=c.nextBody);a.m_controllerList==
c&&(a.m_controllerList=c.nextController);a.m_controllerCount--;this.m_bodyCount--};a.prototype.Clear=function(){for(;this.m_bodyList;)this.RemoveBody(this.m_bodyList.body)};a.prototype.GetNext=function(){return this.m_next};a.prototype.GetWorld=function(){return this.m_world};a.prototype.GetBodyList=function(){return this.m_bodyList};return a}(G);t.Dynamics.Controllers.b2GravityController=function(b){function a(){this.G=1;this.invSqr=!0;a.__super__.constructor.apply(this,arguments)}"use strict;";
E(a,b);a.prototype.Step=function(a){var c=a=null,b=null,f=0,k=null,h=null,g=null,l=0,m=0,q=0,l=null;if(this.invSqr)for(a=this.m_bodyList;a;a=a.nextBody)for(c=a.body,b=c.GetWorldCenter(),f=c.GetMass(),k=this.m_bodyList;k!=a;k=k.nextBody)h=k.body,g=h.GetWorldCenter(),l=g.x-b.x,m=g.y-b.y,q=l*l+m*m,q<Number.MIN_VALUE||(l=new p(l,m),l.Multiply(this.G/q/Math.sqrt(q)*f*h.GetMass()),c.IsAwake()&&c.ApplyForce(l,b),l.Multiply(-1),h.IsAwake()&&h.ApplyForce(l,g));else for(a=this.m_bodyList;a;a=a.nextBody)for(c=
a.body,b=c.GetWorldCenter(),f=c.GetMass(),k=this.m_bodyList;k!=a;k=k.nextBody)h=k.body,g=h.GetWorldCenter(),l=g.x-b.x,m=g.y-b.y,q=l*l+m*m,q<Number.MIN_VALUE||(l=new p(l,m),l.Multiply(this.G/q*f*h.GetMass()),c.IsAwake()&&c.ApplyForce(l,b),l.Multiply(-1),h.IsAwake()&&h.ApplyForce(l,g))};a.prototype.Draw=function(a){};a.prototype.AddBody=function(a){var c=new Q;c.controller=this;c.body=a;c.nextBody=this.m_bodyList;c.prevBody=null;this.m_bodyList=c;c.nextBody&&(c.nextBody.prevBody=c);this.m_bodyCount++;
c.nextController=a.m_controllerList;c.prevController=null;a.m_controllerList=c;c.nextController&&(c.nextController.prevController=c);a.m_controllerCount++};a.prototype.RemoveBody=function(a){for(var c=a.m_controllerList;c&&c.controller!=this;)c=c.nextController;c.prevBody&&(c.prevBody.nextBody=c.nextBody);c.nextBody&&(c.nextBody.prevBody=c.prevBody);c.nextController&&(c.nextController.prevController=c.prevController);c.prevController&&(c.prevController.nextController=c.nextController);this.m_bodyList==
c&&(this.m_bodyList=c.nextBody);a.m_controllerList==c&&(a.m_controllerList=c.nextController);a.m_controllerCount--;this.m_bodyCount--};a.prototype.Clear=function(){for(;this.m_bodyList;)this.RemoveBody(this.m_bodyList.body)};a.prototype.GetNext=function(){return this.m_next};a.prototype.GetWorld=function(){return this.m_world};a.prototype.GetBodyList=function(){return this.m_bodyList};return a}(G);t.Dynamics.Controllers.b2TensorDampingController=function(b){function a(){this.T=new C;this.maxTimestep=
0;a.__super__.constructor.apply(this,arguments)}"use strict;";E(a,b);a.prototype.SetAxisAligned=function(a,c){a=a||0;c=c||0;this.T.col1.x=-a;this.T.col1.y=0;this.T.col2.x=0;this.T.col2.y=-c;this.maxTimestep=0<a||0<c?1/Math.max(a,c):0};a.prototype.Step=function(a){a=a.dt;if(!(a<=Number.MIN_VALUE)){a>this.maxTimestep&&0<this.maxTimestep&&(a=this.maxTimestep);for(var c=this.m_bodyList;c;c=c.nextBody){var b=c.body;if(b.IsAwake()){var f=b.GetWorldVector(r.MulMV(this.T,b.GetLocalVector(b.GetLinearVelocity())));
b.SetLinearVelocity(new p(b.GetLinearVelocity().x+f.x*a,b.GetLinearVelocity().y+f.y*a))}}}};a.prototype.Draw=function(a){};a.prototype.AddBody=function(a){var c=new Q;c.controller=this;c.body=a;c.nextBody=this.m_bodyList;c.prevBody=null;this.m_bodyList=c;c.nextBody&&(c.nextBody.prevBody=c);this.m_bodyCount++;c.nextController=a.m_controllerList;c.prevController=null;a.m_controllerList=c;c.nextController&&(c.nextController.prevController=c);a.m_controllerCount++};a.prototype.RemoveBody=function(a){for(var c=
a.m_controllerList;c&&c.controller!=this;)c=c.nextController;c.prevBody&&(c.prevBody.nextBody=c.nextBody);c.nextBody&&(c.nextBody.prevBody=c.prevBody);c.nextController&&(c.nextController.prevController=c.prevController);c.prevController&&(c.prevController.nextController=c.nextController);this.m_bodyList==c&&(this.m_bodyList=c.nextBody);a.m_controllerList==c&&(a.m_controllerList=c.nextController);a.m_controllerCount--;this.m_bodyCount--};a.prototype.Clear=function(){for(;this.m_bodyList;)this.RemoveBody(this.m_bodyList.body)};
a.prototype.GetNext=function(){return this.m_next};a.prototype.GetWorld=function(){return this.m_world};a.prototype.GetBodyList=function(){return this.m_bodyList};return a}(G);t.Dynamics.Joints.b2Joint=v=function(){function b(a){this.m_edgeA=new qa;this.m_edgeB=new qa;this.m_localCenterA=new p;this.m_localCenterB=new p;u.b2Assert(a.bodyA!=a.bodyB);this.m_type=a.type;this.m_next=this.m_prev=null;this.m_bodyA=a.bodyA;this.m_bodyB=a.bodyB;this.m_collideConnected=a.collideConnected;this.m_islandFlag=
!1;this.m_userData=a.userData}"use strict;";b.e_unknownJoint=0;b.e_revoluteJoint=1;b.e_prismaticJoint=2;b.e_distanceJoint=3;b.e_pulleyJoint=4;b.e_mouseJoint=5;b.e_gearJoint=6;b.e_lineJoint=7;b.e_weldJoint=8;b.e_frictionJoint=9;b.e_inactiveLimit=0;b.e_atLowerLimit=1;b.e_atUpperLimit=2;b.e_equalLimits=3;b.Create=function(a,d){var c=null;switch(a.type){case b.e_distanceJoint:c=new Ha(a instanceof Ia?a:null);break;case b.e_mouseJoint:c=new Wa(a instanceof Xa?a:null);break;case b.e_prismaticJoint:c=new ca(a instanceof
Za?a:null);break;case b.e_revoluteJoint:c=new da(a instanceof bb?a:null);break;case b.e_pulleyJoint:c=new X(a instanceof $a?a:null);break;case b.e_gearJoint:c=new Qa(a instanceof Ra?a:null);break;case b.e_lineJoint:c=new Ua(a instanceof Va?a:null);break;case b.e_weldJoint:c=new fb(a instanceof gb?a:null);break;case b.e_frictionJoint:c=new Oa(a instanceof Pa?a:null)}return c};b.Destroy=function(a,d){};b.prototype.GetType=function(){return this.m_type};b.prototype.GetAnchorA=function(){return null};
b.prototype.GetAnchorB=function(){return null};b.prototype.GetReactionForce=function(a){return null};b.prototype.GetReactionTorque=function(a){return 0};b.prototype.GetBodyA=function(){return this.m_bodyA};b.prototype.GetBodyB=function(){return this.m_bodyB};b.prototype.GetNext=function(){return this.m_next};b.prototype.GetUserData=function(){return this.m_userData};b.prototype.SetUserData=function(a){this.m_userData=a};b.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()};
b.prototype.InitVelocityConstraints=function(a){};b.prototype.SolveVelocityConstraints=function(a){};b.prototype.FinalizeVelocityConstraints=function(){};b.prototype.SolvePositionConstraints=function(a){return!1};return b}();t.Dynamics.Joints.b2JointDef=G=function(){"use strict;";return function(){this.type=v.e_unknownJoint;this.bodyB=this.bodyA=this.userData=null;this.collideConnected=!1}}();t.Dynamics.Joints.b2JointEdge=qa=function(){"use strict;";return function(){}}();t.Dynamics.Joints.b2Jacobian=
Ta=function(){function b(){this.linearA=new p;this.linearB=new p}"use strict;";b.prototype.SetZero=function(){this.linearA.SetZero();this.angularA=0;this.linearB.SetZero();this.angularB=0};b.prototype.Set=function(a,d,c,b){d=d||0;b=b||0;this.linearA.SetV(a);this.angularA=d;this.linearB.SetV(c);this.angularB=b};b.prototype.Compute=function(a,d,c,b){return this.linearA.x*a.x+this.linearA.y*a.y+this.angularA*(d||0)+(this.linearB.x*c.x+this.linearB.y*c.y)+this.angularB*(b||0)};return b}();Ha=t.Dynamics.Joints.b2DistanceJoint=
function(b){function a(d){this.m_localAnchor1=new p;this.m_localAnchor2=new p;this.m_u=new p;a.__super__.constructor.call(this,d);this.m_localAnchor1.SetV(d.localAnchorA);this.m_localAnchor2.SetV(d.localAnchorB);this.m_length=d.length;this.m_frequencyHz=d.frequencyHz;this.m_dampingRatio=d.dampingRatio;this.m_bias=this.m_gamma=this.m_impulse=0}"use strict;";E(a,b);a.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};a.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};
a.prototype.GetReactionForce=function(a){a=a||0;return new p(a*this.m_impulse*this.m_u.x,a*this.m_impulse*this.m_u.y)};a.prototype.GetReactionTorque=function(a){return 0};a.prototype.GetLength=function(){return this.m_length};a.prototype.SetLength=function(a){this.m_length=a||0};a.prototype.GetFrequency=function(){return this.m_frequencyHz};a.prototype.SetFrequency=function(a){this.m_frequencyHz=a||0};a.prototype.GetDampingRatio=function(){return this.m_dampingRatio};a.prototype.SetDampingRatio=function(a){this.m_dampingRatio=
a||0};a.prototype.InitVelocityConstraints=function(a){var c,b=0,f=this.m_bodyA,k=this.m_bodyB;c=f.m_xf.R;var h=this.m_localAnchor1.x-f.m_sweep.localCenter.x,g=this.m_localAnchor1.y-f.m_sweep.localCenter.y,b=c.col1.x*h+c.col2.x*g,g=c.col1.y*h+c.col2.y*g,h=b;c=k.m_xf.R;var l=this.m_localAnchor2.x-k.m_sweep.localCenter.x,m=this.m_localAnchor2.y-k.m_sweep.localCenter.y,b=c.col1.x*l+c.col2.x*m,m=c.col1.y*l+c.col2.y*m,l=b;this.m_u.x=k.m_sweep.c.x+l-f.m_sweep.c.x-h;this.m_u.y=k.m_sweep.c.y+m-f.m_sweep.c.y-
g;b=Math.sqrt(this.m_u.x*this.m_u.x+this.m_u.y*this.m_u.y);b>u.b2_linearSlop?this.m_u.Multiply(1/b):this.m_u.SetZero();c=h*this.m_u.y-g*this.m_u.x;var q=l*this.m_u.y-m*this.m_u.x;c=f.m_invMass+f.m_invI*c*c+k.m_invMass+k.m_invI*q*q;this.m_mass=0!=c?1/c:0;if(0<this.m_frequencyHz){var b=b-this.m_length,q=2*Math.PI*this.m_frequencyHz,p=this.m_mass*q*q;this.m_gamma=a.dt*(2*this.m_mass*this.m_dampingRatio*q+a.dt*p);this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0;this.m_bias=b*a.dt*p*this.m_gamma;this.m_mass=
c+this.m_gamma;this.m_mass=0!=this.m_mass?1/this.m_mass:0}a.warmStarting?(this.m_impulse*=a.dtRatio,a=this.m_impulse*this.m_u.x,c=this.m_impulse*this.m_u.y,f.m_linearVelocity.x-=f.m_invMass*a,f.m_linearVelocity.y-=f.m_invMass*c,f.m_angularVelocity-=f.m_invI*(h*c-g*a),k.m_linearVelocity.x+=k.m_invMass*a,k.m_linearVelocity.y+=k.m_invMass*c,k.m_angularVelocity+=k.m_invI*(l*c-m*a)):this.m_impulse=0};a.prototype.SolveVelocityConstraints=function(a){var c;a=this.m_bodyA;var b=this.m_bodyB;c=a.m_xf.R;var f=
this.m_localAnchor1.x-a.m_sweep.localCenter.x,k=this.m_localAnchor1.y-a.m_sweep.localCenter.y,h=c.col1.x*f+c.col2.x*k,k=c.col1.y*f+c.col2.y*k,f=h;c=b.m_xf.R;var g=this.m_localAnchor2.x-b.m_sweep.localCenter.x,l=this.m_localAnchor2.y-b.m_sweep.localCenter.y,h=c.col1.x*g+c.col2.x*l,l=c.col1.y*g+c.col2.y*l,g=h,h=-this.m_mass*(this.m_u.x*(b.m_linearVelocity.x+-b.m_angularVelocity*l-(a.m_linearVelocity.x+-a.m_angularVelocity*k))+this.m_u.y*(b.m_linearVelocity.y+b.m_angularVelocity*g-(a.m_linearVelocity.y+
a.m_angularVelocity*f))+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=h;c=h*this.m_u.x;h*=this.m_u.y;a.m_linearVelocity.x-=a.m_invMass*c;a.m_linearVelocity.y-=a.m_invMass*h;a.m_angularVelocity-=a.m_invI*(f*h-k*c);b.m_linearVelocity.x+=b.m_invMass*c;b.m_linearVelocity.y+=b.m_invMass*h;b.m_angularVelocity+=b.m_invI*(g*h-l*c)};a.prototype.SolvePositionConstraints=function(a){var c;if(0<this.m_frequencyHz)return!0;a=this.m_bodyA;var b=this.m_bodyB;c=a.m_xf.R;var f=this.m_localAnchor1.x-a.m_sweep.localCenter.x,
k=this.m_localAnchor1.y-a.m_sweep.localCenter.y,h=c.col1.x*f+c.col2.x*k,k=c.col1.y*f+c.col2.y*k,f=h;c=b.m_xf.R;var g=this.m_localAnchor2.x-b.m_sweep.localCenter.x,l=this.m_localAnchor2.y-b.m_sweep.localCenter.y,h=c.col1.x*g+c.col2.x*l,l=c.col1.y*g+c.col2.y*l,g=h,h=b.m_sweep.c.x+g-a.m_sweep.c.x-f,m=b.m_sweep.c.y+l-a.m_sweep.c.y-k;c=Math.sqrt(h*h+m*m);h/=c;m/=c;c-=this.m_length;c=r.Clamp(c,-u.b2_maxLinearCorrection,u.b2_maxLinearCorrection);var q=-this.m_mass*c;this.m_u.Set(h,m);h=q*this.m_u.x;m=q*
this.m_u.y;a.m_sweep.c.x-=a.m_invMass*h;a.m_sweep.c.y-=a.m_invMass*m;a.m_sweep.a-=a.m_invI*(f*m-k*h);b.m_sweep.c.x+=b.m_invMass*h;b.m_sweep.c.y+=b.m_invMass*m;b.m_sweep.a+=b.m_invI*(g*m-l*h);a.SynchronizeTransform();b.SynchronizeTransform();return r.Abs(c)<u.b2_linearSlop};a.prototype.GetType=function(){return this.m_type};a.prototype.GetBodyA=function(){return this.m_bodyA};a.prototype.GetBodyB=function(){return this.m_bodyB};a.prototype.GetNext=function(){return this.m_next};a.prototype.GetUserData=
function(){return this.m_userData};a.prototype.SetUserData=function(a){this.m_userData=a};a.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()};a.prototype.b2Joint=function(a){u.b2Assert(a.bodyA!=a.bodyB);this.m_type=a.type;this.m_next=this.m_prev=null;this.m_bodyA=a.bodyA;this.m_bodyB=a.bodyB;this.m_collideConnected=a.collideConnected;this.m_islandFlag=!1;this.m_userData=a.userData};a.prototype.FinalizeVelocityConstraints=function(){};return a}(v);Ia=t.Dynamics.Joints.b2DistanceJointDef=
function(b){function a(){this.localAnchorA=new p;this.localAnchorB=new p;a.__super__.constructor.call(this);this.type=v.e_distanceJoint;this.length=1;this.dampingRatio=this.frequencyHz=0}"use strict;";E(a,b);a.prototype.Initialize=function(a,c,b,f){this.bodyA=a;this.bodyB=c;this.localAnchorA.SetV(this.bodyA.GetLocalPoint(b));this.localAnchorB.SetV(this.bodyB.GetLocalPoint(f));a=f.x-b.x;b=f.y-b.y;this.length=Math.sqrt(a*a+b*b);this.dampingRatio=this.frequencyHz=0};a.prototype.b2JointDef=function(){this.type=
v.e_unknownJoint;this.bodyB=this.bodyA=this.userData=null;this.collideConnected=!1};return a}(G);Oa=t.Dynamics.Joints.b2FrictionJoint=function(b){function a(d){this.m_localAnchorA=new p;this.m_localAnchorB=new p;this.m_linearMass=new C;this.m_linearImpulse=new p;a.__super__.constructor.call(this,d);this.m_localAnchorA.SetV(d.localAnchorA);this.m_localAnchorB.SetV(d.localAnchorB);this.m_linearMass.SetZero();this.m_angularMass=0;this.m_linearImpulse.SetZero();this.m_angularImpulse=0;this.m_maxForce=
d.maxForce;this.m_maxTorque=d.maxTorque}"use strict;";E(a,b);a.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)};a.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)};a.prototype.GetReactionForce=function(a){a=a||0;return new p(a*this.m_linearImpulse.x,a*this.m_linearImpulse.y)};a.prototype.GetReactionTorque=function(a){return(a||0)*this.m_angularImpulse};a.prototype.SetMaxForce=function(a){this.m_maxForce=a||0};a.prototype.GetMaxForce=
function(){return this.m_maxForce};a.prototype.SetMaxTorque=function(a){this.m_maxTorque=a||0};a.prototype.GetMaxTorque=function(){return this.m_maxTorque};a.prototype.InitVelocityConstraints=function(a){var c,b=0,f=this.m_bodyA,k=this.m_bodyB;c=f.m_xf.R;var h=this.m_localAnchorA.x-f.m_sweep.localCenter.x,g=this.m_localAnchorA.y-f.m_sweep.localCenter.y,b=c.col1.x*h+c.col2.x*g,g=c.col1.y*h+c.col2.y*g,h=b;c=k.m_xf.R;var l=this.m_localAnchorB.x-k.m_sweep.localCenter.x,m=this.m_localAnchorB.y-k.m_sweep.localCenter.y,
b=c.col1.x*l+c.col2.x*m,m=c.col1.y*l+c.col2.y*m,l=b;c=f.m_invMass;var b=k.m_invMass,q=f.m_invI,p=k.m_invI,n=new C;n.col1.x=c+b;n.col2.x=0;n.col1.y=0;n.col2.y=c+b;n.col1.x+=q*g*g;n.col2.x+=-q*h*g;n.col1.y+=-q*h*g;n.col2.y+=q*h*h;n.col1.x+=p*m*m;n.col2.x+=-p*l*m;n.col1.y+=-p*l*m;n.col2.y+=p*l*l;n.GetInverse(this.m_linearMass);this.m_angularMass=q+p;0<this.m_angularMass&&(this.m_angularMass=1/this.m_angularMass);a.warmStarting?(this.m_linearImpulse.x*=a.dtRatio,this.m_linearImpulse.y*=a.dtRatio,this.m_angularImpulse*=
a.dtRatio,a=this.m_linearImpulse,f.m_linearVelocity.x-=c*a.x,f.m_linearVelocity.y-=c*a.y,f.m_angularVelocity-=q*(h*a.y-g*a.x+this.m_angularImpulse),k.m_linearVelocity.x+=b*a.x,k.m_linearVelocity.y+=b*a.y,k.m_angularVelocity+=p*(l*a.y-m*a.x+this.m_angularImpulse)):(this.m_linearImpulse.SetZero(),this.m_angularImpulse=0)};a.prototype.SolveVelocityConstraints=function(a){var c,b=0,f=this.m_bodyA,k=this.m_bodyB,h=f.m_linearVelocity,g=f.m_angularVelocity,l=k.m_linearVelocity,m=k.m_angularVelocity,q=f.m_invMass,
n=k.m_invMass,u=f.m_invI,t=k.m_invI;c=f.m_xf.R;var v=this.m_localAnchorA.x-f.m_sweep.localCenter.x,x=this.m_localAnchorA.y-f.m_sweep.localCenter.y,b=c.col1.x*v+c.col2.x*x,x=c.col1.y*v+c.col2.y*x,v=b;c=k.m_xf.R;var w=this.m_localAnchorB.x-k.m_sweep.localCenter.x,y=this.m_localAnchorB.y-k.m_sweep.localCenter.y,b=c.col1.x*w+c.col2.x*y,y=c.col1.y*w+c.col2.y*y,w=b;c=0;var b=-this.m_angularMass*(m-g),A=this.m_angularImpulse;c=a.dt*this.m_maxTorque;this.m_angularImpulse=r.Clamp(this.m_angularImpulse+b,-c,
c);b=this.m_angularImpulse-A;g-=u*b;m+=t*b;c=r.MulMV(this.m_linearMass,new p(-(l.x-m*y-h.x+g*x),-(l.y+m*w-h.y-g*v)));b=this.m_linearImpulse.Copy();this.m_linearImpulse.Add(c);c=a.dt*this.m_maxForce;this.m_linearImpulse.LengthSquared()>c*c&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.Multiply(c));c=r.SubtractVV(this.m_linearImpulse,b);h.x-=q*c.x;h.y-=q*c.y;g-=u*(v*c.y-x*c.x);l.x+=n*c.x;l.y+=n*c.y;m+=t*(w*c.y-y*c.x);f.m_angularVelocity=g;k.m_angularVelocity=m};a.prototype.SolvePositionConstraints=
function(a){return!0};a.prototype.GetType=function(){return this.m_type};a.prototype.GetBodyA=function(){return this.m_bodyA};a.prototype.GetBodyB=function(){return this.m_bodyB};a.prototype.GetNext=function(){return this.m_next};a.prototype.GetUserData=function(){return this.m_userData};a.prototype.SetUserData=function(a){this.m_userData=a};a.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()};a.prototype.b2Joint=function(a){u.b2Assert(a.bodyA!=a.bodyB);this.m_type=
a.type;this.m_next=this.m_prev=null;this.m_bodyA=a.bodyA;this.m_bodyB=a.bodyB;this.m_collideConnected=a.collideConnected;this.m_islandFlag=!1;this.m_userData=a.userData};a.prototype.FinalizeVelocityConstraints=function(){};return a}(v);Pa=t.Dynamics.Joints.b2FrictionJointDef=function(b){function a(){this.localAnchorA=new p;this.localAnchorB=new p;a.__super__.constructor.call(this);this.type=v.e_frictionJoint;this.maxTorque=this.maxForce=0}"use strict;";E(a,b);a.prototype.Initialize=function(a,c,b){this.bodyA=
a;this.bodyB=c;this.localAnchorA.SetV(this.bodyA.GetLocalPoint(b));this.localAnchorB.SetV(this.bodyB.GetLocalPoint(b))};a.prototype.b2JointDef=function(){this.type=v.e_unknownJoint;this.bodyB=this.bodyA=this.userData=null;this.collideConnected=!1};return a}(G);Qa=t.Dynamics.Joints.b2GearJoint=function(b){function a(d){this.m_groundAnchor1=new p;this.m_groundAnchor2=new p;this.m_localAnchor1=new p;this.m_localAnchor2=new p;this.m_J=new Ta;a.__super__.constructor.call(this,d);var c=parseInt(d.joint1.m_type),
b=parseInt(d.joint2.m_type);this.m_prismatic2=this.m_revolute2=this.m_prismatic1=this.m_revolute1=null;var f=0,k=0;this.m_ground1=d.joint1.GetBodyA();this.m_bodyA=d.joint1.GetBodyB();c==v.e_revoluteJoint?(this.m_revolute1=d.joint1 instanceof da?d.joint1:null,this.m_groundAnchor1.SetV(this.m_revolute1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_revolute1.m_localAnchor2),f=this.m_revolute1.GetJointAngle()):(this.m_prismatic1=d.joint1 instanceof ca?d.joint1:null,this.m_groundAnchor1.SetV(this.m_prismatic1.m_localAnchor1),
this.m_localAnchor1.SetV(this.m_prismatic1.m_localAnchor2),f=this.m_prismatic1.GetJointTranslation());this.m_ground2=d.joint2.GetBodyA();this.m_bodyB=d.joint2.GetBodyB();b==v.e_revoluteJoint?(this.m_revolute2=d.joint2 instanceof da?d.joint2:null,this.m_groundAnchor2.SetV(this.m_revolute2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_revolute2.m_localAnchor2),k=this.m_revolute2.GetJointAngle()):(this.m_prismatic2=d.joint2 instanceof ca?d.joint2:null,this.m_groundAnchor2.SetV(this.m_prismatic2.m_localAnchor1),
this.m_localAnchor2.SetV(this.m_prismatic2.m_localAnchor2),k=this.m_prismatic2.GetJointTranslation());this.m_ratio=d.ratio;this.m_constant=f+this.m_ratio*k;this.m_impulse=0}"use strict;";E(a,b);a.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};a.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};a.prototype.GetReactionForce=function(a){a=a||0;return new p(a*this.m_impulse*this.m_J.linearB.x,a*this.m_impulse*this.m_J.linearB.y)};
a.prototype.GetReactionTorque=function(a){var c=this.m_bodyB.m_xf.R,b=this.m_localAnchor1.x-this.m_bodyB.m_sweep.localCenter.x,f=this.m_localAnchor1.y-this.m_bodyB.m_sweep.localCenter.y,k=c.col1.x*b+c.col2.x*f,f=c.col1.y*b+c.col2.y*f;return(a||0)*(this.m_impulse*this.m_J.angularB-k*this.m_impulse*this.m_J.linearB.y+f*this.m_impulse*this.m_J.linearB.x)};a.prototype.GetRatio=function(){return this.m_ratio};a.prototype.SetRatio=function(a){this.m_ratio=a||0};a.prototype.InitVelocityConstraints=function(a){var c=
this.m_ground1,b=this.m_ground2,f=this.m_bodyA,k=this.m_bodyB,h=0,g=0,l=0,m=0,q=l=0,p=0;this.m_J.SetZero();this.m_revolute1?(this.m_J.angularA=-1,p+=f.m_invI):(c=c.m_xf.R,g=this.m_prismatic1.m_localXAxis1,h=c.col1.x*g.x+c.col2.x*g.y,g=c.col1.y*g.x+c.col2.y*g.y,c=f.m_xf.R,l=this.m_localAnchor1.x-f.m_sweep.localCenter.x,m=this.m_localAnchor1.y-f.m_sweep.localCenter.y,q=c.col1.x*l+c.col2.x*m,m=c.col1.y*l+c.col2.y*m,l=q*g-m*h,this.m_J.linearA.Set(-h,-g),this.m_J.angularA=-l,p+=f.m_invMass+f.m_invI*l*
l);this.m_revolute2?(this.m_J.angularB=-this.m_ratio,p+=this.m_ratio*this.m_ratio*k.m_invI):(c=b.m_xf.R,g=this.m_prismatic2.m_localXAxis1,h=c.col1.x*g.x+c.col2.x*g.y,g=c.col1.y*g.x+c.col2.y*g.y,c=k.m_xf.R,l=this.m_localAnchor2.x-k.m_sweep.localCenter.x,m=this.m_localAnchor2.y-k.m_sweep.localCenter.y,q=c.col1.x*l+c.col2.x*m,m=c.col1.y*l+c.col2.y*m,l=q*g-m*h,this.m_J.linearB.Set(-this.m_ratio*h,-this.m_ratio*g),this.m_J.angularB=-this.m_ratio*l,p+=this.m_ratio*this.m_ratio*(k.m_invMass+k.m_invI*l*l));
this.m_mass=0<p?1/p:0;a.warmStarting?(f.m_linearVelocity.x+=f.m_invMass*this.m_impulse*this.m_J.linearA.x,f.m_linearVelocity.y+=f.m_invMass*this.m_impulse*this.m_J.linearA.y,f.m_angularVelocity+=f.m_invI*this.m_impulse*this.m_J.angularA,k.m_linearVelocity.x+=k.m_invMass*this.m_impulse*this.m_J.linearB.x,k.m_linearVelocity.y+=k.m_invMass*this.m_impulse*this.m_J.linearB.y,k.m_angularVelocity+=k.m_invI*this.m_impulse*this.m_J.angularB):this.m_impulse=0};a.prototype.SolveVelocityConstraints=function(a){a=
this.m_bodyA;var c=this.m_bodyB,b=this.m_J.Compute(a.m_linearVelocity,a.m_angularVelocity,c.m_linearVelocity,c.m_angularVelocity),b=-this.m_mass*b;this.m_impulse+=b;a.m_linearVelocity.x+=a.m_invMass*b*this.m_J.linearA.x;a.m_linearVelocity.y+=a.m_invMass*b*this.m_J.linearA.y;a.m_angularVelocity+=a.m_invI*b*this.m_J.angularA;c.m_linearVelocity.x+=c.m_invMass*b*this.m_J.linearB.x;c.m_linearVelocity.y+=c.m_invMass*b*this.m_J.linearB.y;c.m_angularVelocity+=c.m_invI*b*this.m_J.angularB};a.prototype.SolvePositionConstraints=
function(a){a=this.m_bodyA;var c=this.m_bodyB,b=0,f=0,b=this.m_revolute1?this.m_revolute1.GetJointAngle():this.m_prismatic1.GetJointTranslation(),f=this.m_revolute2?this.m_revolute2.GetJointAngle():this.m_prismatic2.GetJointTranslation(),b=-this.m_mass*(this.m_constant-(b+this.m_ratio*f));a.m_sweep.c.x+=a.m_invMass*b*this.m_J.linearA.x;a.m_sweep.c.y+=a.m_invMass*b*this.m_J.linearA.y;a.m_sweep.a+=a.m_invI*b*this.m_J.angularA;c.m_sweep.c.x+=c.m_invMass*b*this.m_J.linearB.x;c.m_sweep.c.y+=c.m_invMass*
b*this.m_J.linearB.y;c.m_sweep.a+=c.m_invI*b*this.m_J.angularB;a.SynchronizeTransform();c.SynchronizeTransform();return 0<u.b2_linearSlop};a.prototype.GetType=function(){return this.m_type};a.prototype.GetBodyA=function(){return this.m_bodyA};a.prototype.GetBodyB=function(){return this.m_bodyB};a.prototype.GetNext=function(){return this.m_next};a.prototype.GetUserData=function(){return this.m_userData};a.prototype.SetUserData=function(a){this.m_userData=a};a.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&
this.m_bodyB.IsActive()};a.prototype.b2Joint=function(a){u.b2Assert(a.bodyA!=a.bodyB);this.m_type=a.type;this.m_next=this.m_prev=null;this.m_bodyA=a.bodyA;this.m_bodyB=a.bodyB;this.m_collideConnected=a.collideConnected;this.m_islandFlag=!1;this.m_userData=a.userData};a.prototype.FinalizeVelocityConstraints=function(){};return a}(v);Ra=t.Dynamics.Joints.b2GearJointDef=function(b){function a(){a.__super__.constructor.call(this);this.type=v.e_gearJoint;this.joint2=this.joint1=null;this.ratio=1}"use strict;";
E(a,b);a.prototype.b2JointDef=function(){this.type=v.e_unknownJoint;this.bodyB=this.bodyA=this.userData=null;this.collideConnected=!1};return a}(G);Ua=t.Dynamics.Joints.b2LineJoint=function(b){function a(d){this.m_localAnchor1=new p;this.m_localAnchor2=new p;this.m_localXAxis1=new p;this.m_localYAxis1=new p;this.m_axis=new p;this.m_perp=new p;this.m_K=new C;this.m_impulse=new p;a.__super__.constructor.call(this,d);this.m_localAnchor1.SetV(d.localAnchorA);this.m_localAnchor2.SetV(d.localAnchorB);this.m_localXAxis1.SetV(d.localAxisA);
this.m_localYAxis1.x=-this.m_localXAxis1.y;this.m_localYAxis1.y=this.m_localXAxis1.x;this.m_impulse.SetZero();this.m_motorImpulse=this.m_motorMass=0;this.m_lowerTranslation=d.lowerTranslation;this.m_upperTranslation=d.upperTranslation;this.m_maxMotorForce=d.maxMotorForce;this.m_motorSpeed=d.motorSpeed;this.m_enableLimit=d.enableLimit;this.m_enableMotor=d.enableMotor;this.m_limitState=v.e_inactiveLimit;this.m_axis.SetZero();this.m_perp.SetZero()}"use strict;";E(a,b);a.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};
a.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};a.prototype.GetReactionForce=function(a){a=a||0;return new p(a*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x),a*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y))};a.prototype.GetReactionTorque=function(a){return(a||0)*this.m_impulse.y};a.prototype.GetJointTranslation=function(){var a=this.m_bodyA,c=this.m_bodyB,b=a.GetWorldPoint(this.m_localAnchor1),
f=c.GetWorldPoint(this.m_localAnchor2),c=f.x-b.x,b=f.y-b.y,a=a.GetWorldVector(this.m_localXAxis1);return a.x*c+a.y*b};a.prototype.GetJointSpeed=function(){var a=this.m_bodyA,c=this.m_bodyB,b;b=a.m_xf.R;var f=this.m_localAnchor1.x-a.m_sweep.localCenter.x,k=this.m_localAnchor1.y-a.m_sweep.localCenter.y,h=b.col1.x*f+b.col2.x*k,k=b.col1.y*f+b.col2.y*k,f=h;b=c.m_xf.R;var g=this.m_localAnchor2.x-c.m_sweep.localCenter.x,l=this.m_localAnchor2.y-c.m_sweep.localCenter.y,h=b.col1.x*g+b.col2.x*l,l=b.col1.y*g+
b.col2.y*l,g=h;b=c.m_sweep.c.x+g-(a.m_sweep.c.x+f);var h=c.m_sweep.c.y+l-(a.m_sweep.c.y+k),m=a.GetWorldVector(this.m_localXAxis1),q=a.m_linearVelocity,p=c.m_linearVelocity,a=a.m_angularVelocity,c=c.m_angularVelocity;return b*-a*m.y+h*a*m.x+(m.x*(p.x+-c*l-q.x- -a*k)+m.y*(p.y+c*g-q.y-a*f))};a.prototype.IsLimitEnabled=function(){return this.m_enableLimit};a.prototype.EnableLimit=function(a){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_enableLimit=a};a.prototype.GetLowerLimit=function(){return this.m_lowerTranslation};
a.prototype.GetUpperLimit=function(){return this.m_upperTranslation};a.prototype.SetLimits=function(a,c){a=a||0;c=c||0;this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_lowerTranslation=a;this.m_upperTranslation=c};a.prototype.IsMotorEnabled=function(){return this.m_enableMotor};a.prototype.EnableMotor=function(a){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_enableMotor=a};a.prototype.SetMotorSpeed=function(a){a=a||0;this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_motorSpeed=
a};a.prototype.GetMotorSpeed=function(){return this.m_motorSpeed};a.prototype.SetMaxMotorForce=function(a){a=a||0;this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_maxMotorForce=a};a.prototype.GetMaxMotorForce=function(){return this.m_maxMotorForce};a.prototype.GetMotorForce=function(){return this.m_motorImpulse};a.prototype.InitVelocityConstraints=function(a){var c=this.m_bodyA,b=this.m_bodyB,f,k=0;this.m_localCenterA.SetV(c.GetLocalCenter());this.m_localCenterB.SetV(b.GetLocalCenter());
var h=c.GetTransform();b.GetTransform();f=c.m_xf.R;var g=this.m_localAnchor1.x-this.m_localCenterA.x,l=this.m_localAnchor1.y-this.m_localCenterA.y,k=f.col1.x*g+f.col2.x*l,l=f.col1.y*g+f.col2.y*l,g=k;f=b.m_xf.R;var m=this.m_localAnchor2.x-this.m_localCenterB.x,q=this.m_localAnchor2.y-this.m_localCenterB.y,k=f.col1.x*m+f.col2.x*q,q=f.col1.y*m+f.col2.y*q,m=k;f=b.m_sweep.c.x+m-c.m_sweep.c.x-g;k=b.m_sweep.c.y+q-c.m_sweep.c.y-l;this.m_invMassA=c.m_invMass;this.m_invMassB=b.m_invMass;this.m_invIA=c.m_invI;
this.m_invIB=b.m_invI;this.m_axis.SetV(r.MulMV(h.R,this.m_localXAxis1));this.m_a1=(f+g)*this.m_axis.y-(k+l)*this.m_axis.x;this.m_a2=m*this.m_axis.y-q*this.m_axis.x;this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2;this.m_motorMass=this.m_motorMass>Number.MIN_VALUE?1/this.m_motorMass:0;this.m_perp.SetV(r.MulMV(h.R,this.m_localYAxis1));this.m_s1=(f+g)*this.m_perp.y-(k+l)*this.m_perp.x;this.m_s2=m*this.m_perp.y-q*this.m_perp.x;h=this.m_invMassA;
g=this.m_invMassB;l=this.m_invIA;m=this.m_invIB;this.m_K.col1.x=h+g+l*this.m_s1*this.m_s1+m*this.m_s2*this.m_s2;this.m_K.col1.y=l*this.m_s1*this.m_a1+m*this.m_s2*this.m_a2;this.m_K.col2.x=this.m_K.col1.y;this.m_K.col2.y=h+g+l*this.m_a1*this.m_a1+m*this.m_a2*this.m_a2;this.m_enableLimit?(f=this.m_axis.x*f+this.m_axis.y*k,r.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*u.b2_linearSlop?this.m_limitState=v.e_equalLimits:f<=this.m_lowerTranslation?this.m_limitState!=v.e_atLowerLimit&&(this.m_limitState=
v.e_atLowerLimit,this.m_impulse.y=0):f>=this.m_upperTranslation?this.m_limitState!=v.e_atUpperLimit&&(this.m_limitState=v.e_atUpperLimit,this.m_impulse.y=0):(this.m_limitState=v.e_inactiveLimit,this.m_impulse.y=0)):this.m_limitState=v.e_inactiveLimit;0==this.m_enableMotor&&(this.m_motorImpulse=0);a.warmStarting?(this.m_impulse.x*=a.dtRatio,this.m_impulse.y*=a.dtRatio,this.m_motorImpulse*=a.dtRatio,a=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x,f=this.m_impulse.x*
this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y,k=this.m_impulse.x*this.m_s1+(this.m_motorImpulse+this.m_impulse.y)*this.m_a1,h=this.m_impulse.x*this.m_s2+(this.m_motorImpulse+this.m_impulse.y)*this.m_a2,c.m_linearVelocity.x-=this.m_invMassA*a,c.m_linearVelocity.y-=this.m_invMassA*f,c.m_angularVelocity-=this.m_invIA*k,b.m_linearVelocity.x+=this.m_invMassB*a,b.m_linearVelocity.y+=this.m_invMassB*f,b.m_angularVelocity+=this.m_invIB*h):(this.m_impulse.SetZero(),this.m_motorImpulse=
0)};a.prototype.SolveVelocityConstraints=function(a){var c=this.m_bodyA,b=this.m_bodyB,f=c.m_linearVelocity,k=c.m_angularVelocity,h=b.m_linearVelocity,g=b.m_angularVelocity,l=0,m=0,q=0,n=0;this.m_enableMotor&&this.m_limitState!=v.e_equalLimits&&(n=this.m_motorMass*(this.m_motorSpeed-(this.m_axis.x*(h.x-f.x)+this.m_axis.y*(h.y-f.y)+this.m_a2*g-this.m_a1*k)),l=this.m_motorImpulse,m=a.dt*this.m_maxMotorForce,this.m_motorImpulse=r.Clamp(this.m_motorImpulse+n,-m,m),n=this.m_motorImpulse-l,l=n*this.m_axis.x,
m=n*this.m_axis.y,q=n*this.m_a1,n*=this.m_a2,f.x-=this.m_invMassA*l,f.y-=this.m_invMassA*m,k-=this.m_invIA*q,h.x+=this.m_invMassB*l,h.y+=this.m_invMassB*m,g+=this.m_invIB*n);m=this.m_perp.x*(h.x-f.x)+this.m_perp.y*(h.y-f.y)+this.m_s2*g-this.m_s1*k;this.m_enableLimit&&this.m_limitState!=v.e_inactiveLimit?(q=this.m_axis.x*(h.x-f.x)+this.m_axis.y*(h.y-f.y)+this.m_a2*g-this.m_a1*k,l=this.m_impulse.Copy(),a=this.m_K.Solve(new p,-m,-q),this.m_impulse.Add(a),this.m_limitState==v.e_atLowerLimit?this.m_impulse.y=
r.Max(this.m_impulse.y,0):this.m_limitState==v.e_atUpperLimit&&(this.m_impulse.y=r.Min(this.m_impulse.y,0)),m=-m-(this.m_impulse.y-l.y)*this.m_K.col2.x,q=0,q=0!=this.m_K.col1.x?m/this.m_K.col1.x+l.x:l.x,this.m_impulse.x=q,a.x=this.m_impulse.x-l.x,a.y=this.m_impulse.y-l.y,l=a.x*this.m_perp.x+a.y*this.m_axis.x,m=a.x*this.m_perp.y+a.y*this.m_axis.y,q=a.x*this.m_s1+a.y*this.m_a1,n=a.x*this.m_s2+a.y*this.m_a2):(a=0,a=0!=this.m_K.col1.x?-m/this.m_K.col1.x:0,this.m_impulse.x+=a,l=a*this.m_perp.x,m=a*this.m_perp.y,
q=a*this.m_s1,n=a*this.m_s2);f.x-=this.m_invMassA*l;f.y-=this.m_invMassA*m;k-=this.m_invIA*q;h.x+=this.m_invMassB*l;h.y+=this.m_invMassB*m;g+=this.m_invIB*n;c.m_linearVelocity.SetV(f);c.m_angularVelocity=k;b.m_linearVelocity.SetV(h);b.m_angularVelocity=g};a.prototype.SolvePositionConstraints=function(a){a=this.m_bodyA;var c=this.m_bodyB,b=a.m_sweep.c,f=a.m_sweep.a,k=c.m_sweep.c,h=c.m_sweep.a,g,l=0,m=0,q=0,n=0,t=g=0,v=0,m=!1,D=0,x=C.FromAngle(f),q=C.FromAngle(h);g=x;var v=this.m_localAnchor1.x-this.m_localCenterA.x,
w=this.m_localAnchor1.y-this.m_localCenterA.y,l=g.col1.x*v+g.col2.x*w,w=g.col1.y*v+g.col2.y*w,v=l;g=q;q=this.m_localAnchor2.x-this.m_localCenterB.x;n=this.m_localAnchor2.y-this.m_localCenterB.y;l=g.col1.x*q+g.col2.x*n;n=g.col1.y*q+g.col2.y*n;q=l;g=k.x+q-b.x-v;l=k.y+n-b.y-w;if(this.m_enableLimit){this.m_axis=r.MulMV(x,this.m_localXAxis1);this.m_a1=(g+v)*this.m_axis.y-(l+w)*this.m_axis.x;this.m_a2=q*this.m_axis.y-n*this.m_axis.x;var y=this.m_axis.x*g+this.m_axis.y*l;r.Abs(this.m_upperTranslation-this.m_lowerTranslation)<
2*u.b2_linearSlop?(D=r.Clamp(y,-u.b2_maxLinearCorrection,u.b2_maxLinearCorrection),t=r.Abs(y),m=!0):y<=this.m_lowerTranslation?(D=r.Clamp(y-this.m_lowerTranslation+u.b2_linearSlop,-u.b2_maxLinearCorrection,0),t=this.m_lowerTranslation-y,m=!0):y>=this.m_upperTranslation&&(D=r.Clamp(y-this.m_upperTranslation+u.b2_linearSlop,0,u.b2_maxLinearCorrection),t=y-this.m_upperTranslation,m=!0)}this.m_perp=r.MulMV(x,this.m_localYAxis1);this.m_s1=(g+v)*this.m_perp.y-(l+w)*this.m_perp.x;this.m_s2=q*this.m_perp.y-
n*this.m_perp.x;x=new p;w=this.m_perp.x*g+this.m_perp.y*l;t=r.Max(t,r.Abs(w));v=0;m?(m=this.m_invMassA,q=this.m_invMassB,n=this.m_invIA,g=this.m_invIB,this.m_K.col1.x=m+q+n*this.m_s1*this.m_s1+g*this.m_s2*this.m_s2,this.m_K.col1.y=n*this.m_s1*this.m_a1+g*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=m+q+n*this.m_a1*this.m_a1+g*this.m_a2*this.m_a2,this.m_K.Solve(x,-w,-D)):(m=this.m_invMassA,q=this.m_invMassB,n=this.m_invIA,g=this.m_invIB,D=m+q+n*this.m_s1*this.m_s1+g*this.m_s2*
this.m_s2,x.x=0!=D?-w/D:0,x.y=0);D=x.x*this.m_perp.x+x.y*this.m_axis.x;m=x.x*this.m_perp.y+x.y*this.m_axis.y;w=x.x*this.m_s1+x.y*this.m_a1;x=x.x*this.m_s2+x.y*this.m_a2;b.x-=this.m_invMassA*D;b.y-=this.m_invMassA*m;f-=this.m_invIA*w;k.x+=this.m_invMassB*D;k.y+=this.m_invMassB*m;h+=this.m_invIB*x;a.m_sweep.a=f;c.m_sweep.a=h;a.SynchronizeTransform();c.SynchronizeTransform();return t<=u.b2_linearSlop&&v<=u.b2_angularSlop};a.prototype.GetType=function(){return this.m_type};a.prototype.GetBodyA=function(){return this.m_bodyA};
a.prototype.GetBodyB=function(){return this.m_bodyB};a.prototype.GetNext=function(){return this.m_next};a.prototype.GetUserData=function(){return this.m_userData};a.prototype.SetUserData=function(a){this.m_userData=a};a.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()};a.prototype.b2Joint=function(a){u.b2Assert(a.bodyA!=a.bodyB);this.m_type=a.type;this.m_next=this.m_prev=null;this.m_bodyA=a.bodyA;this.m_bodyB=a.bodyB;this.m_collideConnected=a.collideConnected;
this.m_islandFlag=!1;this.m_userData=a.userData};a.prototype.FinalizeVelocityConstraints=function(){};return a}(v);Va=t.Dynamics.Joints.b2LineJointDef=function(b){function a(){this.localAnchorA=new p;this.localAnchorB=new p;this.localAxisA=new p;a.__super__.constructor.call(this);this.type=v.e_lineJoint;this.localAxisA.Set(1,0);this.enableLimit=!1;this.upperTranslation=this.lowerTranslation=0;this.enableMotor=!1;this.motorSpeed=this.maxMotorForce=0}"use strict;";E(a,b);a.prototype.Initialize=function(a,
c,b,f){this.bodyA=a;this.bodyB=c;this.localAnchorA=this.bodyA.GetLocalPoint(b);this.localAnchorB=this.bodyB.GetLocalPoint(b);this.localAxisA=this.bodyA.GetLocalVector(f)};a.prototype.b2JointDef=function(){this.type=v.e_unknownJoint;this.bodyB=this.bodyA=this.userData=null;this.collideConnected=!1};return a}(G);Wa=t.Dynamics.Joints.b2MouseJoint=function(b){function a(d){this.K=new C;this.K1=new C;this.K2=new C;this.m_localAnchor=new p;this.m_target=new p;this.m_impulse=new p;this.m_mass=new C;this.m_C=
new p;a.__super__.constructor.call(this,d);this.m_target.SetV(d.target);var c=this.m_target.x-this.m_bodyB.m_xf.position.x,b=this.m_target.y-this.m_bodyB.m_xf.position.y,f=this.m_bodyB.m_xf.R;this.m_localAnchor.x=c*f.col1.x+b*f.col1.y;this.m_localAnchor.y=c*f.col2.x+b*f.col2.y;this.m_maxForce=d.maxForce;this.m_impulse.SetZero();this.m_frequencyHz=d.frequencyHz;this.m_dampingRatio=d.dampingRatio;this.m_gamma=this.m_beta=0}"use strict;";E(a,b);a.prototype.GetAnchorA=function(){return this.m_target};
a.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor)};a.prototype.GetReactionForce=function(a){a=a||0;return new p(a*this.m_impulse.x,a*this.m_impulse.y)};a.prototype.GetReactionTorque=function(a){return 0};a.prototype.GetTarget=function(){return this.m_target};a.prototype.SetTarget=function(a){0==this.m_bodyB.IsAwake()&&this.m_bodyB.SetAwake(!0);this.m_target=a};a.prototype.GetMaxForce=function(){return this.m_maxForce};a.prototype.SetMaxForce=function(a){this.m_maxForce=
a||0};a.prototype.GetFrequency=function(){return this.m_frequencyHz};a.prototype.SetFrequency=function(a){this.m_frequencyHz=a||0};a.prototype.GetDampingRatio=function(){return this.m_dampingRatio};a.prototype.SetDampingRatio=function(a){this.m_dampingRatio=a||0};a.prototype.InitVelocityConstraints=function(a){var c=this.m_bodyB,b=c.GetMass(),f=2*Math.PI*this.m_frequencyHz,k=b*f*f;this.m_gamma=a.dt*(2*b*this.m_dampingRatio*f+a.dt*k);this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0;this.m_beta=a.dt*k*
this.m_gamma;var k=c.m_xf.R,b=this.m_localAnchor.x-c.m_sweep.localCenter.x,f=this.m_localAnchor.y-c.m_sweep.localCenter.y,h=k.col1.x*b+k.col2.x*f,f=k.col1.y*b+k.col2.y*f,b=h,k=c.m_invMass,h=c.m_invI;this.K1.col1.x=k;this.K1.col2.x=0;this.K1.col1.y=0;this.K1.col2.y=k;this.K2.col1.x=h*f*f;this.K2.col2.x=-h*b*f;this.K2.col1.y=-h*b*f;this.K2.col2.y=h*b*b;this.K.SetM(this.K1);this.K.AddM(this.K2);this.K.col1.x+=this.m_gamma;this.K.col2.y+=this.m_gamma;this.K.GetInverse(this.m_mass);this.m_C.x=c.m_sweep.c.x+
b-this.m_target.x;this.m_C.y=c.m_sweep.c.y+f-this.m_target.y;c.m_angularVelocity*=.98;this.m_impulse.x*=a.dtRatio;this.m_impulse.y*=a.dtRatio;c.m_linearVelocity.x+=k*this.m_impulse.x;c.m_linearVelocity.y+=k*this.m_impulse.y;c.m_angularVelocity+=h*(b*this.m_impulse.y-f*this.m_impulse.x)};a.prototype.SolveVelocityConstraints=function(a){var c=this.m_bodyB,b,f=0,k=0;b=c.m_xf.R;var h=this.m_localAnchor.x-c.m_sweep.localCenter.x,g=this.m_localAnchor.y-c.m_sweep.localCenter.y,f=b.col1.x*h+b.col2.x*g,g=
b.col1.y*h+b.col2.y*g,h=f,f=c.m_linearVelocity.x+-c.m_angularVelocity*g,l=c.m_linearVelocity.y+c.m_angularVelocity*h;b=this.m_mass;f=f+this.m_beta*this.m_C.x+this.m_gamma*this.m_impulse.x;k=l+this.m_beta*this.m_C.y+this.m_gamma*this.m_impulse.y;l=-(b.col1.x*f+b.col2.x*k);k=-(b.col1.y*f+b.col2.y*k);b=this.m_impulse.x;f=this.m_impulse.y;this.m_impulse.x+=l;this.m_impulse.y+=k;a=a.dt*this.m_maxForce;this.m_impulse.LengthSquared()>a*a&&this.m_impulse.Multiply(a/this.m_impulse.Length());l=this.m_impulse.x-
b;k=this.m_impulse.y-f;c.m_linearVelocity.x+=c.m_invMass*l;c.m_linearVelocity.y+=c.m_invMass*k;c.m_angularVelocity+=c.m_invI*(h*k-g*l)};a.prototype.SolvePositionConstraints=function(a){return!0};a.prototype.GetType=function(){return this.m_type};a.prototype.GetBodyA=function(){return this.m_bodyA};a.prototype.GetBodyB=function(){return this.m_bodyB};a.prototype.GetNext=function(){return this.m_next};a.prototype.GetUserData=function(){return this.m_userData};a.prototype.SetUserData=function(a){this.m_userData=
a};a.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()};a.prototype.b2Joint=function(a){u.b2Assert(a.bodyA!=a.bodyB);this.m_type=a.type;this.m_next=this.m_prev=null;this.m_bodyA=a.bodyA;this.m_bodyB=a.bodyB;this.m_collideConnected=a.collideConnected;this.m_islandFlag=!1;this.m_userData=a.userData};a.prototype.FinalizeVelocityConstraints=function(){};return a}(v);Xa=t.Dynamics.Joints.b2MouseJointDef=function(b){function a(){this.target=new p;a.__super__.constructor.call(this);
this.type=v.e_mouseJoint;this.maxForce=0;this.frequencyHz=5;this.dampingRatio=.7}"use strict;";E(a,b);a.prototype.b2JointDef=function(){this.type=v.e_unknownJoint;this.bodyB=this.bodyA=this.userData=null;this.collideConnected=!1};return a}(G);ca=t.Dynamics.Joints.b2PrismaticJoint=function(b){function a(b){this.m_localAnchor1=new p;this.m_localAnchor2=new p;this.m_localXAxis1=new p;this.m_localYAxis1=new p;this.m_axis=new p;this.m_perp=new p;this.m_K=new W;this.m_impulse=new J;a.__super__.constructor.call(this,
b);this.m_localAnchor1.SetV(b.localAnchorA);this.m_localAnchor2.SetV(b.localAnchorB);this.m_localXAxis1.SetV(b.localAxisA);this.m_localYAxis1.x=-this.m_localXAxis1.y;this.m_localYAxis1.y=this.m_localXAxis1.x;this.m_refAngle=b.referenceAngle;this.m_impulse.SetZero();this.m_motorImpulse=this.m_motorMass=0;this.m_lowerTranslation=b.lowerTranslation;this.m_upperTranslation=b.upperTranslation;this.m_maxMotorForce=b.maxMotorForce;this.m_motorSpeed=b.motorSpeed;this.m_enableLimit=b.enableLimit;this.m_enableMotor=
b.enableMotor;this.m_limitState=v.e_inactiveLimit;this.m_axis.SetZero();this.m_perp.SetZero()}"use strict;";E(a,b);a.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};a.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};a.prototype.GetReactionForce=function(a){a=a||0;return new p(a*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x),a*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*
this.m_axis.y))};a.prototype.GetReactionTorque=function(a){return(a||0)*this.m_impulse.y};a.prototype.GetJointTranslation=function(){var a=this.m_bodyA,c=this.m_bodyB,b=a.GetWorldPoint(this.m_localAnchor1),f=c.GetWorldPoint(this.m_localAnchor2),c=f.x-b.x,b=f.y-b.y,a=a.GetWorldVector(this.m_localXAxis1);return a.x*c+a.y*b};a.prototype.GetJointSpeed=function(){var a=this.m_bodyA,c=this.m_bodyB,b;b=a.m_xf.R;var f=this.m_localAnchor1.x-a.m_sweep.localCenter.x,k=this.m_localAnchor1.y-a.m_sweep.localCenter.y,
h=b.col1.x*f+b.col2.x*k,k=b.col1.y*f+b.col2.y*k,f=h;b=c.m_xf.R;var g=this.m_localAnchor2.x-c.m_sweep.localCenter.x,l=this.m_localAnchor2.y-c.m_sweep.localCenter.y,h=b.col1.x*g+b.col2.x*l,l=b.col1.y*g+b.col2.y*l,g=h;b=c.m_sweep.c.x+g-(a.m_sweep.c.x+f);var h=c.m_sweep.c.y+l-(a.m_sweep.c.y+k),m=a.GetWorldVector(this.m_localXAxis1),q=a.m_linearVelocity,p=c.m_linearVelocity,a=a.m_angularVelocity,c=c.m_angularVelocity;return b*-a*m.y+h*a*m.x+(m.x*(p.x+-c*l-q.x- -a*k)+m.y*(p.y+c*g-q.y-a*f))};a.prototype.IsLimitEnabled=
function(){return this.m_enableLimit};a.prototype.EnableLimit=function(a){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_enableLimit=a};a.prototype.GetLowerLimit=function(){return this.m_lowerTranslation};a.prototype.GetUpperLimit=function(){return this.m_upperTranslation};a.prototype.SetLimits=function(a,c){a=a||0;c=c||0;this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_lowerTranslation=a;this.m_upperTranslation=c};a.prototype.IsMotorEnabled=function(){return this.m_enableMotor};
a.prototype.EnableMotor=function(a){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_enableMotor=a};a.prototype.SetMotorSpeed=function(a){a=a||0;this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_motorSpeed=a};a.prototype.GetMotorSpeed=function(){return this.m_motorSpeed};a.prototype.SetMaxMotorForce=function(a){a=a||0;this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_maxMotorForce=a};a.prototype.GetMotorForce=function(){return this.m_motorImpulse};a.prototype.InitVelocityConstraints=
function(a){var c=this.m_bodyA,b=this.m_bodyB,f,k=0;this.m_localCenterA.SetV(c.GetLocalCenter());this.m_localCenterB.SetV(b.GetLocalCenter());var h=c.GetTransform();b.GetTransform();f=c.m_xf.R;var g=this.m_localAnchor1.x-this.m_localCenterA.x,l=this.m_localAnchor1.y-this.m_localCenterA.y,k=f.col1.x*g+f.col2.x*l,l=f.col1.y*g+f.col2.y*l,g=k;f=b.m_xf.R;var m=this.m_localAnchor2.x-this.m_localCenterB.x,q=this.m_localAnchor2.y-this.m_localCenterB.y,k=f.col1.x*m+f.col2.x*q,q=f.col1.y*m+f.col2.y*q,m=k;f=
b.m_sweep.c.x+m-c.m_sweep.c.x-g;k=b.m_sweep.c.y+q-c.m_sweep.c.y-l;this.m_invMassA=c.m_invMass;this.m_invMassB=b.m_invMass;this.m_invIA=c.m_invI;this.m_invIB=b.m_invI;this.m_axis.SetV(r.MulMV(h.R,this.m_localXAxis1));this.m_a1=(f+g)*this.m_axis.y-(k+l)*this.m_axis.x;this.m_a2=m*this.m_axis.y-q*this.m_axis.x;this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2;this.m_motorMass>Number.MIN_VALUE&&(this.m_motorMass=1/this.m_motorMass);this.m_perp.SetV(r.MulMV(h.R,
this.m_localYAxis1));this.m_s1=(f+g)*this.m_perp.y-(k+l)*this.m_perp.x;this.m_s2=m*this.m_perp.y-q*this.m_perp.x;h=this.m_invMassA;g=this.m_invMassB;l=this.m_invIA;m=this.m_invIB;this.m_K.col1.x=h+g+l*this.m_s1*this.m_s1+m*this.m_s2*this.m_s2;this.m_K.col1.y=l*this.m_s1+m*this.m_s2;this.m_K.col1.z=l*this.m_s1*this.m_a1+m*this.m_s2*this.m_a2;this.m_K.col2.x=this.m_K.col1.y;this.m_K.col2.y=l+m;this.m_K.col2.z=l*this.m_a1+m*this.m_a2;this.m_K.col3.x=this.m_K.col1.z;this.m_K.col3.y=this.m_K.col2.z;this.m_K.col3.z=
h+g+l*this.m_a1*this.m_a1+m*this.m_a2*this.m_a2;this.m_enableLimit?(f=this.m_axis.x*f+this.m_axis.y*k,r.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*u.b2_linearSlop?this.m_limitState=v.e_equalLimits:f<=this.m_lowerTranslation?this.m_limitState!=v.e_atLowerLimit&&(this.m_limitState=v.e_atLowerLimit,this.m_impulse.z=0):f>=this.m_upperTranslation?this.m_limitState!=v.e_atUpperLimit&&(this.m_limitState=v.e_atUpperLimit,this.m_impulse.z=0):(this.m_limitState=v.e_inactiveLimit,this.m_impulse.z=
0)):this.m_limitState=v.e_inactiveLimit;0==this.m_enableMotor&&(this.m_motorImpulse=0);a.warmStarting?(this.m_impulse.x*=a.dtRatio,this.m_impulse.y*=a.dtRatio,this.m_motorImpulse*=a.dtRatio,a=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x,f=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y,k=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,h=this.m_impulse.x*this.m_s2+this.m_impulse.y+
(this.m_motorImpulse+this.m_impulse.z)*this.m_a2,c.m_linearVelocity.x-=this.m_invMassA*a,c.m_linearVelocity.y-=this.m_invMassA*f,c.m_angularVelocity-=this.m_invIA*k,b.m_linearVelocity.x+=this.m_invMassB*a,b.m_linearVelocity.y+=this.m_invMassB*f,b.m_angularVelocity+=this.m_invIB*h):(this.m_impulse.SetZero(),this.m_motorImpulse=0)};a.prototype.SolveVelocityConstraints=function(a){var c=this.m_bodyA,b=this.m_bodyB,f=c.m_linearVelocity,k=c.m_angularVelocity,h=b.m_linearVelocity,g=b.m_angularVelocity,
l=0,m=0,q=0,n=0;this.m_enableMotor&&this.m_limitState!=v.e_equalLimits&&(n=this.m_motorMass*(this.m_motorSpeed-(this.m_axis.x*(h.x-f.x)+this.m_axis.y*(h.y-f.y)+this.m_a2*g-this.m_a1*k)),l=this.m_motorImpulse,a=a.dt*this.m_maxMotorForce,this.m_motorImpulse=r.Clamp(this.m_motorImpulse+n,-a,a),n=this.m_motorImpulse-l,l=n*this.m_axis.x,m=n*this.m_axis.y,q=n*this.m_a1,n*=this.m_a2,f.x-=this.m_invMassA*l,f.y-=this.m_invMassA*m,k-=this.m_invIA*q,h.x+=this.m_invMassB*l,h.y+=this.m_invMassB*m,g+=this.m_invIB*
n);q=this.m_perp.x*(h.x-f.x)+this.m_perp.y*(h.y-f.y)+this.m_s2*g-this.m_s1*k;m=g-k;this.m_enableLimit&&this.m_limitState!=v.e_inactiveLimit?(a=this.m_axis.x*(h.x-f.x)+this.m_axis.y*(h.y-f.y)+this.m_a2*g-this.m_a1*k,l=this.m_impulse.Copy(),a=this.m_K.Solve33(new J,-q,-m,-a),this.m_impulse.Add(a),this.m_limitState==v.e_atLowerLimit?this.m_impulse.z=r.Max(this.m_impulse.z,0):this.m_limitState==v.e_atUpperLimit&&(this.m_impulse.z=r.Min(this.m_impulse.z,0)),q=-q-(this.m_impulse.z-l.z)*this.m_K.col3.x,
m=-m-(this.m_impulse.z-l.z)*this.m_K.col3.y,m=this.m_K.Solve22(new p,q,m),m.x+=l.x,m.y+=l.y,this.m_impulse.x=m.x,this.m_impulse.y=m.y,a.x=this.m_impulse.x-l.x,a.y=this.m_impulse.y-l.y,a.z=this.m_impulse.z-l.z,l=a.x*this.m_perp.x+a.z*this.m_axis.x,m=a.x*this.m_perp.y+a.z*this.m_axis.y,q=a.x*this.m_s1+a.y+a.z*this.m_a1,n=a.x*this.m_s2+a.y+a.z*this.m_a2):(a=this.m_K.Solve22(new p,-q,-m),this.m_impulse.x+=a.x,this.m_impulse.y+=a.y,l=a.x*this.m_perp.x,m=a.x*this.m_perp.y,q=a.x*this.m_s1+a.y,n=a.x*this.m_s2+
a.y);f.x-=this.m_invMassA*l;f.y-=this.m_invMassA*m;k-=this.m_invIA*q;h.x+=this.m_invMassB*l;h.y+=this.m_invMassB*m;g+=this.m_invIB*n;c.m_linearVelocity.SetV(f);c.m_angularVelocity=k;b.m_linearVelocity.SetV(h);b.m_angularVelocity=g};a.prototype.SolvePositionConstraints=function(a){a=this.m_bodyA;var c=this.m_bodyB,b=a.m_sweep.c,f=a.m_sweep.a,k=c.m_sweep.c,h=c.m_sweep.a,g,l=0,m=0,q=0,n=l=g=0,t=0,m=!1,v=0,D=C.FromAngle(f),x=C.FromAngle(h);g=D;var t=this.m_localAnchor1.x-this.m_localCenterA.x,w=this.m_localAnchor1.y-
this.m_localCenterA.y,l=g.col1.x*t+g.col2.x*w,w=g.col1.y*t+g.col2.y*w,t=l;g=x;x=this.m_localAnchor2.x-this.m_localCenterB.x;q=this.m_localAnchor2.y-this.m_localCenterB.y;l=g.col1.x*x+g.col2.x*q;q=g.col1.y*x+g.col2.y*q;x=l;g=k.x+x-b.x-t;l=k.y+q-b.y-w;if(this.m_enableLimit){this.m_axis=r.MulMV(D,this.m_localXAxis1);this.m_a1=(g+t)*this.m_axis.y-(l+w)*this.m_axis.x;this.m_a2=x*this.m_axis.y-q*this.m_axis.x;var y=this.m_axis.x*g+this.m_axis.y*l;r.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*
u.b2_linearSlop?(v=r.Clamp(y,-u.b2_maxLinearCorrection,u.b2_maxLinearCorrection),n=r.Abs(y),m=!0):y<=this.m_lowerTranslation?(v=r.Clamp(y-this.m_lowerTranslation+u.b2_linearSlop,-u.b2_maxLinearCorrection,0),n=this.m_lowerTranslation-y,m=!0):y>=this.m_upperTranslation&&(v=r.Clamp(y-this.m_upperTranslation+u.b2_linearSlop,0,u.b2_maxLinearCorrection),n=y-this.m_upperTranslation,m=!0)}this.m_perp=r.MulMV(D,this.m_localYAxis1);this.m_s1=(g+t)*this.m_perp.y-(l+w)*this.m_perp.x;this.m_s2=x*this.m_perp.y-
q*this.m_perp.x;D=new J;w=this.m_perp.x*g+this.m_perp.y*l;x=h-f-this.m_refAngle;n=r.Max(n,r.Abs(w));t=r.Abs(x);m?(m=this.m_invMassA,q=this.m_invMassB,g=this.m_invIA,l=this.m_invIB,this.m_K.col1.x=m+q+g*this.m_s1*this.m_s1+l*this.m_s2*this.m_s2,this.m_K.col1.y=g*this.m_s1+l*this.m_s2,this.m_K.col1.z=g*this.m_s1*this.m_a1+l*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=g+l,this.m_K.col2.z=g*this.m_a1+l*this.m_a2,this.m_K.col3.x=this.m_K.col1.z,this.m_K.col3.y=this.m_K.col2.z,this.m_K.col3.z=
m+q+g*this.m_a1*this.m_a1+l*this.m_a2*this.m_a2,this.m_K.Solve33(D,-w,-x,-v)):(m=this.m_invMassA,q=this.m_invMassB,g=this.m_invIA,l=this.m_invIB,v=g*this.m_s1+l*this.m_s2,y=g+l,this.m_K.col1.Set(m+q+g*this.m_s1*this.m_s1+l*this.m_s2*this.m_s2,v,0),this.m_K.col2.Set(v,y,0),v=this.m_K.Solve22(new p,-w,-x),D.x=v.x,D.y=v.y,D.z=0);v=D.x*this.m_perp.x+D.z*this.m_axis.x;m=D.x*this.m_perp.y+D.z*this.m_axis.y;w=D.x*this.m_s1+D.y+D.z*this.m_a1;D=D.x*this.m_s2+D.y+D.z*this.m_a2;b.x-=this.m_invMassA*v;b.y-=this.m_invMassA*
m;f-=this.m_invIA*w;k.x+=this.m_invMassB*v;k.y+=this.m_invMassB*m;h+=this.m_invIB*D;a.m_sweep.a=f;c.m_sweep.a=h;a.SynchronizeTransform();c.SynchronizeTransform();return n<=u.b2_linearSlop&&t<=u.b2_angularSlop};a.prototype.GetType=function(){return this.m_type};a.prototype.GetBodyA=function(){return this.m_bodyA};a.prototype.GetBodyB=function(){return this.m_bodyB};a.prototype.GetNext=function(){return this.m_next};a.prototype.GetUserData=function(){return this.m_userData};a.prototype.SetUserData=
function(a){this.m_userData=a};a.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()};a.prototype.b2Joint=function(a){u.b2Assert(a.bodyA!=a.bodyB);this.m_type=a.type;this.m_next=this.m_prev=null;this.m_bodyA=a.bodyA;this.m_bodyB=a.bodyB;this.m_collideConnected=a.collideConnected;this.m_islandFlag=!1;this.m_userData=a.userData};a.prototype.FinalizeVelocityConstraints=function(){};return a}(v);Za=t.Dynamics.Joints.b2PrismaticJointDef=function(b){function a(){this.localAnchorA=
new p;this.localAnchorB=new p;this.localAxisA=new p;a.__super__.constructor.call(this);this.type=v.e_prismaticJoint;this.localAxisA.Set(1,0);this.referenceAngle=0;this.enableLimit=!1;this.upperTranslation=this.lowerTranslation=0;this.enableMotor=!1;this.motorSpeed=this.maxMotorForce=0}"use strict;";E(a,b);a.prototype.Initialize=function(a,c,b,f){this.bodyA=a;this.bodyB=c;this.localAnchorA=this.bodyA.GetLocalPoint(b);this.localAnchorB=this.bodyB.GetLocalPoint(b);this.localAxisA=this.bodyA.GetLocalVector(f);
this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()};a.prototype.b2JointDef=function(){this.type=v.e_unknownJoint;this.bodyB=this.bodyA=this.userData=null;this.collideConnected=!1};return a}(G);X=t.Dynamics.Joints.b2PulleyJoint=function(b){function a(b){this.m_groundAnchor1=new p;this.m_groundAnchor2=new p;this.m_localAnchor1=new p;this.m_localAnchor2=new p;this.m_u1=new p;this.m_u2=new p;a.__super__.constructor.call(this,b);this.m_ground=this.m_bodyA.m_world.m_groundBody;this.m_groundAnchor1.x=
b.groundAnchorA.x-this.m_ground.m_xf.position.x;this.m_groundAnchor1.y=b.groundAnchorA.y-this.m_ground.m_xf.position.y;this.m_groundAnchor2.x=b.groundAnchorB.x-this.m_ground.m_xf.position.x;this.m_groundAnchor2.y=b.groundAnchorB.y-this.m_ground.m_xf.position.y;this.m_localAnchor1.SetV(b.localAnchorA);this.m_localAnchor2.SetV(b.localAnchorB);this.m_ratio=b.ratio;this.m_constant=b.lengthA+this.m_ratio*b.lengthB;this.m_maxLength1=r.Min(b.maxLengthA,this.m_constant-this.m_ratio*a.b2_minPulleyLength);
this.m_maxLength2=r.Min(b.maxLengthB,(this.m_constant-a.b2_minPulleyLength)/this.m_ratio);this.m_limitImpulse2=this.m_limitImpulse1=this.m_impulse=0}"use strict;";E(a,b);a.b2_minPulleyLength=2;a.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};a.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};a.prototype.GetReactionForce=function(a){a=a||0;return new p(a*this.m_impulse*this.m_u2.x,a*this.m_impulse*this.m_u2.y)};a.prototype.GetReactionTorque=
function(a){return 0};a.prototype.GetGroundAnchorA=function(){var a=this.m_ground.m_xf.position.Copy();a.Add(this.m_groundAnchor1);return a};a.prototype.GetGroundAnchorB=function(){var a=this.m_ground.m_xf.position.Copy();a.Add(this.m_groundAnchor2);return a};a.prototype.GetLength1=function(){var a=this.m_bodyA.GetWorldPoint(this.m_localAnchor1),c=a.x-(this.m_ground.m_xf.position.x+this.m_groundAnchor1.x),a=a.y-(this.m_ground.m_xf.position.y+this.m_groundAnchor1.y);return Math.sqrt(c*c+a*a)};a.prototype.GetLength2=
function(){var a=this.m_bodyB.GetWorldPoint(this.m_localAnchor2),c=a.x-(this.m_ground.m_xf.position.x+this.m_groundAnchor2.x),a=a.y-(this.m_ground.m_xf.position.y+this.m_groundAnchor2.y);return Math.sqrt(c*c+a*a)};a.prototype.GetRatio=function(){return this.m_ratio};a.prototype.InitVelocityConstraints=function(a){var c=this.m_bodyA,b=this.m_bodyB,f;f=c.m_xf.R;var k=this.m_localAnchor1.x-c.m_sweep.localCenter.x,h=this.m_localAnchor1.y-c.m_sweep.localCenter.y,g=f.col1.x*k+f.col2.x*h,h=f.col1.y*k+f.col2.y*
h,k=g;f=b.m_xf.R;var l=this.m_localAnchor2.x-b.m_sweep.localCenter.x,m=this.m_localAnchor2.y-b.m_sweep.localCenter.y,g=f.col1.x*l+f.col2.x*m,m=f.col1.y*l+f.col2.y*m,l=g;f=b.m_sweep.c.x+l;var g=b.m_sweep.c.y+m,q=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,p=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y;this.m_u1.Set(c.m_sweep.c.x+k-(this.m_ground.m_xf.position.x+this.m_groundAnchor1.x),c.m_sweep.c.y+h-(this.m_ground.m_xf.position.y+this.m_groundAnchor1.y));this.m_u2.Set(f-q,g-p);f=
this.m_u1.Length();g=this.m_u2.Length();f>u.b2_linearSlop?this.m_u1.Multiply(1/f):this.m_u1.SetZero();g>u.b2_linearSlop?this.m_u2.Multiply(1/g):this.m_u2.SetZero();0<this.m_constant-f-this.m_ratio*g?(this.m_state=v.e_inactiveLimit,this.m_impulse=0):this.m_state=v.e_atUpperLimit;f<this.m_maxLength1?(this.m_limitState1=v.e_inactiveLimit,this.m_limitImpulse1=0):this.m_limitState1=v.e_atUpperLimit;g<this.m_maxLength2?(this.m_limitState2=v.e_inactiveLimit,this.m_limitImpulse2=0):this.m_limitState2=v.e_atUpperLimit;
f=k*this.m_u1.y-h*this.m_u1.x;g=l*this.m_u2.y-m*this.m_u2.x;this.m_limitMass1=c.m_invMass+c.m_invI*f*f;this.m_limitMass2=b.m_invMass+b.m_invI*g*g;this.m_pulleyMass=this.m_limitMass1+this.m_ratio*this.m_ratio*this.m_limitMass2;this.m_limitMass1=1/this.m_limitMass1;this.m_limitMass2=1/this.m_limitMass2;this.m_pulleyMass=1/this.m_pulleyMass;a.warmStarting?(this.m_impulse*=a.dtRatio,this.m_limitImpulse1*=a.dtRatio,this.m_limitImpulse2*=a.dtRatio,a=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.x,f=
(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.y,g=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.x,q=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.y,c.m_linearVelocity.x+=c.m_invMass*a,c.m_linearVelocity.y+=c.m_invMass*f,c.m_angularVelocity+=c.m_invI*(k*f-h*a),b.m_linearVelocity.x+=b.m_invMass*g,b.m_linearVelocity.y+=b.m_invMass*q,b.m_angularVelocity+=b.m_invI*(l*q-m*g)):this.m_limitImpulse2=this.m_limitImpulse1=this.m_impulse=0};a.prototype.SolveVelocityConstraints=
function(a){a=this.m_bodyA;var c=this.m_bodyB,b;b=a.m_xf.R;var f=this.m_localAnchor1.x-a.m_sweep.localCenter.x,k=this.m_localAnchor1.y-a.m_sweep.localCenter.y,h=b.col1.x*f+b.col2.x*k,k=b.col1.y*f+b.col2.y*k,f=h;b=c.m_xf.R;var g=this.m_localAnchor2.x-c.m_sweep.localCenter.x,l=this.m_localAnchor2.y-c.m_sweep.localCenter.y,h=b.col1.x*g+b.col2.x*l,l=b.col1.y*g+b.col2.y*l,g=h,m=h=b=0,q=0;b=q=b=q=m=h=b=0;this.m_state==v.e_atUpperLimit&&(b=a.m_linearVelocity.x+-a.m_angularVelocity*k,h=a.m_linearVelocity.y+
a.m_angularVelocity*f,m=c.m_linearVelocity.x+-c.m_angularVelocity*l,q=c.m_linearVelocity.y+c.m_angularVelocity*g,b=-(this.m_u1.x*b+this.m_u1.y*h)-this.m_ratio*(this.m_u2.x*m+this.m_u2.y*q),q=this.m_pulleyMass*-b,b=this.m_impulse,this.m_impulse=r.Max(0,this.m_impulse+q),q=this.m_impulse-b,b=-q*this.m_u1.x,h=-q*this.m_u1.y,m=-this.m_ratio*q*this.m_u2.x,q=-this.m_ratio*q*this.m_u2.y,a.m_linearVelocity.x+=a.m_invMass*b,a.m_linearVelocity.y+=a.m_invMass*h,a.m_angularVelocity+=a.m_invI*(f*h-k*b),c.m_linearVelocity.x+=
c.m_invMass*m,c.m_linearVelocity.y+=c.m_invMass*q,c.m_angularVelocity+=c.m_invI*(g*q-l*m));this.m_limitState1==v.e_atUpperLimit&&(b=a.m_linearVelocity.x+-a.m_angularVelocity*k,h=a.m_linearVelocity.y+a.m_angularVelocity*f,b=-(this.m_u1.x*b+this.m_u1.y*h),q=-this.m_limitMass1*b,b=this.m_limitImpulse1,this.m_limitImpulse1=r.Max(0,this.m_limitImpulse1+q),q=this.m_limitImpulse1-b,b=-q*this.m_u1.x,h=-q*this.m_u1.y,a.m_linearVelocity.x+=a.m_invMass*b,a.m_linearVelocity.y+=a.m_invMass*h,a.m_angularVelocity+=
a.m_invI*(f*h-k*b));this.m_limitState2==v.e_atUpperLimit&&(m=c.m_linearVelocity.x+-c.m_angularVelocity*l,q=c.m_linearVelocity.y+c.m_angularVelocity*g,b=-(this.m_u2.x*m+this.m_u2.y*q),q=-this.m_limitMass2*b,b=this.m_limitImpulse2,this.m_limitImpulse2=r.Max(0,this.m_limitImpulse2+q),q=this.m_limitImpulse2-b,m=-q*this.m_u2.x,q=-q*this.m_u2.y,c.m_linearVelocity.x+=c.m_invMass*m,c.m_linearVelocity.y+=c.m_invMass*q,c.m_angularVelocity+=c.m_invI*(g*q-l*m))};a.prototype.SolvePositionConstraints=function(a){a=
this.m_bodyA;var c=this.m_bodyB,b,f=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,k=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,h=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,g=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y,l=0,m=0,q=0,p=0,n=b=0,t=0,w=0,x=n=w=b=n=b=0;this.m_state==v.e_atUpperLimit&&(b=a.m_xf.R,l=this.m_localAnchor1.x-a.m_sweep.localCenter.x,m=this.m_localAnchor1.y-a.m_sweep.localCenter.y,n=b.col1.x*l+b.col2.x*m,m=b.col1.y*l+b.col2.y*m,l=n,b=c.m_xf.R,
q=this.m_localAnchor2.x-c.m_sweep.localCenter.x,p=this.m_localAnchor2.y-c.m_sweep.localCenter.y,n=b.col1.x*q+b.col2.x*p,p=b.col1.y*q+b.col2.y*p,q=n,b=a.m_sweep.c.x+l,n=a.m_sweep.c.y+m,t=c.m_sweep.c.x+q,w=c.m_sweep.c.y+p,this.m_u1.Set(b-f,n-k),this.m_u2.Set(t-h,w-g),b=this.m_u1.Length(),n=this.m_u2.Length(),b>u.b2_linearSlop?this.m_u1.Multiply(1/b):this.m_u1.SetZero(),n>u.b2_linearSlop?this.m_u2.Multiply(1/n):this.m_u2.SetZero(),b=this.m_constant-b-this.m_ratio*n,x=r.Max(x,-b),b=r.Clamp(b+u.b2_linearSlop,
-u.b2_maxLinearCorrection,0),w=-this.m_pulleyMass*b,b=-w*this.m_u1.x,n=-w*this.m_u1.y,t=-this.m_ratio*w*this.m_u2.x,w=-this.m_ratio*w*this.m_u2.y,a.m_sweep.c.x+=a.m_invMass*b,a.m_sweep.c.y+=a.m_invMass*n,a.m_sweep.a+=a.m_invI*(l*n-m*b),c.m_sweep.c.x+=c.m_invMass*t,c.m_sweep.c.y+=c.m_invMass*w,c.m_sweep.a+=c.m_invI*(q*w-p*t),a.SynchronizeTransform(),c.SynchronizeTransform());this.m_limitState1==v.e_atUpperLimit&&(b=a.m_xf.R,l=this.m_localAnchor1.x-a.m_sweep.localCenter.x,m=this.m_localAnchor1.y-a.m_sweep.localCenter.y,
n=b.col1.x*l+b.col2.x*m,m=b.col1.y*l+b.col2.y*m,l=n,b=a.m_sweep.c.x+l,n=a.m_sweep.c.y+m,this.m_u1.Set(b-f,n-k),b=this.m_u1.Length(),b>u.b2_linearSlop?(this.m_u1.x*=1/b,this.m_u1.y*=1/b):this.m_u1.SetZero(),b=this.m_maxLength1-b,x=r.Max(x,-b),b=r.Clamp(b+u.b2_linearSlop,-u.b2_maxLinearCorrection,0),w=-this.m_limitMass1*b,b=-w*this.m_u1.x,n=-w*this.m_u1.y,a.m_sweep.c.x+=a.m_invMass*b,a.m_sweep.c.y+=a.m_invMass*n,a.m_sweep.a+=a.m_invI*(l*n-m*b),a.SynchronizeTransform());this.m_limitState2==v.e_atUpperLimit&&
(b=c.m_xf.R,q=this.m_localAnchor2.x-c.m_sweep.localCenter.x,p=this.m_localAnchor2.y-c.m_sweep.localCenter.y,n=b.col1.x*q+b.col2.x*p,p=b.col1.y*q+b.col2.y*p,q=n,t=c.m_sweep.c.x+q,w=c.m_sweep.c.y+p,this.m_u2.Set(t-h,w-g),n=this.m_u2.Length(),n>u.b2_linearSlop?(this.m_u2.x*=1/n,this.m_u2.y*=1/n):this.m_u2.SetZero(),b=this.m_maxLength2-n,x=r.Max(x,-b),b=r.Clamp(b+u.b2_linearSlop,-u.b2_maxLinearCorrection,0),w=-this.m_limitMass2*b,t=-w*this.m_u2.x,w=-w*this.m_u2.y,c.m_sweep.c.x+=c.m_invMass*t,c.m_sweep.c.y+=
c.m_invMass*w,c.m_sweep.a+=c.m_invI*(q*w-p*t),c.SynchronizeTransform());return x<u.b2_linearSlop};a.prototype.GetType=function(){return this.m_type};a.prototype.GetBodyA=function(){return this.m_bodyA};a.prototype.GetBodyB=function(){return this.m_bodyB};a.prototype.GetNext=function(){return this.m_next};a.prototype.GetUserData=function(){return this.m_userData};a.prototype.SetUserData=function(a){this.m_userData=a};a.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()};
a.prototype.b2Joint=function(a){u.b2Assert(a.bodyA!=a.bodyB);this.m_type=a.type;this.m_next=this.m_prev=null;this.m_bodyA=a.bodyA;this.m_bodyB=a.bodyB;this.m_collideConnected=a.collideConnected;this.m_islandFlag=!1;this.m_userData=a.userData};a.prototype.FinalizeVelocityConstraints=function(){};return a}(v);$a=t.Dynamics.Joints.b2PulleyJointDef=function(b){function a(){this.groundAnchorA=new p;this.groundAnchorB=new p;this.localAnchorA=new p;this.localAnchorB=new p;a.__super__.constructor.call(this);
this.type=v.e_pulleyJoint;this.groundAnchorA.Set(-1,1);this.groundAnchorB.Set(1,1);this.localAnchorA.Set(-1,0);this.localAnchorB.Set(1,0);this.maxLengthB=this.lengthB=this.maxLengthA=this.lengthA=0;this.ratio=1;this.collideConnected=!0}"use strict;";E(a,b);a.prototype.Initialize=function(a,b,e,f,k,h,g){g=g||0;this.bodyA=a;this.bodyB=b;this.groundAnchorA.SetV(e);this.groundAnchorB.SetV(f);this.localAnchorA=this.bodyA.GetLocalPoint(k);this.localAnchorB=this.bodyB.GetLocalPoint(h);a=k.x-e.x;e=k.y-e.y;
this.lengthA=Math.sqrt(a*a+e*e);e=h.x-f.x;f=h.y-f.y;this.lengthB=Math.sqrt(e*e+f*f);this.ratio=g;g=this.lengthA+this.ratio*this.lengthB;this.maxLengthA=g-this.ratio*X.b2_minPulleyLength;this.maxLengthB=(g-X.b2_minPulleyLength)/this.ratio};a.prototype.b2JointDef=function(){this.type=v.e_unknownJoint;this.bodyB=this.bodyA=this.userData=null;this.collideConnected=!1};return a}(G);da=t.Dynamics.Joints.b2RevoluteJoint=function(b){function a(b){this.K=new C;this.K1=new C;this.K2=new C;this.K3=new C;this.impulse3=
new J;this.impulse2=new p;this.reduced=new p;this.m_localAnchor1=new p;this.m_localAnchor2=new p;this.m_impulse=new J;this.m_mass=new W;a.__super__.constructor.call(this,b);this.m_localAnchor1.SetV(b.localAnchorA);this.m_localAnchor2.SetV(b.localAnchorB);this.m_referenceAngle=b.referenceAngle;this.m_impulse.SetZero();this.m_motorImpulse=0;this.m_lowerAngle=b.lowerAngle;this.m_upperAngle=b.upperAngle;this.m_maxMotorTorque=b.maxMotorTorque;this.m_motorSpeed=b.motorSpeed;this.m_enableLimit=b.enableLimit;
this.m_enableMotor=b.enableMotor;this.m_limitState=v.e_inactiveLimit}"use strict;";E(a,b);a.tImpulse=new p;a.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};a.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};a.prototype.GetReactionForce=function(a){a=a||0;return new p(a*this.m_impulse.x,a*this.m_impulse.y)};a.prototype.GetReactionTorque=function(a){return(a||0)*this.m_impulse.z};a.prototype.GetJointAngle=function(){return this.m_bodyB.m_sweep.a-
this.m_bodyA.m_sweep.a-this.m_referenceAngle};a.prototype.GetJointSpeed=function(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity};a.prototype.IsLimitEnabled=function(){return this.m_enableLimit};a.prototype.EnableLimit=function(a){this.m_enableLimit=a};a.prototype.GetLowerLimit=function(){return this.m_lowerAngle};a.prototype.GetUpperLimit=function(){return this.m_upperAngle};a.prototype.SetLimits=function(a,b){this.m_lowerAngle=a||0;this.m_upperAngle=b||0};a.prototype.IsMotorEnabled=
function(){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);return this.m_enableMotor};a.prototype.EnableMotor=function(a){this.m_enableMotor=a};a.prototype.SetMotorSpeed=function(a){a=a||0;this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_motorSpeed=a};a.prototype.GetMotorSpeed=function(){return this.m_motorSpeed};a.prototype.SetMaxMotorTorque=function(a){this.m_maxMotorTorque=a||0};a.prototype.GetMotorTorque=function(){return this.m_maxMotorTorque};a.prototype.InitVelocityConstraints=
function(a){var b=this.m_bodyA,e=this.m_bodyB,f,k=0;f=b.m_xf.R;var h=this.m_localAnchor1.x-b.m_sweep.localCenter.x,g=this.m_localAnchor1.y-b.m_sweep.localCenter.y,k=f.col1.x*h+f.col2.x*g,g=f.col1.y*h+f.col2.y*g,h=k;f=e.m_xf.R;var l=this.m_localAnchor2.x-e.m_sweep.localCenter.x,m=this.m_localAnchor2.y-e.m_sweep.localCenter.y,k=f.col1.x*l+f.col2.x*m,m=f.col1.y*l+f.col2.y*m,l=k;f=b.m_invMass;var k=e.m_invMass,q=b.m_invI,n=e.m_invI;this.m_mass.col1.x=f+k+g*g*q+m*m*n;this.m_mass.col2.x=-g*h*q-m*l*n;this.m_mass.col3.x=
-g*q-m*n;this.m_mass.col1.y=this.m_mass.col2.x;this.m_mass.col2.y=f+k+h*h*q+l*l*n;this.m_mass.col3.y=h*q+l*n;this.m_mass.col1.z=this.m_mass.col3.x;this.m_mass.col2.z=this.m_mass.col3.y;this.m_mass.col3.z=q+n;this.m_motorMass=1/(q+n);0==this.m_enableMotor&&(this.m_motorImpulse=0);if(this.m_enableLimit){var p=e.m_sweep.a-b.m_sweep.a-this.m_referenceAngle;r.Abs(this.m_upperAngle-this.m_lowerAngle)<2*u.b2_angularSlop?this.m_limitState=v.e_equalLimits:p<=this.m_lowerAngle?(this.m_limitState!=v.e_atLowerLimit&&
(this.m_impulse.z=0),this.m_limitState=v.e_atLowerLimit):p>=this.m_upperAngle?(this.m_limitState!=v.e_atUpperLimit&&(this.m_impulse.z=0),this.m_limitState=v.e_atUpperLimit):(this.m_limitState=v.e_inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=v.e_inactiveLimit;a.warmStarting?(this.m_impulse.x*=a.dtRatio,this.m_impulse.y*=a.dtRatio,this.m_motorImpulse*=a.dtRatio,a=this.m_impulse.x,p=this.m_impulse.y,b.m_linearVelocity.x-=f*a,b.m_linearVelocity.y-=f*p,b.m_angularVelocity-=q*(h*p-g*a+this.m_motorImpulse+
this.m_impulse.z),e.m_linearVelocity.x+=k*a,e.m_linearVelocity.y+=k*p,e.m_angularVelocity+=n*(l*p-m*a+this.m_motorImpulse+this.m_impulse.z)):(this.m_impulse.SetZero(),this.m_motorImpulse=0)};a.prototype.SolveVelocityConstraints=function(a){var b=this.m_bodyA,e=this.m_bodyB,f=0,k=f=0,h=0,g=0,l=0,m=b.m_linearVelocity,q=b.m_angularVelocity,n=e.m_linearVelocity,p=e.m_angularVelocity,t=b.m_invMass,u=e.m_invMass,x=b.m_invI,w=e.m_invI;this.m_enableMotor&&this.m_limitState!=v.e_equalLimits&&(k=this.m_motorMass*
-(p-q-this.m_motorSpeed),h=this.m_motorImpulse,g=a.dt*this.m_maxMotorTorque,this.m_motorImpulse=r.Clamp(this.m_motorImpulse+k,-g,g),k=this.m_motorImpulse-h,q-=x*k,p+=w*k);if(this.m_enableLimit&&this.m_limitState!=v.e_inactiveLimit){a=b.m_xf.R;k=this.m_localAnchor1.x-b.m_sweep.localCenter.x;h=this.m_localAnchor1.y-b.m_sweep.localCenter.y;f=a.col1.x*k+a.col2.x*h;h=a.col1.y*k+a.col2.y*h;k=f;a=e.m_xf.R;g=this.m_localAnchor2.x-e.m_sweep.localCenter.x;l=this.m_localAnchor2.y-e.m_sweep.localCenter.y;f=a.col1.x*
g+a.col2.x*l;l=a.col1.y*g+a.col2.y*l;g=f;a=n.x+-p*l-m.x- -q*h;var y=n.y+p*g-m.y-q*k;this.m_mass.Solve33(this.impulse3,-a,-y,-(p-q));this.m_limitState==v.e_equalLimits?this.m_impulse.Add(this.impulse3):this.m_limitState==v.e_atLowerLimit?(f=this.m_impulse.z+this.impulse3.z,0>f&&(this.m_mass.Solve22(this.reduced,-a,-y),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0)):
this.m_limitState==v.e_atUpperLimit&&(f=this.m_impulse.z+this.impulse3.z,0<f&&(this.m_mass.Solve22(this.reduced,-a,-y),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0));m.x-=t*this.impulse3.x;m.y-=t*this.impulse3.y;q-=x*(k*this.impulse3.y-h*this.impulse3.x+this.impulse3.z);n.x+=u*this.impulse3.x;n.y+=u*this.impulse3.y;p+=w*(g*this.impulse3.y-l*this.impulse3.x+this.impulse3.z)}else a=
b.m_xf.R,k=this.m_localAnchor1.x-b.m_sweep.localCenter.x,h=this.m_localAnchor1.y-b.m_sweep.localCenter.y,f=a.col1.x*k+a.col2.x*h,h=a.col1.y*k+a.col2.y*h,k=f,a=e.m_xf.R,g=this.m_localAnchor2.x-e.m_sweep.localCenter.x,l=this.m_localAnchor2.y-e.m_sweep.localCenter.y,f=a.col1.x*g+a.col2.x*l,l=a.col1.y*g+a.col2.y*l,g=f,this.m_mass.Solve22(this.impulse2,-(n.x+-p*l-m.x- -q*h),-(n.y+p*g-m.y-q*k)),this.m_impulse.x+=this.impulse2.x,this.m_impulse.y+=this.impulse2.y,m.x-=t*this.impulse2.x,m.y-=t*this.impulse2.y,
q-=x*(k*this.impulse2.y-h*this.impulse2.x),n.x+=u*this.impulse2.x,n.y+=u*this.impulse2.y,p+=w*(g*this.impulse2.y-l*this.impulse2.x);b.m_linearVelocity.SetV(m);b.m_angularVelocity=q;e.m_linearVelocity.SetV(n);e.m_angularVelocity=p};a.prototype.SolvePositionConstraints=function(b){var c=0,e;b=this.m_bodyA;var f=this.m_bodyB,k=0,h=e=0,g=0,l=0;if(this.m_enableLimit&&this.m_limitState!=v.e_inactiveLimit){var c=f.m_sweep.a-b.m_sweep.a-this.m_referenceAngle,m=0;this.m_limitState==v.e_equalLimits?(c=r.Clamp(c-
this.m_lowerAngle,-u.b2_maxAngularCorrection,u.b2_maxAngularCorrection),m=-this.m_motorMass*c,k=r.Abs(c)):this.m_limitState==v.e_atLowerLimit?(c-=this.m_lowerAngle,k=-c,c=r.Clamp(c+u.b2_angularSlop,-u.b2_maxAngularCorrection,0),m=-this.m_motorMass*c):this.m_limitState==v.e_atUpperLimit&&(k=c-=this.m_upperAngle,c=r.Clamp(c-u.b2_angularSlop,0,u.b2_maxAngularCorrection),m=-this.m_motorMass*c);b.m_sweep.a-=b.m_invI*m;f.m_sweep.a+=f.m_invI*m;b.SynchronizeTransform();f.SynchronizeTransform()}e=b.m_xf.R;
m=this.m_localAnchor1.x-b.m_sweep.localCenter.x;c=this.m_localAnchor1.y-b.m_sweep.localCenter.y;h=e.col1.x*m+e.col2.x*c;c=e.col1.y*m+e.col2.y*c;m=h;e=f.m_xf.R;var q=this.m_localAnchor2.x-f.m_sweep.localCenter.x,n=this.m_localAnchor2.y-f.m_sweep.localCenter.y,h=e.col1.x*q+e.col2.x*n,n=e.col1.y*q+e.col2.y*n,q=h,g=f.m_sweep.c.x+q-b.m_sweep.c.x-m,l=f.m_sweep.c.y+n-b.m_sweep.c.y-c,p=g*g+l*l;e=Math.sqrt(p);var h=b.m_invMass,t=f.m_invMass,w=b.m_invI,x=f.m_invI,y=10*u.b2_linearSlop;p>y*y&&(p=1/(h+t),g=p*
-g,l=p*-l,b.m_sweep.c.x-=.5*h*g,b.m_sweep.c.y-=.5*h*l,f.m_sweep.c.x+=.5*t*g,f.m_sweep.c.y+=.5*t*l,g=f.m_sweep.c.x+q-b.m_sweep.c.x-m,l=f.m_sweep.c.y+n-b.m_sweep.c.y-c);this.K1.col1.x=h+t;this.K1.col2.x=0;this.K1.col1.y=0;this.K1.col2.y=h+t;this.K2.col1.x=w*c*c;this.K2.col2.x=-w*m*c;this.K2.col1.y=-w*m*c;this.K2.col2.y=w*m*m;this.K3.col1.x=x*n*n;this.K3.col2.x=-x*q*n;this.K3.col1.y=-x*q*n;this.K3.col2.y=x*q*q;this.K.SetM(this.K1);this.K.AddM(this.K2);this.K.AddM(this.K3);this.K.Solve(a.tImpulse,-g,
-l);g=a.tImpulse.x;l=a.tImpulse.y;b.m_sweep.c.x-=b.m_invMass*g;b.m_sweep.c.y-=b.m_invMass*l;b.m_sweep.a-=b.m_invI*(m*l-c*g);f.m_sweep.c.x+=f.m_invMass*g;f.m_sweep.c.y+=f.m_invMass*l;f.m_sweep.a+=f.m_invI*(q*l-n*g);b.SynchronizeTransform();f.SynchronizeTransform();return e<=u.b2_linearSlop&&k<=u.b2_angularSlop};a.prototype.GetType=function(){return this.m_type};a.prototype.GetBodyA=function(){return this.m_bodyA};a.prototype.GetBodyB=function(){return this.m_bodyB};a.prototype.GetNext=function(){return this.m_next};
a.prototype.GetUserData=function(){return this.m_userData};a.prototype.SetUserData=function(a){this.m_userData=a};a.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()};a.prototype.b2Joint=function(a){u.b2Assert(a.bodyA!=a.bodyB);this.m_type=a.type;this.m_next=this.m_prev=null;this.m_bodyA=a.bodyA;this.m_bodyB=a.bodyB;this.m_collideConnected=a.collideConnected;this.m_islandFlag=!1;this.m_userData=a.userData};a.prototype.FinalizeVelocityConstraints=function(){};return a}(v);
bb=t.Dynamics.Joints.b2RevoluteJointDef=function(b){function a(){this.localAnchorA=new p;this.localAnchorB=new p;a.__super__.constructor.call(this);this.type=v.e_revoluteJoint;this.localAnchorA.Set(0,0);this.localAnchorB.Set(0,0);this.motorSpeed=this.maxMotorTorque=this.upperAngle=this.lowerAngle=this.referenceAngle=0;this.enableMotor=this.enableLimit=!1}"use strict;";E(a,b);a.prototype.Initialize=function(a,b,e){this.bodyA=a;this.bodyB=b;this.localAnchorA=this.bodyA.GetLocalPoint(e);this.localAnchorB=
this.bodyB.GetLocalPoint(e);this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()};a.prototype.b2JointDef=function(){this.type=v.e_unknownJoint;this.bodyB=this.bodyA=this.userData=null;this.collideConnected=!1};return a}(G);fb=t.Dynamics.Joints.b2WeldJoint=function(b){function a(b){this.m_localAnchorA=new p;this.m_localAnchorB=new p;this.m_impulse=new J;this.m_mass=new W;a.__super__.constructor.call(this,b);this.m_localAnchorA.SetV(b.localAnchorA);this.m_localAnchorB.SetV(b.localAnchorB);
this.m_referenceAngle=b.referenceAngle;this.m_impulse.SetZero();this.m_mass=new W}"use strict;";E(a,b);a.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)};a.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)};a.prototype.GetReactionForce=function(a){a=a||0;return new p(a*this.m_impulse.x,a*this.m_impulse.y)};a.prototype.GetReactionTorque=function(a){return(a||0)*this.m_impulse.z};a.prototype.InitVelocityConstraints=function(a){var b,
e=0,f=this.m_bodyA,k=this.m_bodyB;b=f.m_xf.R;var h=this.m_localAnchorA.x-f.m_sweep.localCenter.x,g=this.m_localAnchorA.y-f.m_sweep.localCenter.y,e=b.col1.x*h+b.col2.x*g,g=b.col1.y*h+b.col2.y*g,h=e;b=k.m_xf.R;var l=this.m_localAnchorB.x-k.m_sweep.localCenter.x,m=this.m_localAnchorB.y-k.m_sweep.localCenter.y,e=b.col1.x*l+b.col2.x*m,m=b.col1.y*l+b.col2.y*m,l=e;b=f.m_invMass;var e=k.m_invMass,q=f.m_invI,n=k.m_invI;this.m_mass.col1.x=b+e+g*g*q+m*m*n;this.m_mass.col2.x=-g*h*q-m*l*n;this.m_mass.col3.x=-g*
q-m*n;this.m_mass.col1.y=this.m_mass.col2.x;this.m_mass.col2.y=b+e+h*h*q+l*l*n;this.m_mass.col3.y=h*q+l*n;this.m_mass.col1.z=this.m_mass.col3.x;this.m_mass.col2.z=this.m_mass.col3.y;this.m_mass.col3.z=q+n;a.warmStarting?(this.m_impulse.x*=a.dtRatio,this.m_impulse.y*=a.dtRatio,this.m_impulse.z*=a.dtRatio,f.m_linearVelocity.x-=b*this.m_impulse.x,f.m_linearVelocity.y-=b*this.m_impulse.y,f.m_angularVelocity-=q*(h*this.m_impulse.y-g*this.m_impulse.x+this.m_impulse.z),k.m_linearVelocity.x+=e*this.m_impulse.x,
k.m_linearVelocity.y+=e*this.m_impulse.y,k.m_angularVelocity+=n*(l*this.m_impulse.y-m*this.m_impulse.x+this.m_impulse.z)):this.m_impulse.SetZero()};a.prototype.SolveVelocityConstraints=function(a){var b,e=0;a=this.m_bodyA;var f=this.m_bodyB,k=a.m_linearVelocity,h=a.m_angularVelocity,g=f.m_linearVelocity,l=f.m_angularVelocity,m=a.m_invMass,n=f.m_invMass,p=a.m_invI,r=f.m_invI;b=a.m_xf.R;var t=this.m_localAnchorA.x-a.m_sweep.localCenter.x,u=this.m_localAnchorA.y-a.m_sweep.localCenter.y,e=b.col1.x*t+
b.col2.x*u,u=b.col1.y*t+b.col2.y*u,t=e;b=f.m_xf.R;var v=this.m_localAnchorB.x-f.m_sweep.localCenter.x,w=this.m_localAnchorB.y-f.m_sweep.localCenter.y,e=b.col1.x*v+b.col2.x*w,w=b.col1.y*v+b.col2.y*w,v=e;b=g.x-l*w-k.x+h*u;var e=g.y+l*v-k.y-h*t,y=l-h,A=new J;this.m_mass.Solve33(A,-b,-e,-y);this.m_impulse.Add(A);k.x-=m*A.x;k.y-=m*A.y;h-=p*(t*A.y-u*A.x+A.z);g.x+=n*A.x;g.y+=n*A.y;l+=r*(v*A.y-w*A.x+A.z);a.m_angularVelocity=h;f.m_angularVelocity=l};a.prototype.SolvePositionConstraints=function(a){var b,e=
0;a=this.m_bodyA;var f=this.m_bodyB;b=a.m_xf.R;var k=this.m_localAnchorA.x-a.m_sweep.localCenter.x,h=this.m_localAnchorA.y-a.m_sweep.localCenter.y,e=b.col1.x*k+b.col2.x*h,h=b.col1.y*k+b.col2.y*h,k=e;b=f.m_xf.R;var g=this.m_localAnchorB.x-f.m_sweep.localCenter.x,l=this.m_localAnchorB.y-f.m_sweep.localCenter.y,e=b.col1.x*g+b.col2.x*l,l=b.col1.y*g+b.col2.y*l,g=e;b=a.m_invMass;var e=f.m_invMass,m=a.m_invI,n=f.m_invI,p=f.m_sweep.c.x+g-a.m_sweep.c.x-k,t=f.m_sweep.c.y+l-a.m_sweep.c.y-h,v=f.m_sweep.a-a.m_sweep.a-
this.m_referenceAngle,w=10*u.b2_linearSlop,x=Math.sqrt(p*p+t*t),y=r.Abs(v);x>w&&(m*=1,n*=1);this.m_mass.col1.x=b+e+h*h*m+l*l*n;this.m_mass.col2.x=-h*k*m-l*g*n;this.m_mass.col3.x=-h*m-l*n;this.m_mass.col1.y=this.m_mass.col2.x;this.m_mass.col2.y=b+e+k*k*m+g*g*n;this.m_mass.col3.y=k*m+g*n;this.m_mass.col1.z=this.m_mass.col3.x;this.m_mass.col2.z=this.m_mass.col3.y;this.m_mass.col3.z=m+n;w=new J;this.m_mass.Solve33(w,-p,-t,-v);a.m_sweep.c.x-=b*w.x;a.m_sweep.c.y-=b*w.y;a.m_sweep.a-=m*(k*w.y-h*w.x+w.z);
f.m_sweep.c.x+=e*w.x;f.m_sweep.c.y+=e*w.y;f.m_sweep.a+=n*(g*w.y-l*w.x+w.z);a.SynchronizeTransform();f.SynchronizeTransform();return x<=u.b2_linearSlop&&y<=u.b2_angularSlop};a.prototype.GetType=function(){return this.m_type};a.prototype.GetBodyA=function(){return this.m_bodyA};a.prototype.GetBodyB=function(){return this.m_bodyB};a.prototype.GetNext=function(){return this.m_next};a.prototype.GetUserData=function(){return this.m_userData};a.prototype.SetUserData=function(a){this.m_userData=a};a.prototype.IsActive=
function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()};a.prototype.b2Joint=function(a){u.b2Assert(a.bodyA!=a.bodyB);this.m_type=a.type;this.m_next=this.m_prev=null;this.m_bodyA=a.bodyA;this.m_bodyB=a.bodyB;this.m_collideConnected=a.collideConnected;this.m_islandFlag=!1;this.m_userData=a.userData};a.prototype.FinalizeVelocityConstraints=function(){};return a}(v);gb=t.Dynamics.Joints.b2WeldJointDef=function(b){function a(){this.localAnchorA=new p;this.localAnchorB=new p;a.__super__.constructor.call(this);
this.type=v.e_weldJoint;this.referenceAngle=0}"use strict;";E(a,b);a.prototype.Initialize=function(a,b,e){this.bodyA=a;this.bodyB=b;this.localAnchorA.SetV(this.bodyA.GetLocalPoint(e));this.localAnchorB.SetV(this.bodyB.GetLocalPoint(e));this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()};a.prototype.b2JointDef=function(){this.type=v.e_unknownJoint;this.bodyB=this.bodyA=this.userData=null;this.collideConnected=!1};return a}(G);t.Dynamics.b2ContactListener=Ca=function(){function b(){}"use strict;";
b.prototype.BeginContact=function(a){};b.prototype.EndContact=function(a){};b.prototype.PreSolve=function(a,b){};b.prototype.PostSolve=function(a,b){};b.b2_defaultListener=new b;return b}();t.Dynamics.b2ContactFilter=ka=function(){function b(){}"use strict;";b.prototype.ShouldCollide=function(a,b){var c=a.GetFilterData(),e=b.GetFilterData();return c.groupIndex==e.groupIndex&&0!=c.groupIndex?0<c.groupIndex:0!=(c.maskBits&e.categoryBits)&&0!=(c.categoryBits&e.maskBits)};b.prototype.RayCollide=function(a,
b){return a?this.ShouldCollide(a instanceof M?a:null,b):!0};b.b2_defaultFilter=new b;return b}();t.Dynamics.b2Fixture=M=function(){function b(){this.m_filter=new pa;this.m_aabb=new K;this.m_shape=this.m_next=this.m_body=this.m_userData=null;this.m_restitution=this.m_friction=this.m_density=0}"use strict;";b.prototype.GetType=function(){return this.m_shape.GetType()};b.prototype.GetShape=function(){return this.m_shape};b.prototype.SetSensor=function(a){if(this.m_isSensor!=a&&(this.m_isSensor=a,null!=
this.m_body))for(a=this.m_body.GetContactList();a;){var b=a.contact,c=b.GetFixtureA(),e=b.GetFixtureB();c!=this&&e!=this||b.SetSensor(c.IsSensor()||e.IsSensor());a=a.next}};b.prototype.IsSensor=function(){return this.m_isSensor};b.prototype.SetFilterData=function(a){this.m_filter=a.Copy();if(!this.m_body)for(a=this.m_body.GetContactList();a;){var b=a.contact,c=b.GetFixtureA(),e=b.GetFixtureB();c!=this&&e!=this||b.FlagForFiltering();a=a.next}};b.prototype.GetFilterData=function(){return this.m_filter.Copy()};
b.prototype.GetBody=function(){return this.m_body};b.prototype.GetNext=function(){return this.m_next};b.prototype.GetUserData=function(){return this.m_userData};b.prototype.SetUserData=function(a){this.m_userData=a};b.prototype.TestPoint=function(a){return this.m_shape.TestPoint(this.m_body.GetTransform(),a)};b.prototype.RayCast=function(a,b){return this.m_shape.RayCast(a,b,this.m_body.GetTransform())};b.prototype.GetMassData=function(a){a=a||null;null==a&&(a=new ra);this.m_shape.ComputeMass(a,this.m_density);
return a};b.prototype.SetDensity=function(a){this.m_density=a||0};b.prototype.GetDensity=function(){return this.m_density};b.prototype.GetFriction=function(){return this.m_friction};b.prototype.SetFriction=function(a){this.m_friction=a||0};b.prototype.GetRestitution=function(){return this.m_restitution};b.prototype.SetRestitution=function(a){this.m_restitution=a||0};b.prototype.GetAABB=function(){return this.m_aabb};b.prototype.Create=function(a,b,c){this.m_userData=c.userData;this.m_friction=c.friction;
this.m_restitution=c.restitution;this.m_body=a;this.m_next=null;this.m_filter=c.filter.Copy();this.m_isSensor=c.isSensor;this.m_shape=c.shape.Copy();this.m_density=c.density};b.prototype.Destroy=function(){this.m_shape=null};b.prototype.CreateProxy=function(a,b){this.m_shape.ComputeAABB(this.m_aabb,b);this.m_proxy=a.CreateProxy(this.m_aabb,this)};b.prototype.DestroyProxy=function(a){null!=this.m_proxy&&(a.DestroyProxy(this.m_proxy),this.m_proxy=null)};b.prototype.Synchronize=function(a,b,c){if(this.m_proxy){var e=
new K,f=new K;this.m_shape.ComputeAABB(e,b);this.m_shape.ComputeAABB(f,c);this.m_aabb.Combine(e,f);b=r.SubtractVV(c.position,b.position);a.MoveProxy(this.m_proxy,this.m_aabb,b)}};return b}();t.Dynamics.b2ContactManager=Da=function(){function b(){this.m_world=null;this.m_contactCount=0;this.m_contactFilter=ka.b2_defaultFilter;this.m_contactListener=Ca.b2_defaultListener;this.m_contactFactory=new Aa(this.m_allocator);this.m_broadPhase=new Ka}"use strict;";b.s_evalCP=new Ea;b.prototype.AddPair=function(a,
b){var c=a instanceof M?a:null,e=b instanceof M?b:null,f=c.GetBody(),k=e.GetBody();if(f!=k){for(var h=k.GetContactList();h;){if(h.other==f){var g=h.contact.GetFixtureA(),l=h.contact.GetFixtureB();if(g==c&&l==e||g==e&&l==c)return}h=h.next}0!=k.ShouldCollide(f)&&0!=this.m_contactFilter.ShouldCollide(c,e)&&(h=this.m_contactFactory.Create(c,e),c=h.GetFixtureA(),e=h.GetFixtureB(),f=c.m_body,k=e.m_body,h.m_prev=null,h.m_next=this.m_world.m_contactList,null!=this.m_world.m_contactList&&(this.m_world.m_contactList.m_prev=
h),this.m_world.m_contactList=h,h.m_nodeA.contact=h,h.m_nodeA.other=k,h.m_nodeA.prev=null,h.m_nodeA.next=f.m_contactList,null!=f.m_contactList&&(f.m_contactList.prev=h.m_nodeA),f.m_contactList=h.m_nodeA,h.m_nodeB.contact=h,h.m_nodeB.other=f,h.m_nodeB.prev=null,h.m_nodeB.next=k.m_contactList,null!=k.m_contactList&&(k.m_contactList.prev=h.m_nodeB),k.m_contactList=h.m_nodeB,++this.m_world.m_contactCount)}};b.prototype.FindNewContacts=function(){this.m_broadPhase.UpdatePairs(t.generateCallback(this,this.AddPair))};
b.prototype.Destroy=function(a){var b=a.GetFixtureA(),c=a.GetFixtureB(),b=b.GetBody(),c=c.GetBody();a.IsTouching()&&this.m_contactListener.EndContact(a);a.m_prev&&(a.m_prev.m_next=a.m_next);a.m_next&&(a.m_next.m_prev=a.m_prev);a==this.m_world.m_contactList&&(this.m_world.m_contactList=a.m_next);a.m_nodeA.prev&&(a.m_nodeA.prev.next=a.m_nodeA.next);a.m_nodeA.next&&(a.m_nodeA.next.prev=a.m_nodeA.prev);a.m_nodeA==b.m_contactList&&(b.m_contactList=a.m_nodeA.next);a.m_nodeB.prev&&(a.m_nodeB.prev.next=a.m_nodeB.next);
a.m_nodeB.next&&(a.m_nodeB.next.prev=a.m_nodeB.prev);a.m_nodeB==c.m_contactList&&(c.m_contactList=a.m_nodeB.next);this.m_contactFactory.Destroy(a);--this.m_contactCount};b.prototype.Collide=function(){for(var a=this.m_world.m_contactList;a;){var b=a.GetFixtureA(),c=a.GetFixtureB(),e=b.GetBody(),f=c.GetBody();if(0==e.IsAwake()&&0==f.IsAwake())a=a.GetNext();else{if(a.m_flags&n.e_filterFlag){if(0==f.ShouldCollide(e)){b=a;a=b.GetNext();this.Destroy(b);continue}if(0==this.m_contactFilter.ShouldCollide(b,
c)){b=a;a=b.GetNext();this.Destroy(b);continue}a.m_flags&=~n.e_filterFlag}0==this.m_broadPhase.TestOverlap(b.m_proxy,c.m_proxy)?(b=a,a=b.GetNext(),this.Destroy(b)):(a.Update(this.m_contactListener),a=a.GetNext())}}};return b}();t.Dynamics.b2Body=w=function(){function b(a,d){this.m_xf=new N;this.m_sweep=new T;this.m_linearVelocity=new p;this.m_force=new p;a.bullet&&(this.m_flags|=b.e_bulletFlag);a.fixedRotation&&(this.m_flags|=b.e_fixedRotationFlag);a.allowSleep&&(this.m_flags|=b.e_allowSleepFlag);
a.awake&&(this.m_flags|=b.e_awakeFlag);a.active&&(this.m_flags|=b.e_activeFlag);this.m_world=d;this.m_xf.position.SetV(a.position);this.m_xf.R.Set(a.angle);this.m_sweep.localCenter.SetZero();this.m_sweep.t0=1;this.m_sweep.a0=this.m_sweep.a=a.angle;var c=this.m_xf.R,e=this.m_sweep.localCenter;this.m_sweep.c.x=c.col1.x*e.x+c.col2.x*e.y;this.m_sweep.c.y=c.col1.y*e.x+c.col2.y*e.y;this.m_sweep.c.x+=this.m_xf.position.x;this.m_sweep.c.y+=this.m_xf.position.y;this.m_sweep.c0.SetV(this.m_sweep.c);this.m_linearVelocity.SetV(a.linearVelocity);
this.m_angularVelocity=a.angularVelocity;this.m_linearDamping=a.linearDamping;this.m_angularDamping=a.angularDamping;this.m_force.Set(0,0);this.m_type=a.type;this.m_type==b.b2_dynamicBody&&(this.m_invMass=this.m_mass=1);this.m_inertiaScale=a.inertiaScale;this.m_userData=a.userData}"use strict;";b.s_xf1=new N;b.e_islandFlag=1;b.e_awakeFlag=2;b.e_allowSleepFlag=4;b.e_bulletFlag=8;b.e_fixedRotationFlag=16;b.e_activeFlag=32;b.b2_staticBody=0;b.b2_kinematicBody=1;b.b2_dynamicBody=2;b.prototype.m_xf=null;
b.prototype.m_sweep=null;b.prototype.m_linearVelocity=null;b.prototype.m_force=null;b.prototype.m_flags=0;b.prototype.m_world=null;b.prototype.m_jointList=null;b.prototype.m_controllerList=null;b.prototype.m_contactList=null;b.prototype.m_controllerCount=0;b.prototype.m_prev=null;b.prototype.m_next=null;b.prototype.m_linearVelocity=null;b.prototype.m_angularVelocity=null;b.prototype.m_linearDamping=null;b.prototype.m_angularDamping=null;b.prototype.m_force=null;b.prototype.m_torque=0;b.prototype.m_sleepTime=
0;b.prototype.m_type=0;b.prototype.m_mass=0;b.prototype.m_invMass=0;b.prototype.m_I=0;b.prototype.m_invI=0;b.prototype.m_inertiaScale=0;b.prototype.m_userData=null;b.prototype.m_fixtureList=null;b.prototype.m_fixtureCount=0;b.prototype.connectEdges=function(a,b,c){c=c||0;var e=Math.atan2(b.GetDirectionVector().y,b.GetDirectionVector().x);c=Math.tan(.5*(e-c));c=r.MulFV(c,b.GetDirectionVector());c=r.SubtractVV(c,b.GetNormalVector());c=r.MulFV(u.b2_toiSlop,c);c=r.AddVV(c,b.GetVertex1());var f=r.AddVV(a.GetDirectionVector(),
b.GetDirectionVector());f.Normalize();var k=0<r.Dot(a.GetDirectionVector(),b.GetNormalVector());a.SetNextEdge(b,c,f,k);b.SetPrevEdge(a,c,f,k);return e};b.prototype.CreateFixture=function(a){if(1==this.m_world.IsLocked())return null;var d=new M;d.Create(this,this.m_xf,a);this.m_flags&b.e_activeFlag&&d.CreateProxy(this.m_world.m_contactManager.m_broadPhase,this.m_xf);d.m_next=this.m_fixtureList;this.m_fixtureList=d;++this.m_fixtureCount;d.m_body=this;0<d.m_density&&this.ResetMassData();this.m_world.m_flags|=
hb.e_newFixture;return d};b.prototype.CreateFixture2=function(a,b){b=b||0;var c=new Na;c.shape=a;c.density=b;return this.CreateFixture(c)};b.prototype.DestroyFixture=function(a){if(1!=this.m_world.IsLocked()){for(var d=this.m_fixtureList,c=null;null!=d;){if(d==a){c?c.m_next=a.m_next:this.m_fixtureList=a.m_next;break}c=d;d=d.m_next}for(d=this.m_contactList;d;){var c=d.contact,d=d.next,e=c.GetFixtureA(),f=c.GetFixtureB();a!=e&&a!=f||this.m_world.m_contactManager.Destroy(c)}this.m_flags&b.e_activeFlag&&
a.DestroyProxy(this.m_world.m_contactManager.m_broadPhase);a.Destroy();a.m_body=null;a.m_next=null;--this.m_fixtureCount;this.ResetMassData()}};b.prototype.SetPositionAndAngle=function(a,b){b=b||0;var c;if(1!=this.m_world.IsLocked()){this.m_xf.R.Set(b);this.m_xf.position.SetV(a);c=this.m_xf.R;var e=this.m_sweep.localCenter;this.m_sweep.c.x=c.col1.x*e.x+c.col2.x*e.y;this.m_sweep.c.y=c.col1.y*e.x+c.col2.y*e.y;this.m_sweep.c.x+=this.m_xf.position.x;this.m_sweep.c.y+=this.m_xf.position.y;this.m_sweep.c0.SetV(this.m_sweep.c);
this.m_sweep.a0=this.m_sweep.a=b;e=this.m_world.m_contactManager.m_broadPhase;for(c=this.m_fixtureList;c;c=c.m_next)c.Synchronize(e,this.m_xf,this.m_xf);this.m_world.m_contactManager.FindNewContacts()}};b.prototype.SetTransform=function(a){this.SetPositionAndAngle(a.position,a.GetAngle())};b.prototype.GetTransform=function(){return this.m_xf};b.prototype.GetPosition=function(){return this.m_xf.position};b.prototype.SetPosition=function(a){this.SetPositionAndAngle(a,this.GetAngle())};b.prototype.GetAngle=
function(){return this.m_sweep.a};b.prototype.SetAngle=function(a){a=a||0;this.SetPositionAndAngle(this.GetPosition(),a)};b.prototype.GetWorldCenter=function(){return this.m_sweep.c};b.prototype.GetLocalCenter=function(){return this.m_sweep.localCenter};b.prototype.SetLinearVelocity=function(a){this.m_type!=b.b2_staticBody&&this.m_linearVelocity.SetV(a)};b.prototype.GetLinearVelocity=function(){return this.m_linearVelocity};b.prototype.SetAngularVelocity=function(a){this.m_type!=b.b2_staticBody&&
(this.m_angularVelocity=a||0)};b.prototype.GetAngularVelocity=function(){return this.m_angularVelocity};b.prototype.GetDefinition=function(){var a=new ha;a.type=this.GetType();a.allowSleep=(this.m_flags&b.e_allowSleepFlag)==b.e_allowSleepFlag;a.angle=this.GetAngle();a.angularDamping=this.m_angularDamping;a.angularVelocity=this.m_angularVelocity;a.fixedRotation=(this.m_flags&b.e_fixedRotationFlag)==b.e_fixedRotationFlag;a.bullet=(this.m_flags&b.e_bulletFlag)==b.e_bulletFlag;a.awake=(this.m_flags&b.e_awakeFlag)==
b.e_awakeFlag;a.linearDamping=this.m_linearDamping;a.linearVelocity.SetV(this.GetLinearVelocity());a.position=this.GetPosition();a.userData=this.GetUserData();return a};b.prototype.ApplyForce=function(a,d){this.m_type==b.b2_dynamicBody&&(0==this.IsAwake()&&this.SetAwake(!0),this.m_force.x+=a.x,this.m_force.y+=a.y,this.m_torque+=(d.x-this.m_sweep.c.x)*a.y-(d.y-this.m_sweep.c.y)*a.x)};b.prototype.ApplyTorque=function(a){a=a||0;this.m_type==b.b2_dynamicBody&&(0==this.IsAwake()&&this.SetAwake(!0),this.m_torque+=
a)};b.prototype.ApplyImpulse=function(a,d){this.m_type==b.b2_dynamicBody&&(0==this.IsAwake()&&this.SetAwake(!0),this.m_linearVelocity.x+=this.m_invMass*a.x,this.m_linearVelocity.y+=this.m_invMass*a.y,this.m_angularVelocity+=this.m_invI*((d.x-this.m_sweep.c.x)*a.y-(d.y-this.m_sweep.c.y)*a.x))};b.prototype.Split=function(a){for(var b=this.GetLinearVelocity().Copy(),c=this.GetAngularVelocity(),e=this.GetWorldCenter(),f=this.m_world.CreateBody(this.GetDefinition()),k,h=this.m_fixtureList;h;)if(a(h)){var g=
h.m_next;k?k.m_next=g:this.m_fixtureList=g;this.m_fixtureCount--;h.m_next=f.m_fixtureList;f.m_fixtureList=h;f.m_fixtureCount++;h.m_body=f;h=g}else k=h,h=h.m_next;this.ResetMassData();f.ResetMassData();k=this.GetWorldCenter();a=f.GetWorldCenter();k=r.AddVV(b,r.CrossFV(c,r.SubtractVV(k,e)));b=r.AddVV(b,r.CrossFV(c,r.SubtractVV(a,e)));this.SetLinearVelocity(k);f.SetLinearVelocity(b);this.SetAngularVelocity(c);f.SetAngularVelocity(c);this.SynchronizeFixtures();f.SynchronizeFixtures();return f};b.prototype.Merge=
function(a){var b;for(b=a.m_fixtureList;b;){var c=b.m_next;a.m_fixtureCount--;b.m_next=this.m_fixtureList;this.m_fixtureList=b;this.m_fixtureCount++;b.m_body=f;b=c}e.m_fixtureCount=0;var e=this,f=a;e.GetWorldCenter();f.GetWorldCenter();e.GetLinearVelocity().Copy();f.GetLinearVelocity().Copy();e.GetAngularVelocity();f.GetAngularVelocity();e.ResetMassData();this.SynchronizeFixtures()};b.prototype.GetMass=function(){return this.m_mass};b.prototype.GetInertia=function(){return this.m_I};b.prototype.GetMassData=
function(a){a.mass=this.m_mass;a.I=this.m_I;a.center.SetV(this.m_sweep.localCenter)};b.prototype.SetMassData=function(a){u.b2Assert(0==this.m_world.IsLocked());if(1!=this.m_world.IsLocked()&&this.m_type==b.b2_dynamicBody){this.m_invI=this.m_I=this.m_invMass=0;this.m_mass=a.mass;0>=this.m_mass&&(this.m_mass=1);this.m_invMass=1/this.m_mass;0<a.I&&0==(this.m_flags&b.e_fixedRotationFlag)&&(this.m_I=a.I-this.m_mass*(a.center.x*a.center.x+a.center.y*a.center.y),this.m_invI=1/this.m_I);var d=this.m_sweep.c.Copy();
this.m_sweep.localCenter.SetV(a.center);this.m_sweep.c0.SetV(r.MulX(this.m_xf,this.m_sweep.localCenter));this.m_sweep.c.SetV(this.m_sweep.c0);this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-d.y);this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-d.x)}};b.prototype.ResetMassData=function(){this.m_invI=this.m_I=this.m_invMass=this.m_mass=0;this.m_sweep.localCenter.SetZero();if(this.m_type!=b.b2_staticBody&&this.m_type!=b.b2_kinematicBody){for(var a=p.Make(0,0),d=this.m_fixtureList;d;d=
d.m_next)if(0!=d.m_density){var c=d.GetMassData();this.m_mass+=c.mass;a.x+=c.center.x*c.mass;a.y+=c.center.y*c.mass;this.m_I+=c.I}0<this.m_mass?(this.m_invMass=1/this.m_mass,a.x*=this.m_invMass,a.y*=this.m_invMass):this.m_invMass=this.m_mass=1;0<this.m_I&&0==(this.m_flags&b.e_fixedRotationFlag)?(this.m_I-=this.m_mass*(a.x*a.x+a.y*a.y),this.m_I*=this.m_inertiaScale,u.b2Assert(0<this.m_I),this.m_invI=1/this.m_I):this.m_invI=this.m_I=0;d=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(a);this.m_sweep.c0.SetV(r.MulX(this.m_xf,
this.m_sweep.localCenter));this.m_sweep.c.SetV(this.m_sweep.c0);this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-d.y);this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-d.x)}};b.prototype.GetWorldPoint=function(a){var b=this.m_xf.R;a=new p(b.col1.x*a.x+b.col2.x*a.y,b.col1.y*a.x+b.col2.y*a.y);a.x+=this.m_xf.position.x;a.y+=this.m_xf.position.y;return a};b.prototype.GetWorldVector=function(a){return r.MulMV(this.m_xf.R,a)};b.prototype.GetLocalPoint=function(a){return r.MulXT(this.m_xf,
a)};b.prototype.GetLocalVector=function(a){return r.MulTMV(this.m_xf.R,a)};b.prototype.GetLinearVelocityFromWorldPoint=function(a){return new p(this.m_linearVelocity.x-this.m_angularVelocity*(a.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(a.x-this.m_sweep.c.x))};b.prototype.GetLinearVelocityFromLocalPoint=function(a){var b=this.m_xf.R;a=new p(b.col1.x*a.x+b.col2.x*a.y,b.col1.y*a.x+b.col2.y*a.y);a.x+=this.m_xf.position.x;a.y+=this.m_xf.position.y;return new p(this.m_linearVelocity.x-
this.m_angularVelocity*(a.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(a.x-this.m_sweep.c.x))};b.prototype.GetLinearDamping=function(){return this.m_linearDamping};b.prototype.SetLinearDamping=function(a){this.m_linearDamping=a||0};b.prototype.GetAngularDamping=function(){return this.m_angularDamping};b.prototype.SetAngularDamping=function(a){this.m_angularDamping=a||0};b.prototype.SetType=function(a){a=a||0;if(this.m_type!=a)for(this.m_type=a,this.ResetMassData(),this.m_type==
b.b2_staticBody&&(this.m_linearVelocity.SetZero(),this.m_angularVelocity=0),this.SetAwake(!0),this.m_force.SetZero(),this.m_torque=0,a=this.m_contactList;a;a=a.next)a.contact.FlagForFiltering()};b.prototype.GetType=function(){return this.m_type};b.prototype.SetBullet=function(a){this.m_flags=a?this.m_flags|b.e_bulletFlag:this.m_flags&~b.e_bulletFlag};b.prototype.IsBullet=function(){return(this.m_flags&b.e_bulletFlag)==b.e_bulletFlag};b.prototype.SetSleepingAllowed=function(a){a?this.m_flags|=b.e_allowSleepFlag:
(this.m_flags&=~b.e_allowSleepFlag,this.SetAwake(!0))};b.prototype.SetAwake=function(a){a?(this.m_flags|=b.e_awakeFlag,this.m_sleepTime=0):(this.m_flags&=~b.e_awakeFlag,this.m_sleepTime=0,this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_force.SetZero(),this.m_torque=0)};b.prototype.IsAwake=function(){return(this.m_flags&b.e_awakeFlag)==b.e_awakeFlag};b.prototype.SetFixedRotation=function(a){this.m_flags=a?this.m_flags|b.e_fixedRotationFlag:this.m_flags&~b.e_fixedRotationFlag;this.ResetMassData()};
b.prototype.IsFixedRotation=function(){return(this.m_flags&b.e_fixedRotationFlag)==b.e_fixedRotationFlag};b.prototype.SetActive=function(a){if(a!=this.IsActive()){var d;if(a)for(this.m_flags|=b.e_activeFlag,a=this.m_world.m_contactManager.m_broadPhase,d=this.m_fixtureList;d;d=d.m_next)d.CreateProxy(a,this.m_xf);else{this.m_flags&=~b.e_activeFlag;a=this.m_world.m_contactManager.m_broadPhase;for(d=this.m_fixtureList;d;d=d.m_next)d.DestroyProxy(a);for(a=this.m_contactList;a;)d=a,a=a.next,this.m_world.m_contactManager.Destroy(d.contact);
this.m_contactList=null}}};b.prototype.IsActive=function(){return(this.m_flags&b.e_activeFlag)==b.e_activeFlag};b.prototype.IsSleepingAllowed=function(){return(this.m_flags&b.e_allowSleepFlag)==b.e_allowSleepFlag};b.prototype.GetFixtureList=function(){return this.m_fixtureList};b.prototype.GetJointList=function(){return this.m_jointList};b.prototype.GetControllerList=function(){return this.m_controllerList};b.prototype.GetContactList=function(){return this.m_contactList};b.prototype.GetNext=function(){return this.m_next};
b.prototype.GetUserData=function(){return this.m_userData};b.prototype.SetUserData=function(a){this.m_userData=a};b.prototype.GetWorld=function(){return this.m_world};b.prototype.SynchronizeFixtures=function(){var a=b.s_xf1;a.R.Set(this.m_sweep.a0);var d=a.R,c=this.m_sweep.localCenter;a.position.x=this.m_sweep.c0.x-(d.col1.x*c.x+d.col2.x*c.y);a.position.y=this.m_sweep.c0.y-(d.col1.y*c.x+d.col2.y*c.y);c=this.m_world.m_contactManager.m_broadPhase;for(d=this.m_fixtureList;d;d=d.m_next)d.Synchronize(c,
a,this.m_xf)};b.prototype.SynchronizeTransform=function(){this.m_xf.R.Set(this.m_sweep.a);var a=this.m_xf.R,b=this.m_sweep.localCenter;this.m_xf.position.x=this.m_sweep.c.x-(a.col1.x*b.x+a.col2.x*b.y);this.m_xf.position.y=this.m_sweep.c.y-(a.col1.y*b.x+a.col2.y*b.y)};b.prototype.ShouldCollide=function(a){if(this.m_type!=b.b2_dynamicBody&&a.m_type!=b.b2_dynamicBody)return!1;for(var d=this.m_jointList;d;d=d.next)if(d.other==a&&0==d.joint.m_collideConnected)return!1;return!0};b.prototype.Advance=function(a){this.m_sweep.Advance(a||
0);this.m_sweep.c.SetV(this.m_sweep.c0);this.m_sweep.a=this.m_sweep.a0;this.SynchronizeTransform()};return b}();t.Dynamics.b2DebugDraw=R=function(){function b(){this.m_xformScale=this.m_fillAlpha=this.m_alpha=this.m_lineThickness=this.m_drawScale=1;var a=this;this.m_sprite={graphics:{clear:function(){a.m_ctx.clearRect(0,0,a.m_ctx.canvas.width,a.m_ctx.canvas.height)}}};this.m_drawFlags=0}"use strict;";b.e_shapeBit=1;b.e_jointBit=2;b.e_aabbBit=4;b.e_pairBit=8;b.e_centerOfMassBit=16;b.e_controllerBit=
32;b.prototype.SetFlags=function(a){this.m_drawFlags=a||0};b.prototype.GetFlags=function(){return this.m_drawFlags};b.prototype.AppendFlags=function(a){this.m_drawFlags|=a||0};b.prototype.ClearFlags=function(a){this.m_drawFlags&=~(a||0)};b.prototype.SetSprite=function(a){this.m_ctx=a};b.prototype.GetSprite=function(){return this.m_ctx};b.prototype.SetDrawScale=function(a){this.m_drawScale=a||0};b.prototype.GetDrawScale=function(){return this.m_drawScale};b.prototype.SetLineThickness=function(a){this.m_lineThickness=
a=a||0;this.m_ctx.strokeWidth=a};b.prototype.GetLineThickness=function(){return this.m_lineThickness};b.prototype.SetAlpha=function(a){this.m_alpha=a||0};b.prototype.GetAlpha=function(){return this.m_alpha};b.prototype.SetFillAlpha=function(a){this.m_fillAlpha=a||0};b.prototype.GetFillAlpha=function(){return this.m_fillAlpha};b.prototype.SetXFormScale=function(a){this.m_xformScale=a||0};b.prototype.GetXFormScale=function(){return this.m_xformScale};b.prototype.DrawPolygon=function(a,b,c){if(b){var e=
this.m_ctx,f=this.m_drawScale;e.beginPath();e.strokeStyle=this._color(c.color,this.m_alpha);e.moveTo(a[0].x*f,a[0].y*f);for(c=1;c<b;c++)e.lineTo(a[c].x*f,a[c].y*f);e.lineTo(a[0].x*f,a[0].y*f);e.closePath();e.stroke()}};b.prototype.DrawSolidPolygon=function(a,b,c){if(b){var e=this.m_ctx,f=this.m_drawScale;e.beginPath();e.strokeStyle=this._color(c.color,this.m_alpha);e.fillStyle=this._color(c.color,this.m_fillAlpha);e.moveTo(a[0].x*f,a[0].y*f);for(c=1;c<b;c++)e.lineTo(a[c].x*f,a[c].y*f);e.lineTo(a[0].x*
f,a[0].y*f);e.closePath();e.fill();e.stroke()}};b.prototype.DrawCircle=function(a,b,c){if(b){var e=this.m_ctx,f=this.m_drawScale;e.beginPath();e.strokeStyle=this._color(c.color,this.m_alpha);e.arc(a.x*f,a.y*f,b*f,0,2*Math.PI,!0);e.closePath();e.stroke()}};b.prototype.DrawSolidCircle=function(a,b,c,e){if(b){var f=this.m_ctx,k=this.m_drawScale,h=a.x*k,g=a.y*k;f.moveTo(0,0);f.beginPath();f.strokeStyle=this._color(e.color,this.m_alpha);f.fillStyle=this._color(e.color,this.m_fillAlpha);f.arc(h,g,b*k,0,
2*Math.PI,!0);f.moveTo(h,g);f.lineTo((a.x+c.x*b)*k,(a.y+c.y*b)*k);f.closePath();f.fill();f.stroke()}};b.prototype.DrawSegment=function(a,b,c){var e=this.m_ctx,f=this.m_drawScale;e.strokeStyle=this._color(c.color,this.m_alpha);e.beginPath();e.moveTo(a.x*f,a.y*f);e.lineTo(b.x*f,b.y*f);e.closePath();e.stroke()};b.prototype.DrawTransform=function(a){var b=this.m_ctx,c=this.m_drawScale;b.beginPath();b.strokeStyle=this._color(16711680,this.m_alpha);b.moveTo(a.position.x*c,a.position.y*c);b.lineTo((a.position.x+
this.m_xformScale*a.R.col1.x)*c,(a.position.y+this.m_xformScale*a.R.col1.y)*c);b.strokeStyle=this._color(65280,this.m_alpha);b.moveTo(a.position.x*c,a.position.y*c);b.lineTo((a.position.x+this.m_xformScale*a.R.col2.x)*c,(a.position.y+this.m_xformScale*a.R.col2.y)*c);b.closePath();b.stroke()};b.prototype._color=function(a,b){return"rgba("+((a&16711680)>>16)+","+((a&65280)>>8)+","+(a&255)+","+b+")"};return b}();t.Dynamics.b2BodyDef=ha=function(){function b(){this.position=new p;this.linearVelocity=
new p;this.position.Set(0,0);this.linearVelocity.Set(0,0)}"use strict;";b.prototype.position=null;b.prototype.linearVelocity=null;b.prototype.userData=null;b.prototype.angle=0;b.prototype.linearVelocity=null;b.prototype.angularVelocity=0;b.prototype.linearDamping=0;b.prototype.angularDamping=0;b.prototype.allowSleep=!0;b.prototype.awake=!0;b.prototype.fixedRotation=!1;b.prototype.bullet=!1;b.prototype.type=w.b2_staticBody;b.prototype.active=!0;b.prototype.inertiaScale=1;return b}();t.Dynamics.b2ContactFilter=
ka=function(){function b(){}"use strict;";b.prototype.ShouldCollide=function(a,b){var c=a.GetFilterData(),e=b.GetFilterData();return c.groupIndex==e.groupIndex&&0!=c.groupIndex?0<c.groupIndex:0!=(c.maskBits&e.categoryBits)&&0!=(c.categoryBits&e.maskBits)};b.prototype.RayCollide=function(a,b){return a?this.ShouldCollide(a instanceof M?a:null,b):!0};b.b2_defaultFilter=new b;return b}();t.Dynamics.b2ContactImpulse=Ba=function(){"use strict;";return function(){this.normalImpulses=new I(u.b2_maxManifoldPoints);
this.tangentImpulses=new I(u.b2_maxManifoldPoints)}}();t.Dynamics.b2FixtureDef=Na=function(){function b(){this.filter=new pa;this.filter.categoryBits=1;this.filter.maskBits=65535;this.filter.groupIndex=0}"use strict;";b.prototype.shape=null;b.prototype.userData=null;b.prototype.friction=.2;b.prototype.restitution=0;b.prototype.density=0;b.prototype.isSensor=!1;b.prototype.filter=null;return b}();t.Dynamics.b2Island=Sa=function(){function b(){this.m_bodies=new y;this.m_contacts=new y;this.m_joints=
new y}"use strict;";b.s_impulse=new Ba;b.prototype.Initialize=function(a,b,c,e,f,k){a=a||0;b=b||0;c=c||0;var h=0;this.m_bodyCapacity=a;this.m_contactCapacity=b;this.m_jointCapacity=c;this.m_jointCount=this.m_contactCount=this.m_bodyCount=0;this.m_allocator=e;this.m_listener=f;this.m_contactSolver=k;for(h=this.m_bodies.length;h<a;h++)this.m_bodies[h]=null;for(h=this.m_contacts.length;h<b;h++)this.m_contacts[h]=null;for(h=this.m_joints.length;h<c;h++)this.m_joints[h]=null};b.prototype.Clear=function(){this.m_jointCount=
this.m_contactCount=this.m_bodyCount=0};b.prototype.Solve=function(a,b,c){for(var e=0,f=0,k,e=0;e<this.m_bodyCount;++e)f=this.m_bodies[e],f.GetType()==w.b2_dynamicBody&&(f.m_linearVelocity.x+=a.dt*(b.x+f.m_invMass*f.m_force.x),f.m_linearVelocity.y+=a.dt*(b.y+f.m_invMass*f.m_force.y),f.m_angularVelocity+=a.dt*f.m_invI*f.m_torque,f.m_linearVelocity.Multiply(r.Clamp(1-a.dt*f.m_linearDamping,0,1)),f.m_angularVelocity*=r.Clamp(1-a.dt*f.m_angularDamping,0,1));this.m_contactSolver.Initialize(a,this.m_contacts,
this.m_contactCount,this.m_allocator);b=this.m_contactSolver;b.InitVelocityConstraints(a);for(e=0;e<this.m_jointCount;++e)k=this.m_joints[e],k.InitVelocityConstraints(a);for(e=0;e<a.velocityIterations;++e){for(f=0;f<this.m_jointCount;++f)k=this.m_joints[f],k.SolveVelocityConstraints(a);b.SolveVelocityConstraints()}for(e=0;e<this.m_jointCount;++e)k=this.m_joints[e],k.FinalizeVelocityConstraints();b.FinalizeVelocityConstraints();for(e=0;e<this.m_bodyCount;++e)if(f=this.m_bodies[e],f.GetType()!=w.b2_staticBody){var h=
a.dt*f.m_linearVelocity.x,g=a.dt*f.m_linearVelocity.y;h*h+g*g>u.b2_maxTranslationSquared&&(f.m_linearVelocity.Normalize(),f.m_linearVelocity.x=f.m_linearVelocity.x*u.b2_maxTranslation*a.inv_dt,f.m_linearVelocity.y=f.m_linearVelocity.y*u.b2_maxTranslation*a.inv_dt);h=a.dt*f.m_angularVelocity;h*h>u.b2_maxRotationSquared&&(f.m_angularVelocity=0>f.m_angularVelocity?-u.b2_maxRotation*a.inv_dt:u.b2_maxRotation*a.inv_dt);f.m_sweep.c0.SetV(f.m_sweep.c);f.m_sweep.a0=f.m_sweep.a;f.m_sweep.c.x+=a.dt*f.m_linearVelocity.x;
f.m_sweep.c.y+=a.dt*f.m_linearVelocity.y;f.m_sweep.a+=a.dt*f.m_angularVelocity;f.SynchronizeTransform()}for(e=0;e<a.positionIterations;++e){h=b.SolvePositionConstraints(u.b2_contactBaumgarte);g=!0;for(f=0;f<this.m_jointCount;++f)k=this.m_joints[f],k=k.SolvePositionConstraints(u.b2_contactBaumgarte),g=g&&k;if(h&&g)break}this.Report(b.m_constraints);if(c){c=Number.MAX_VALUE;b=u.b2_linearSleepTolerance*u.b2_linearSleepTolerance;h=u.b2_angularSleepTolerance*u.b2_angularSleepTolerance;for(e=0;e<this.m_bodyCount;++e)f=
this.m_bodies[e],f.GetType()!=w.b2_staticBody&&(0==(f.m_flags&w.e_allowSleepFlag)&&(c=f.m_sleepTime=0),0==(f.m_flags&w.e_allowSleepFlag)||f.m_angularVelocity*f.m_angularVelocity>h||r.Dot(f.m_linearVelocity,f.m_linearVelocity)>b?c=f.m_sleepTime=0:(f.m_sleepTime+=a.dt,c=r.Min(c,f.m_sleepTime)));if(c>=u.b2_timeToSleep)for(e=0;e<this.m_bodyCount;++e)f=this.m_bodies[e],f.SetAwake(!1)}};b.prototype.SolveTOI=function(a){var b=0,c=0;this.m_contactSolver.Initialize(a,this.m_contacts,this.m_contactCount,this.m_allocator);
for(var e=this.m_contactSolver,b=0;b<this.m_jointCount;++b)this.m_joints[b].InitVelocityConstraints(a);for(b=0;b<a.velocityIterations;++b)for(e.SolveVelocityConstraints(),c=0;c<this.m_jointCount;++c)this.m_joints[c].SolveVelocityConstraints(a);for(b=0;b<this.m_bodyCount;++b)if(c=this.m_bodies[b],c.GetType()!=w.b2_staticBody){var f=a.dt*c.m_linearVelocity.x,k=a.dt*c.m_linearVelocity.y;f*f+k*k>u.b2_maxTranslationSquared&&(c.m_linearVelocity.Normalize(),c.m_linearVelocity.x=c.m_linearVelocity.x*u.b2_maxTranslation*
a.inv_dt,c.m_linearVelocity.y=c.m_linearVelocity.y*u.b2_maxTranslation*a.inv_dt);f=a.dt*c.m_angularVelocity;f*f>u.b2_maxRotationSquared&&(c.m_angularVelocity=0>c.m_angularVelocity?-u.b2_maxRotation*a.inv_dt:u.b2_maxRotation*a.inv_dt);c.m_sweep.c0.SetV(c.m_sweep.c);c.m_sweep.a0=c.m_sweep.a;c.m_sweep.c.x+=a.dt*c.m_linearVelocity.x;c.m_sweep.c.y+=a.dt*c.m_linearVelocity.y;c.m_sweep.a+=a.dt*c.m_angularVelocity;c.SynchronizeTransform()}for(b=0;b<a.positionIterations;++b){f=e.SolvePositionConstraints(.75);
k=!0;for(c=0;c<this.m_jointCount;++c)var h=this.m_joints[c].SolvePositionConstraints(u.b2_contactBaumgarte),k=k&&h;if(f&&k)break}this.Report(e.m_constraints)};b.prototype.Report=function(a){if(null!=this.m_listener)for(var d=0;d<this.m_contactCount;++d){for(var c=this.m_contacts[d],e=a[d],f=0;f<e.pointCount;++f)b.s_impulse.normalImpulses[f]=e.points[f].normalImpulse,b.s_impulse.tangentImpulses[f]=e.points[f].tangentImpulse;this.m_listener.PostSolve(c,b.s_impulse)}};b.prototype.AddBody=function(a){a.m_islandIndex=
this.m_bodyCount;this.m_bodies[this.m_bodyCount++]=a};b.prototype.AddContact=function(a){this.m_contacts[this.m_contactCount++]=a};b.prototype.AddJoint=function(a){this.m_joints[this.m_jointCount++]=a};return b}();t.Dynamics.b2World=hb=function(){function b(a,d){this.s_stack=new y;this.m_contactManager=new Da;this.m_contactSolver=new Ga;this.m_island=new Sa;this.m_controllerList=this.m_jointList=this.m_contactList=this.m_bodyList=this.m_debugDraw=this.m_destructionListener=null;this.m_controllerCount=
this.m_jointCount=this.m_contactCount=this.m_bodyCount=0;b.m_warmStarting=!0;b.m_continuousPhysics=!0;this.m_allowSleep=d;this.m_gravity=a;this.m_inv_dt0=0;this.m_contactManager.m_world=this;var c=new ha;this.m_groundBody=this.CreateBody(c)}"use strict;";b.s_timestep2=new fa;b.s_xf=new N;b.s_backupA=new T;b.s_backupB=new T;b.s_timestep=new fa;b.s_queue=new y;b.s_jointColor=new Z(.5,.8,.8);b.e_newFixture=1;b.e_locked=2;b.prototype.SetDestructionListener=function(a){this.m_destructionListener=a};b.prototype.SetContactFilter=
function(a){this.m_contactManager.m_contactFilter=a};b.prototype.SetContactListener=function(a){this.m_contactManager.m_contactListener=a};b.prototype.SetDebugDraw=function(a){this.m_debugDraw=a};b.prototype.SetBroadPhase=function(a){var b=this.m_contactManager.m_broadPhase;this.m_contactManager.m_broadPhase=a;for(var c=this.m_bodyList;c;c=c.m_next)for(var e=c.m_fixtureList;e;e=e.m_next)e.m_proxy=a.CreateProxy(b.GetFatAABB(e.m_proxy),e)};b.prototype.Validate=function(){this.m_contactManager.m_broadPhase.Validate()};
b.prototype.GetProxyCount=function(){return this.m_contactManager.m_broadPhase.GetProxyCount()};b.prototype.CreateBody=function(a){if(1==this.IsLocked())return null;a=new w(a,this);a.m_prev=null;if(a.m_next=this.m_bodyList)this.m_bodyList.m_prev=a;this.m_bodyList=a;++this.m_bodyCount;return a};b.prototype.DestroyBody=function(a){if(1!=this.IsLocked()){for(var b=a.m_jointList;b;){var c=b,b=b.next;this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(c.joint);this.DestroyJoint(c.joint)}for(b=
a.m_controllerList;b;)c=b,b=b.nextController,c.controller.RemoveBody(a);for(b=a.m_contactList;b;)c=b,b=b.next,this.m_contactManager.Destroy(c.contact);a.m_contactList=null;for(b=a.m_fixtureList;b;)c=b,b=b.m_next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeFixture(c),c.DestroyProxy(this.m_contactManager.m_broadPhase),c.Destroy();a.m_fixtureList=null;a.m_fixtureCount=0;a.m_prev&&(a.m_prev.m_next=a.m_next);a.m_next&&(a.m_next.m_prev=a.m_prev);a==this.m_bodyList&&(this.m_bodyList=
a.m_next);--this.m_bodyCount}};b.prototype.CreateJoint=function(a){var b=v.Create(a,null);b.m_prev=null;if(b.m_next=this.m_jointList)this.m_jointList.m_prev=b;this.m_jointList=b;++this.m_jointCount;b.m_edgeA.joint=b;b.m_edgeA.other=b.m_bodyB;b.m_edgeA.prev=null;if(b.m_edgeA.next=b.m_bodyA.m_jointList)b.m_bodyA.m_jointList.prev=b.m_edgeA;b.m_bodyA.m_jointList=b.m_edgeA;b.m_edgeB.joint=b;b.m_edgeB.other=b.m_bodyA;b.m_edgeB.prev=null;if(b.m_edgeB.next=b.m_bodyB.m_jointList)b.m_bodyB.m_jointList.prev=
b.m_edgeB;b.m_bodyB.m_jointList=b.m_edgeB;var c=a.bodyA,e=a.bodyB;if(0==a.collideConnected)for(a=e.GetContactList();a;)a.other==c&&a.contact.FlagForFiltering(),a=a.next;return b};b.prototype.DestroyJoint=function(a){var b=a.m_collideConnected;a.m_prev&&(a.m_prev.m_next=a.m_next);a.m_next&&(a.m_next.m_prev=a.m_prev);a==this.m_jointList&&(this.m_jointList=a.m_next);var c=a.m_bodyA,e=a.m_bodyB;c.SetAwake(!0);e.SetAwake(!0);a.m_edgeA.prev&&(a.m_edgeA.prev.next=a.m_edgeA.next);a.m_edgeA.next&&(a.m_edgeA.next.prev=
a.m_edgeA.prev);a.m_edgeA==c.m_jointList&&(c.m_jointList=a.m_edgeA.next);a.m_edgeA.prev=null;a.m_edgeA.next=null;a.m_edgeB.prev&&(a.m_edgeB.prev.next=a.m_edgeB.next);a.m_edgeB.next&&(a.m_edgeB.next.prev=a.m_edgeB.prev);a.m_edgeB==e.m_jointList&&(e.m_jointList=a.m_edgeB.next);a.m_edgeB.prev=null;a.m_edgeB.next=null;v.Destroy(a,null);--this.m_jointCount;if(0==b)for(a=e.GetContactList();a;)a.other==c&&a.contact.FlagForFiltering(),a=a.next};b.prototype.AddController=function(a){a.m_next=this.m_controllerList;
a.m_prev=null;this.m_controllerList=a;a.m_world=this;this.m_controllerCount++;return a};b.prototype.RemoveController=function(a){a.m_prev&&(a.m_prev.m_next=a.m_next);a.m_next&&(a.m_next.m_prev=a.m_prev);this.m_controllerList==a&&(this.m_controllerList=a.m_next);this.m_controllerCount--};b.prototype.CreateController=function(a){if(a.m_world!=this)throw Error("Controller can only be a member of one world");a.m_next=this.m_controllerList;a.m_prev=null;this.m_controllerList&&(this.m_controllerList.m_prev=
a);this.m_controllerList=a;++this.m_controllerCount;a.m_world=this;return a};b.prototype.DestroyController=function(a){a.Clear();a.m_next&&(a.m_next.m_prev=a.m_prev);a.m_prev&&(a.m_prev.m_next=a.m_next);a==this.m_controllerList&&(this.m_controllerList=a.m_next);--this.m_controllerCount};b.prototype.SetWarmStarting=function(a){b.m_warmStarting=a};b.prototype.SetContinuousPhysics=function(a){b.m_continuousPhysics=a};b.prototype.GetBodyCount=function(){return this.m_bodyCount};b.prototype.GetJointCount=
function(){return this.m_jointCount};b.prototype.GetContactCount=function(){return this.m_contactCount};b.prototype.SetGravity=function(a){this.m_gravity=a};b.prototype.GetGravity=function(){return this.m_gravity};b.prototype.GetGroundBody=function(){return this.m_groundBody};b.prototype.Step=function(a,d,c){a=a||0;d=d||0;c=c||0;this.m_flags&b.e_newFixture&&(this.m_contactManager.FindNewContacts(),this.m_flags&=~b.e_newFixture);this.m_flags|=b.e_locked;var e=b.s_timestep2;e.dt=a;e.velocityIterations=
d;e.positionIterations=c;e.inv_dt=0<a?1/a:0;e.dtRatio=this.m_inv_dt0*a;e.warmStarting=b.m_warmStarting;this.m_contactManager.Collide();0<e.dt&&this.Solve(e);b.m_continuousPhysics&&0<e.dt&&this.SolveTOI(e);0<e.dt&&(this.m_inv_dt0=e.inv_dt);this.m_flags&=~b.e_locked};b.prototype.ClearForces=function(){for(var a=this.m_bodyList;a;a=a.m_next)a.m_force.SetZero(),a.m_torque=0};b.prototype.DrawDebugData=function(){if(null!=this.m_debugDraw){this.m_debugDraw.m_sprite.graphics.clear();var a=this.m_debugDraw.GetFlags(),
d,c,e;new p;new p;new p;var f;new K;new K;f=[new p,new p,new p,new p];var k=new Z(0,0,0);if(a&R.e_shapeBit)for(d=this.m_bodyList;d;d=d.m_next)for(f=d.m_xf,c=d.GetFixtureList();c;c=c.m_next)e=c.GetShape(),0==d.IsActive()?k.Set(.5,.5,.3):d.GetType()==w.b2_staticBody?k.Set(.5,.9,.5):d.GetType()==w.b2_kinematicBody?k.Set(.5,.5,.9):0==d.IsAwake()?k.Set(.6,.6,.6):k.Set(.9,.7,.7),this.DrawShape(e,f,k);if(a&R.e_jointBit)for(d=this.m_jointList;d;d=d.m_next)this.DrawJoint(d);if(a&R.e_controllerBit)for(d=this.m_controllerList;d;d=
d.m_next)d.Draw(this.m_debugDraw);if(a&R.e_pairBit)for(k.Set(.3,.9,.9),d=this.m_contactManager.m_contactList;d;d=d.GetNext())e=d.GetFixtureA(),c=d.GetFixtureB(),e=e.GetAABB().GetCenter(),c=c.GetAABB().GetCenter(),this.m_debugDraw.DrawSegment(e,c,k);if(a&R.e_aabbBit)for(e=this.m_contactManager.m_broadPhase,f=[new p,new p,new p,new p],d=this.m_bodyList;d;d=d.GetNext())if(0!=d.IsActive())for(c=d.GetFixtureList();c;c=c.GetNext()){var h=e.GetFatAABB(c.m_proxy);f[0].Set(h.lowerBound.x,h.lowerBound.y);f[1].Set(h.upperBound.x,
h.lowerBound.y);f[2].Set(h.upperBound.x,h.upperBound.y);f[3].Set(h.lowerBound.x,h.upperBound.y);this.m_debugDraw.DrawPolygon(f,4,k)}if(a&R.e_centerOfMassBit)for(d=this.m_bodyList;d;d=d.m_next)f=b.s_xf,f.R=d.m_xf.R,f.position=d.GetWorldCenter(),this.m_debugDraw.DrawTransform(f)}};b.prototype.QueryAABB=function(a,b){var c=this.m_contactManager.m_broadPhase;c.Query(function(b){return a(c.GetUserData(b))},b)};b.prototype.QueryShape=function(a,b,c){c=c||null;null==c&&(c=new N,c.SetIdentity());var e=this.m_contactManager.m_broadPhase,
f=new K;b.ComputeAABB(f,c);e.Query(function(f){f=e.GetUserData(f)instanceof M?e.GetUserData(f):null;return A.TestOverlap(b,c,f.GetShape(),f.GetBody().GetTransform())?a(f):!0},f)};b.prototype.QueryPoint=function(a,b){var c=this.m_contactManager.m_broadPhase,e=new K;e.lowerBound.Set(b.x-u.b2_linearSlop,b.y-u.b2_linearSlop);e.upperBound.Set(b.x+u.b2_linearSlop,b.y+u.b2_linearSlop);c.Query(function(e){e=c.GetUserData(e)instanceof M?c.GetUserData(e):null;return e.TestPoint(b)?a(e):!0},e)};b.prototype.RayCast=
function(a,b,c){var e=this.m_contactManager.m_broadPhase,f=new ab,k=new va(b,c);e.RayCast(function(h,g){var k=e.GetUserData(g),k=k instanceof M?k:null;if(k.RayCast(f,h)){var m=f.fraction,n=new p((1-m)*b.x+m*c.x,(1-m)*b.y+m*c.y);return a(k,n,f.normal,m)}return h.maxFraction},k)};b.prototype.RayCastOne=function(a,b){var c;this.RayCast(function(a,b,d,h){c=a;return h||0},a,b);return c};b.prototype.RayCastAll=function(a,b){var c=new y;this.RayCast(function(a,b,d,h){c[c.length]=a;return 1},a,b);return c};
b.prototype.GetBodyList=function(){return this.m_bodyList};b.prototype.GetJointList=function(){return this.m_jointList};b.prototype.GetContactList=function(){return this.m_contactList};b.prototype.IsLocked=function(){return 0<(this.m_flags&b.e_locked)};b.prototype.Solve=function(a){for(var b,c=this.m_controllerList;c;c=c.m_next)c.Step(a);c=this.m_island;c.Initialize(this.m_bodyCount,this.m_contactCount,this.m_jointCount,null,this.m_contactManager.m_contactListener,this.m_contactSolver);for(b=this.m_bodyList;b;b=
b.m_next)b.m_flags&=~w.e_islandFlag;for(var e=this.m_contactList;e;e=e.m_next)e.m_flags&=~n.e_islandFlag;for(e=this.m_jointList;e;e=e.m_next)e.m_islandFlag=!1;parseInt(this.m_bodyCount);for(var e=this.s_stack,f=this.m_bodyList;f;f=f.m_next)if(!(f.m_flags&w.e_islandFlag)&&0!=f.IsAwake()&&0!=f.IsActive()&&f.GetType()!=w.b2_staticBody){c.Clear();var k=0;e[k++]=f;for(f.m_flags|=w.e_islandFlag;0<k;)if(b=e[--k],c.AddBody(b),0==b.IsAwake()&&b.SetAwake(!0),b.GetType()!=w.b2_staticBody){for(var h,g=b.m_contactList;g;g=
g.next)g.contact.m_flags&n.e_islandFlag||1==g.contact.IsSensor()||0==g.contact.IsEnabled()||0==g.contact.IsTouching()||(c.AddContact(g.contact),g.contact.m_flags|=n.e_islandFlag,h=g.other,h.m_flags&w.e_islandFlag||(e[k++]=h,h.m_flags|=w.e_islandFlag));for(b=b.m_jointList;b;b=b.next)1!=b.joint.m_islandFlag&&(h=b.other,0!=h.IsActive()&&(c.AddJoint(b.joint),b.joint.m_islandFlag=!0,h.m_flags&w.e_islandFlag||(e[k++]=h,h.m_flags|=w.e_islandFlag)))}c.Solve(a,this.m_gravity,this.m_allowSleep);for(k=0;k<c.m_bodyCount;++k)b=
c.m_bodies[k],b.GetType()==w.b2_staticBody&&(b.m_flags&=~w.e_islandFlag)}for(k=0;k<e.length&&e[k];++k)e[k]=null;for(b=this.m_bodyList;b;b=b.m_next)0!=b.IsAwake()&&0!=b.IsActive()&&b.GetType()!=w.b2_staticBody&&b.SynchronizeFixtures();this.m_contactManager.FindNewContacts()};b.prototype.SolveTOI=function(a){var d,c,e,f=this.m_island;f.Initialize(this.m_bodyCount,u.b2_maxTOIContactsPerIsland,u.b2_maxTOIJointsPerIsland,null,this.m_contactManager.m_contactListener,this.m_contactSolver);var k=b.s_queue;
for(d=this.m_bodyList;d;d=d.m_next)d.m_flags&=~w.e_islandFlag,d.m_sweep.t0=0;for(e=this.m_contactList;e;e=e.m_next)e.m_flags&=~(n.e_toiFlag|n.e_islandFlag);for(e=this.m_jointList;e;e=e.m_next)e.m_islandFlag=!1;for(;;){var h=null,g=1;for(e=this.m_contactList;e;e=e.m_next)if(1!=e.IsSensor()&&0!=e.IsEnabled()&&0!=e.IsContinuous()){d=1;if(e.m_flags&n.e_toiFlag)d=e.m_toi;else{d=e.m_fixtureA;c=e.m_fixtureB;d=d.m_body;c=c.m_body;if(!(d.GetType()==w.b2_dynamicBody&&0!=d.IsAwake()||c.GetType()==w.b2_dynamicBody&&
0!=c.IsAwake()))continue;var l=d.m_sweep.t0;d.m_sweep.t0<c.m_sweep.t0?(l=c.m_sweep.t0,d.m_sweep.Advance(l)):c.m_sweep.t0<d.m_sweep.t0&&(l=d.m_sweep.t0,c.m_sweep.Advance(l));d=e.ComputeTOI(d.m_sweep,c.m_sweep);u.b2Assert(0<=d&&1>=d);0<d&&1>d&&(d=(1-d)*l+d,1<d&&(d=1));e.m_toi=d;e.m_flags|=n.e_toiFlag}Number.MIN_VALUE<d&&d<g&&(h=e,g=d)}if(null==h||1-100*Number.MIN_VALUE<g)break;d=h.m_fixtureA;c=h.m_fixtureB;d=d.m_body;c=c.m_body;b.s_backupA.Set(d.m_sweep);b.s_backupB.Set(c.m_sweep);d.Advance(g);c.Advance(g);
h.Update(this.m_contactManager.m_contactListener);h.m_flags&=~n.e_toiFlag;if(1==h.IsSensor()||0==h.IsEnabled())d.m_sweep.Set(b.s_backupA),c.m_sweep.Set(b.s_backupB),d.SynchronizeTransform(),c.SynchronizeTransform();else if(0!=h.IsTouching()){d.GetType()!=w.b2_dynamicBody&&(d=c);f.Clear();h=e=0;k[e+h++]=d;for(d.m_flags|=w.e_islandFlag;0<h;)if(d=k[e++],--h,f.AddBody(d),0==d.IsAwake()&&d.SetAwake(!0),d.GetType()==w.b2_dynamicBody){for(c=d.m_contactList;c&&f.m_contactCount!=f.m_contactCapacity;c=c.next)c.contact.m_flags&
n.e_islandFlag||1==c.contact.IsSensor()||0==c.contact.IsEnabled()||0==c.contact.IsTouching()||(f.AddContact(c.contact),c.contact.m_flags|=n.e_islandFlag,l=c.other,l.m_flags&w.e_islandFlag||(l.GetType()!=w.b2_staticBody&&(l.Advance(g),l.SetAwake(!0)),k[e+h]=l,++h,l.m_flags|=w.e_islandFlag));for(d=d.m_jointList;d;d=d.next)f.m_jointCount!=f.m_jointCapacity&&1!=d.joint.m_islandFlag&&(l=d.other,0!=l.IsActive()&&(f.AddJoint(d.joint),d.joint.m_islandFlag=!0,l.m_flags&w.e_islandFlag||(l.GetType()!=w.b2_staticBody&&
(l.Advance(g),l.SetAwake(!0)),k[e+h]=l,++h,l.m_flags|=w.e_islandFlag)))}e=b.s_timestep;e.warmStarting=!1;e.dt=(1-g)*a.dt;e.inv_dt=1/e.dt;e.dtRatio=0;e.velocityIterations=a.velocityIterations;e.positionIterations=a.positionIterations;f.SolveTOI(e);for(g=g=0;g<f.m_bodyCount;++g)if(d=f.m_bodies[g],d.m_flags&=~w.e_islandFlag,0!=d.IsAwake()&&d.GetType()==w.b2_dynamicBody)for(d.SynchronizeFixtures(),c=d.m_contactList;c;c=c.next)c.contact.m_flags&=~n.e_toiFlag;for(g=0;g<f.m_contactCount;++g)e=f.m_contacts[g],
e.m_flags&=~(n.e_toiFlag|n.e_islandFlag);for(g=0;g<f.m_jointCount;++g)e=f.m_joints[g],e.m_islandFlag=!1;this.m_contactManager.FindNewContacts()}}};b.prototype.DrawJoint=function(a){var d=a.GetBodyA(),c=a.GetBodyB(),e=d.m_xf.position,f=c.m_xf.position,k=a.GetAnchorA(),h=a.GetAnchorB(),g=b.s_jointColor;switch(a.m_type){case v.e_distanceJoint:this.m_debugDraw.DrawSegment(k,h,g);break;case v.e_pulleyJoint:d=a instanceof X?a:null;a=d.GetGroundAnchorA();d=d.GetGroundAnchorB();this.m_debugDraw.DrawSegment(a,
k,g);this.m_debugDraw.DrawSegment(d,h,g);this.m_debugDraw.DrawSegment(a,d,g);break;case v.e_mouseJoint:this.m_debugDraw.DrawSegment(k,h,g);break;default:d!=this.m_groundBody&&this.m_debugDraw.DrawSegment(e,k,g),this.m_debugDraw.DrawSegment(k,h,g),c!=this.m_groundBody&&this.m_debugDraw.DrawSegment(f,h,g)}};b.prototype.DrawShape=function(a,b,c){switch(a.m_type){case A.e_circleShape:var e=a instanceof P?a:null;a=r.MulX(b,e.m_p);this.m_debugDraw.DrawSolidCircle(a,e.m_radius,b.R.col1,c);break;case A.e_polygonShape:e=
0;e=a instanceof S?a:null;a=parseInt(e.GetVertexCount());for(var f=e.GetVertices(),k=new y(a),e=0;e<a;++e)k[e]=r.MulX(b,f[e]);this.m_debugDraw.DrawSolidPolygon(k,a,c);break;case A.e_edgeShape:e=a instanceof aa?a:null,this.m_debugDraw.DrawSegment(r.MulX(b,e.GetVertex1()),r.MulX(b,e.GetVertex2()),c)}};return b}();t.Dynamics.b2DestructionListener=function(){function b(){}"use strict;";b.prototype.SayGoodbyeJoint=function(a){};b.prototype.SayGoodbyeFixture=function(a){};return b}();return t}.call(this);
"undefined"!==typeof module&&(module.exports=Box2D);